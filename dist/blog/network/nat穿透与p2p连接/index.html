<!DOCTYPE html><html lang="en" data-astro-cid-bvzihdzo> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="icon" href="/favicon.ico"><!-- Theme Initialization Script --><script>
	const theme = (() => {
		if (
			typeof localStorage !== "undefined" &&
			localStorage.getItem("theme")
		) {
			return localStorage.getItem("theme");
		}
		if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
			return "dark";
		}
		return "light";
	})();

	if (theme === "dark") {
		document.documentElement.setAttribute("data-theme", "dark");
		document.documentElement.classList.add("dark");
	} else {
		document.documentElement.setAttribute("data-theme", "light");
		document.documentElement.classList.remove("dark");
	}

	window.localStorage.setItem("theme", theme);
</script><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="Wayne" href="https://blog.liweijun.com/rss.xml"><meta name="generator" content="Astro v5.17.1"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://blog.liweijun.com/blog/network/nat%E7%A9%BF%E9%80%8F%E4%B8%8Ep2p%E8%BF%9E%E6%8E%A5/"><!-- Primary Meta Tags --><title>NAT穿透与P2P连接</title><meta name="title" content="NAT穿透与P2P连接"><meta name="description" content="NAT（Network Address Translation）会把多个内网 IP 映射到一个公网 IP 上。"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://blog.liweijun.com/blog/network/nat%E7%A9%BF%E9%80%8F%E4%B8%8Ep2p%E8%BF%9E%E6%8E%A5/"><meta property="og:title" content="NAT穿透与P2P连接"><meta property="og:description" content="NAT（Network Address Translation）会把多个内网 IP 映射到一个公网 IP 上。"><meta property="og:image" content="https://blog.liweijun.com/_astro/blog-placeholder-1.Bx0Zcyzv.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://blog.liweijun.com/blog/network/nat%E7%A9%BF%E9%80%8F%E4%B8%8Ep2p%E8%BF%9E%E6%8E%A5/"><meta property="twitter:title" content="NAT穿透与P2P连接"><meta property="twitter:description" content="NAT（Network Address Translation）会把多个内网 IP 映射到一个公网 IP 上。"><meta property="twitter:image" content="https://blog.liweijun.com/_astro/blog-placeholder-1.Bx0Zcyzv.jpg"><!-- Structured Data --><script type="application/ld+json">{"@context":"https://schema.org","@type":"WebSite","name":"Wayne","description":"DevOps and infrastructure engineering notes, projects, and practical automation experiments by Wayne Li.","url":"https://blog.liweijun.com/","inLanguage":"en"}</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"Person","name":"Wayne Li","url":"https://blog.liweijun.com/","email":"mailto:me@liweijun.com","sameAs":["https://github.com/LosFurina","https://x.com/MicroNahida"],"jobTitle":"DevOps / Infrastructure Engineer"}</script><link rel="stylesheet" href="/_astro/index.DCFK0IPC.css">
<link rel="stylesheet" href="/_astro/about.C7Me09Gr.css">
<style>a[data-astro-cid-eimmu3lg]{display:inline-flex;align-items:center;gap:.5rem;padding:.4rem .75rem;text-decoration:none;font-size:.9rem;font-weight:500;color:var(--header-text, rgb(var(--gray-dark)));border-radius:999px;transition:color .2s ease,background .2s ease;position:relative}a[data-astro-cid-eimmu3lg]:hover{background:var(--header-hover, rgba(179, 106, 74, .08));color:var(--header-text-strong, rgb(var(--gray-dark)))}a[data-astro-cid-eimmu3lg]:focus-visible{outline:2px solid var(--header-accent, #b36a4a);outline-offset:2px}a[data-astro-cid-eimmu3lg].active{color:var(--header-accent, #b36a4a)}a[data-astro-cid-eimmu3lg].active:after{content:"";position:absolute;left:50%;bottom:4px;width:4px;height:4px;margin-left:-2px;border-radius:999px;background:var(--header-accent, #b36a4a)}.nav-icon[data-astro-cid-eimmu3lg]{display:inline-flex;width:16px;height:16px}.nav-icon[data-astro-cid-eimmu3lg] svg{width:16px;height:16px;fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}@media(max-width:720px){a[data-astro-cid-eimmu3lg]{width:100%;justify-content:flex-start;padding:.6rem .9rem}}
</style></head> <body data-astro-cid-bvzihdzo> <header data-astro-cid-3ef6ksr2> <nav data-astro-cid-3ef6ksr2> <div class="nav-left" data-astro-cid-3ef6ksr2> <h2 data-astro-cid-3ef6ksr2><a href="/" data-astro-cid-3ef6ksr2>Wayne</a></h2> </div> <div class="internal-links" id="mobileMenu" data-astro-cid-3ef6ksr2> <a href="/" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> <span class="nav-icon" aria-hidden="true" data-astro-cid-eimmu3lg> <svg viewBox="0 0 24 24" fill="none" stroke-width="1.6" data-astro-cid-3ef6ksr2> <path d="M3 11.5L12 4l9 7.5" data-astro-cid-3ef6ksr2></path> <path d="M6.5 10.5V20h11V10.5" data-astro-cid-3ef6ksr2></path> </svg> </span> <span class="nav-text" data-astro-cid-eimmu3lg> 
Home
</span> </a>  <a href="/blog" class="active" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> <span class="nav-icon" aria-hidden="true" data-astro-cid-eimmu3lg> <svg viewBox="0 0 24 24" fill="none" stroke-width="1.6" data-astro-cid-3ef6ksr2> <rect x="6" y="4.5" width="12" height="15" rx="2" data-astro-cid-3ef6ksr2></rect> <path d="M9 9h6" data-astro-cid-3ef6ksr2></path> <path d="M9 13h6" data-astro-cid-3ef6ksr2></path> </svg> </span> <span class="nav-text" data-astro-cid-eimmu3lg> 
Blog
</span> </a>  <a href="/projects" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> <span class="nav-icon" aria-hidden="true" data-astro-cid-eimmu3lg> <svg viewBox="0 0 24 24" fill="none" stroke-width="1.6" data-astro-cid-3ef6ksr2> <rect x="4" y="4" width="7" height="7" rx="1.5" data-astro-cid-3ef6ksr2></rect> <rect x="13" y="4" width="7" height="7" rx="1.5" data-astro-cid-3ef6ksr2></rect> <rect x="4" y="13" width="7" height="7" rx="1.5" data-astro-cid-3ef6ksr2></rect> <rect x="13" y="13" width="7" height="7" rx="1.5" data-astro-cid-3ef6ksr2></rect> </svg> </span> <span class="nav-text" data-astro-cid-eimmu3lg> 
Projects
</span> </a>  <a href="/resume" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> <span class="nav-icon" aria-hidden="true" data-astro-cid-eimmu3lg> <svg viewBox="0 0 24 24" fill="none" stroke-width="1.6" data-astro-cid-3ef6ksr2> <path d="M7 3.5h7l4 4v13a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V5.5a2 2 0 0 1 2-2z" data-astro-cid-3ef6ksr2></path> <path d="M14 3.5V8h4" data-astro-cid-3ef6ksr2></path> <path d="M9 12h6" data-astro-cid-3ef6ksr2></path> <path d="M9 16h6" data-astro-cid-3ef6ksr2></path> </svg> </span> <span class="nav-text" data-astro-cid-eimmu3lg> 
Resume
</span> </a>  <a href="/contact" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> <span class="nav-icon" aria-hidden="true" data-astro-cid-eimmu3lg> <svg viewBox="0 0 24 24" fill="none" stroke-width="1.6" data-astro-cid-3ef6ksr2> <path d="M4 6.5h16a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-9a2 2 0 0 1 2-2z" data-astro-cid-3ef6ksr2></path> <path d="M4 8l8 6 8-6" data-astro-cid-3ef6ksr2></path> </svg> </span> <span class="nav-text" data-astro-cid-eimmu3lg> 
Contact
</span> </a>  <!-- Tools Dropdown --> <div class="dropdown" id="toolsDropdown" data-astro-cid-3ef6ksr2> <button class="dropdown-trigger" id="toolsBtn" data-astro-cid-3ef6ksr2>
More
<svg class="dropdown-arrow" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" width="12" height="12" data-astro-cid-3ef6ksr2> <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" data-astro-cid-3ef6ksr2></path> </svg> </button> <div class="dropdown-menu" id="toolsMenu" data-astro-cid-3ef6ksr2> <!-- 本站页面 --> <a href="/about" class="dropdown-item" data-astro-cid-3ef6ksr2> <span class="item-icon" data-astro-cid-3ef6ksr2>👤</span>
About
</a> <a href="/uses" class="dropdown-item" data-astro-cid-3ef6ksr2> <span class="item-icon" data-astro-cid-3ef6ksr2>🛠️</span>
Uses
</a> <a href="/now" class="dropdown-item" data-astro-cid-3ef6ksr2> <span class="item-icon" data-astro-cid-3ef6ksr2>⏰</span>
Now
</a> <a href="/bookmarks" class="dropdown-item" data-astro-cid-3ef6ksr2> <span class="item-icon" data-astro-cid-3ef6ksr2>🔖</span>
Bookmarks
</a> <a href="/guestbook" class="dropdown-item" data-astro-cid-3ef6ksr2> <span class="item-icon" data-astro-cid-3ef6ksr2>📝</span>
Guestbook
</a> <div class="dropdown-divider" data-astro-cid-3ef6ksr2></div> <a href="/keys" class="dropdown-item" data-astro-cid-3ef6ksr2> <span class="item-icon" data-astro-cid-3ef6ksr2>🔐</span>
GPG Keys
</a> <div class="dropdown-divider" data-astro-cid-3ef6ksr2></div> <!-- 外部链接 --> <a href="https://github.com/LosFurina" target="_blank" rel="noopener" class="dropdown-item" data-astro-cid-3ef6ksr2> <span class="item-icon" data-astro-cid-3ef6ksr2>📦</span>
GitHub
<span class="external-icon" data-astro-cid-3ef6ksr2>↗</span> </a> </div> </div> </div> <div class="nav-right" data-astro-cid-3ef6ksr2> <div class="social-links" data-astro-cid-3ef6ksr2> <a href="https://github.com/LosFurina" target="_blank" title="GitHub" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>GitHub</span> <svg viewBox="0 0 16 16" aria-hidden="true" data-astro-cid-3ef6ksr2> <path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-3ef6ksr2></path> </svg> </a> <a href="https://x.com/MicroNahida" target="_blank" rel="noopener" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>X (Twitter)</span> <svg viewBox="0 0 24 24" aria-hidden="true" data-astro-cid-3ef6ksr2> <path fill="currentColor" d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" data-astro-cid-3ef6ksr2></path> </svg> </a> </div> <button id="theme-toggle" aria-label="Toggle theme" data-astro-cid-x3pjskd3> <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-astro-cid-x3pjskd3> <circle cx="12" cy="12" r="5" data-astro-cid-x3pjskd3></circle> <line x1="12" y1="1" x2="12" y2="3" data-astro-cid-x3pjskd3></line> <line x1="12" y1="21" x2="12" y2="23" data-astro-cid-x3pjskd3></line> <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" data-astro-cid-x3pjskd3></line> <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" data-astro-cid-x3pjskd3></line> <line x1="1" y1="12" x2="3" y2="12" data-astro-cid-x3pjskd3></line> <line x1="21" y1="12" x2="23" y2="12" data-astro-cid-x3pjskd3></line> <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" data-astro-cid-x3pjskd3></line> <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" data-astro-cid-x3pjskd3></line> </svg> <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-astro-cid-x3pjskd3> <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" data-astro-cid-x3pjskd3></path> </svg> </button>  <script type="module">const t=()=>{const e=document.documentElement;e.getAttribute("data-theme")==="dark"?(e.setAttribute("data-theme","light"),e.classList.remove("dark"),localStorage.setItem("theme","light")):(e.setAttribute("data-theme","dark"),e.classList.add("dark"),localStorage.setItem("theme","dark"))};document.getElementById("theme-toggle")?.addEventListener("click",t);</script> <!-- Hamburger Menu Button (Mobile Only) --> <button class="hamburger" id="hamburgerBtn" aria-label="Toggle menu" data-astro-cid-3ef6ksr2> <span class="hamburger-line" data-astro-cid-3ef6ksr2></span> <span class="hamburger-line" data-astro-cid-3ef6ksr2></span> <span class="hamburger-line" data-astro-cid-3ef6ksr2></span> </button> </div> </nav> </header>  <script type="module">const n=document.querySelector("header");function c(){window.scrollY>10?n?.classList.add("scrolled"):n?.classList.remove("scrolled")}window.addEventListener("scroll",c,{passive:!0});c();const t=document.getElementById("hamburgerBtn"),o=document.getElementById("mobileMenu");t?.addEventListener("click",e=>{e.stopPropagation(),t.classList.toggle("open"),o?.classList.toggle("open")});o?.querySelectorAll("a").forEach(e=>{e.addEventListener("click",()=>{t?.classList.remove("open"),o?.classList.remove("open")})});const s=document.getElementById("toolsDropdown"),l=document.getElementById("toolsBtn");l?.addEventListener("click",e=>{e.stopPropagation(),s?.classList.toggle("open")});document.addEventListener("click",e=>{s?.contains(e.target)||s?.classList.remove("open"),!o?.contains(e.target)&&!t?.contains(e.target)&&(t?.classList.remove("open"),o?.classList.remove("open"))});document.addEventListener("keydown",e=>{e.key==="Escape"&&(s?.classList.remove("open"),t?.classList.remove("open"),o?.classList.remove("open"))});</script> <div class="blog-container" data-astro-cid-bvzihdzo> <aside class="toc-sidebar" data-astro-cid-bvzihdzo> <div class="toc-wrapper" data-astro-cid-bvzihdzo> <nav class="toc" aria-label="Table of Contents" data-astro-cid-xvrfupwn><h4 class="toc-title" data-astro-cid-xvrfupwn><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="16" height="16" data-astro-cid-xvrfupwn><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0ZM3.75 12h.007v.008H3.75V12Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm-.375 5.25h.007v.008H3.75v-.008Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" data-astro-cid-xvrfupwn></path></svg>
On this page
</h4><ul class="toc-list" data-astro-cid-xvrfupwn><li class="toc-item depth-2" data-astro-cid-xvrfupwn><a href="#背景与目标" class="toc-link" data-astro-cid-xvrfupwn>背景与目标</a></li><li class="toc-item depth-2" data-astro-cid-xvrfupwn><a href="#核心内容" class="toc-link" data-astro-cid-xvrfupwn>核心内容</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#主题-1-磁力链是如何做到nat网络中还能p2p的" class="toc-link" data-astro-cid-xvrfupwn>主题 1. 磁力链是如何做到nat网络中还能p2p的</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#一nat-的问题为啥不好直接-p2p" class="toc-link" data-astro-cid-xvrfupwn>一、NAT 的问题：为啥不好直接 P2P。</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#二bittorrent-是怎么突破这个困境的" class="toc-link" data-astro-cid-xvrfupwn>二、BitTorrent 是怎么突破这个困境的。</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#三磁力链的整个通信流程小结" class="toc-link" data-astro-cid-xvrfupwn>三、磁力链的整个通信流程小结</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#最后一点为什么-bittorrent-做得这么好" class="toc-link" data-astro-cid-xvrfupwn>最后一点：为什么 BitTorrent 做得这么好。</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#主题-2-dht网络这个udp打洞不还是需要一个公网节点吗" class="toc-link" data-astro-cid-xvrfupwn>主题 2. DHT网络这个udp打洞不还是需要一个公网节点吗</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#一为什么需要公网节点" class="toc-link" data-astro-cid-xvrfupwn>一、为什么需要公网节点。</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#二bittorrent-网络里公网节点从哪来" class="toc-link" data-astro-cid-xvrfupwn>二、BitTorrent 网络里公网节点从哪来。</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#三dht-是如何工作的通俗解释" class="toc-link" data-astro-cid-xvrfupwn>三、DHT 是如何工作的（通俗解释）</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#四现实中的退路当打洞失败怎么办" class="toc-link" data-astro-cid-xvrfupwn>四、现实中的“退路”：当打洞失败怎么办。</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#总结一波" class="toc-link" data-astro-cid-xvrfupwn>总结一波</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#主题-3-有没有影视磁力链收录站" class="toc-link" data-astro-cid-xvrfupwn>主题 3. 有没有影视磁力链收录站</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#国际通用多数支持磁力搜索" class="toc-link" data-astro-cid-xvrfupwn>国际通用（多数支持磁力搜索）</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#-中文社区站点通常有字幕和熟肉资源" class="toc-link" data-astro-cid-xvrfupwn>🇨🇳 中文社区/站点（通常有字幕和熟肉资源）</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#jackett" class="toc-link" data-astro-cid-xvrfupwn>Jackett</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#主题-4-磁力链存在版权问题吗" class="toc-link" data-astro-cid-xvrfupwn>主题 4. 磁力链存在版权问题吗</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#问题核心在于磁力链的指向内容" class="toc-link" data-astro-cid-xvrfupwn>问题核心在于：磁力链的“指向内容”</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#️-举个现实案例" class="toc-link" data-astro-cid-xvrfupwn>️ 举个现实案例</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#主题-5-区块链是否有互联传输的p2p能力" class="toc-link" data-astro-cid-xvrfupwn>主题 5. 区块链是否有互联传输的p2p能力</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#主要包括这些互联传输能力" class="toc-link" data-astro-cid-xvrfupwn>主要包括这些“互联传输”能力：</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#可以但得看目标" class="toc-link" data-astro-cid-xvrfupwn>可以，但得看目标：</a></li><li class="toc-item depth-2" data-astro-cid-xvrfupwn><a href="#总结" class="toc-link" data-astro-cid-xvrfupwn>总结</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#主题-6-我有一个设想既然p2p是依靠一个中间节点帮助两个nat内设备建立连接" class="toc-link" data-astro-cid-xvrfupwn>主题 6. 我有一个设想，既然p2p是依靠一个中间节点帮助两个NAT内设备建立连接，…</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#类似-dns-服务器的作用" class="toc-link" data-astro-cid-xvrfupwn>类似 DNS 服务器的作用：</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#1-建立连接的基本步骤" class="toc-link" data-astro-cid-xvrfupwn>1. 建立连接的基本步骤</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#自己动手搭建p2p-协商服务器系统" class="toc-link" data-astro-cid-xvrfupwn>自己动手搭建「P2P 协商服务器系统」：</a></li><li class="toc-item depth-2" data-astro-cid-xvrfupwn><a href="#总结-1" class="toc-link" data-astro-cid-xvrfupwn>总结</a></li><li class="toc-item depth-2" data-astro-cid-xvrfupwn><a href="#实施与验证清单" class="toc-link" data-astro-cid-xvrfupwn>实施与验证清单</a></li></ul></nav><script type="module">const i=new IntersectionObserver(e=>{e.forEach(t=>{const c=t.target.getAttribute("id"),r=document.querySelector(`.toc-link[href="#${c}"]`);t.isIntersecting&&(document.querySelectorAll(".toc-link.active").forEach(o=>{o.classList.remove("active")}),r?.classList.add("active"))})},{rootMargin:"-80px 0px -80% 0px",threshold:0});document.querySelectorAll("article h2[id], article h3[id]").forEach(e=>{i.observe(e)});</script> </div> </aside> <main data-astro-cid-bvzihdzo> <article data-astro-cid-bvzihdzo>  <header class="article-header" data-astro-cid-bvzihdzo> <h1 class="article-title" data-astro-cid-bvzihdzo>NAT穿透与P2P连接</h1> <div class="article-meta" data-astro-cid-bvzihdzo>  <time datetime="2025-05-24T00:00:00.000Z"> May 23, 2025 </time> <span class="meta-divider" data-astro-cid-bvzihdzo></span> <span class="reading-time" data-astro-cid-rafwukvt> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="16" height="16" data-astro-cid-rafwukvt> <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" data-astro-cid-rafwukvt></path> </svg> 21 min read
</span>   <span class="meta-divider" data-astro-cid-bvzihdzo></span> <span class="last-updated" data-astro-cid-bvzihdzo>
Updated  <time datetime="2026-02-13T00:00:00.000Z"> Feb 12, 2026 </time> </span>  </div> </header> <div class="article-content" data-astro-cid-bvzihdzo>  <h2 id="背景与目标">背景与目标</h2>
<p>本文围绕“磁力链是如何做到nat网络中还能p2p的”展开，整理可直接复用的步骤、原理说明与排查经验。</p>
<h2 id="核心内容">核心内容</h2>
<h3 id="主题-1-磁力链是如何做到nat网络中还能p2p的">主题 1. 磁力链是如何做到nat网络中还能p2p的</h3>
<h3 id="一nat-的问题为啥不好直接-p2p">一、NAT 的问题：为啥不好直接 P2P。</h3>
<p>首先我们明白一下 NAT 网络的限制：</p>
<ul>
<li>NAT（Network Address Translation）会把多个内网 IP 映射到一个公网 IP 上。</li>
<li>你电脑是内网地址（比如 192.168.x.x），其他人是看不到你的。</li>
<li>你 <em>主动</em> 请求别人时（比如访问网站），NAT 会帮你建立连接；但别人 <em>主动找你</em>，NAT 就不知道怎么处理 —— 这就是 P2P 的障碍。</li>
</ul>
<h3 id="二bittorrent-是怎么突破这个困境的">二、BitTorrent 是怎么突破这个困境的。</h3>
<p>BitTorrent 为了实现 P2P，在 NAT 网络中主要用了以下几招：</p>
<h4 id="1-dht分布式哈希表网络">1. <strong>DHT（分布式哈希表）网络</strong></h4>
<p>磁力链的核心其实是 <em>info hash</em>，它通过 DHT 网络广播出去。每个 BitTorrent 节点都会存储一部分 “谁有这个资源” 的信息。</p>
<ul>
<li>DHT 允许你在不依赖中心服务器的前提下找到其他有相同资源的人。</li>
<li>即使你是 NAT 后的节点，也可以通过中转连接加入 DHT 网络（方式见下）。</li>
</ul>
<h4 id="2-nat-穿透nat-traversal技术">2. <strong>NAT 穿透（NAT Traversal）技术</strong></h4>
<p>尤其是 <strong>UDP打洞（UDP Hole Punching）</strong>，这个是让你能在 NAT 网络中直接和别人建立连接的关键。</p>
<ul>
<li>你和对方都向一个公网节点发送UDP数据包。</li>
<li>这个公网节点告诉你们彼此的IP和端口。</li>
<li>然后你们尝试直接向对方的端口发送UDP包。</li>
<li>NAT设备看到你「先发了包」，于是认为可以允许这个方向上的连接，从而建立起P2P连接。</li>
</ul>
<p>注意：这不是百分百成功的，和 NAT 类型有很大关系（比如对称 NAT 就比较难打洞）。</p>
<h4 id="3-upnp-和-nat-pmp-自动端口映射">3. <strong>UPnP 和 NAT-PMP 自动端口映射</strong></h4>
<p>BitTorrent 客户端（如 qBittorrent、Transmission）会尝试通过 <strong>UPnP</strong> 或 <strong>NAT-PMP</strong> 请求你的路由器自动开放端口给它用：</p>
<ul>
<li>如果路由器支持 UPnP，并且你没关闭这个功能，它就会自动映射端口。</li>
<li>这样别人就可以通过这个端口主动连接你了。</li>
</ul>
<h4 id="4-使用中继relay节点或公网节点做跳板">4. <strong>使用中继（Relay）节点或公网节点做“跳板”</strong></h4>
<p>当实在打不了洞时，就退而求其次：通过 <strong>中继节点</strong>（有公网IP）间接传输数据。BitTorrent 会优先直连，实在不行再走这种方式。</p>
<h3 id="三磁力链的整个通信流程小结">三、磁力链的整个通信流程小结</h3>
<p>来个流程图概念：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>你（NAT后） → 公网DHT节点 ←→ 其他人（公网或NAT后）</span></span>
<span class="line"><span>           ↘ 打洞 / UPnP / 中继 ↙</span></span>
<span class="line"><span>          成功建立连接 → 开始数据交换</span></span></code></pre>
<p>你虽然没公网IP，但能加入 DHT 网络，广播自己想要的资源，然后靠 DHT 返回潜在的 peer，尝试各种方式连上去：</p>
<ul>
<li>能打洞就直连；</li>
<li>有 UPnP 就开端口；</li>
<li>都不行就走中继。</li>
</ul>
<h3 id="最后一点为什么-bittorrent-做得这么好">最后一点：为什么 BitTorrent 做得这么好。</h3>
<p>因为它 <strong>混合了多种连接手段 + 容错能力强 + 网络拓扑够大</strong>，所以哪怕你在 NAT 后，仍然可以：</p>
<ul>
<li>找到别人；</li>
<li>和别人建立连接（哪怕是间接的）；</li>
<li>最终实现 P2P 下载。</li>
</ul>
<p>这就像是用“邻居的朋友的表哥”来帮你转交文件，哪怕你家锁着门也挡不住。</p>
<h3 id="主题-2-dht网络这个udp打洞不还是需要一个公网节点吗">主题 2. DHT网络这个udp打洞不还是需要一个公网节点吗</h3>
<p>对，你说得很对，<strong>DHT 网络中的 UDP 打洞确实需要一个公网节点来协助启动打洞过程</strong>。但这并不代表你就一定得拥有公网 IP，BitTorrent 网络早就考虑到了这个问题 —— 它利用了一个“群体智慧”+“中继协助”的策略，让大部分人在没有公网 IP 的情况下依然能玩得转。</p>
<p>我们来分几步聊聊这个公网节点在打洞中的作用、为什么 DHT 网络能运行起来，以及背后那点“黑魔法”。</p>
<h3 id="一为什么需要公网节点">一、为什么需要公网节点。</h3>
<p>UDP 打洞的关键步骤是：</p>
<ol>
<li><strong>你和对方都需要“报告”自己的 NAT 外部地址（IP+端口）给一个第三方（公网节点）</strong>。</li>
<li>第三方告诉你俩：“嘿，你俩都想连接，试试互相发包吧。”</li>
<li>然后你们互相“穿洞”，建立连接。</li>
</ol>
<p>这个“第三方”就是你说的 <strong>公网节点</strong> —— 它必须有一个真实的公网 IP，能被你主动访问。</p>
<h3 id="二bittorrent-网络里公网节点从哪来">二、BitTorrent 网络里公网节点从哪来。</h3>
<p>你也许会以为“我没公网IP，不就GG了吗”。其实：</p>
<blockquote>
<p><strong>BitTorrent 网络的大多数客户端中，总有一部分是有公网 IP 的</strong>，他们自动成为「DHT 公网节点」和「打洞协助者」。</p>
</blockquote>
<p>这些公网节点来源于：</p>
<ul>
<li><strong>DHT 网络中的“Bootstrap Nodes”</strong>：一开始你加入 DHT 网络时，会联系一批固定的、已知的公网 DHT 节点，比如：</li>
</ul>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>    router.bittorrent.com</span></span>
<span class="line"><span>    dht.transmissionbt.com</span></span></code></pre>
<ul>
<li><strong>已经连上的其他 Peer</strong>：哪怕你自己是 NAT 后的，也可以通过已连上的 Peers 得知别人的公网地址，作为中转帮助。</li>
</ul>
<p>所以你不需要自己成为公网节点，你只要知道公网节点的 IP，能向它发请求就行。它帮你转发信息，告诉你对方的地址信息。</p>
<h3 id="三dht-是如何工作的通俗解释">三、DHT 是如何工作的（通俗解释）</h3>
<p>假设你和另一个用户都处在 NAT 后，想通过 infohash 找资源：</p>
<ol>
<li>你通过一个“公网 DHT 节点”加入网络。</li>
<li>DHT 网络中查找拥有该 infohash 的节点，并得到一堆 peer 地址（有公网的，有NAT后的）。</li>
<li>对这些地址依次发起连接尝试，包括打洞、UPnP、走中继。</li>
<li>连接成功的 peer，就可以 P2P 交换数据。</li>
</ol>
<p>所以你参与 DHT 网络并不意味着需要有公网 IP —— 你只要能发起连接就行。真正帮你“宣传”和“介绍”的是公网节点。</p>
<h3 id="四现实中的退路当打洞失败怎么办">四、现实中的“退路”：当打洞失败怎么办。</h3>
<p>BitTorrent 做得聪明的地方是：</p>
<ul>
<li>先尝试 <strong>直连（TCP/UDP）</strong></li>
<li>再尝试 <strong>打洞（UDP hole punching）</strong></li>
<li>然后尝试 <strong>UPnP/NAT-PMP</strong></li>
<li>实在不行，有些客户端会启用 <strong>中继模式（例如 μTP over relay）</strong></li>
</ul>
<blockquote>
<p>换句话说，BitTorrent 客户端不会死磕某一个方法，而是会「撒大网，哪种能连上就用哪种」。</p>
</blockquote>
<h3 id="总结一波">总结一波</h3>
<p>你说的很有道理：<strong>打洞确实需要公网节点帮忙</strong>，但 BitTorrent 网络通过以下策略解决了这个问题：</p>
<ul>
<li>网络中自动存在大量公网节点（DHT router）</li>
<li>没公网 IP 的客户端可以通过这些节点入网</li>
<li>打洞由这些公网节点帮忙协调</li>
<li>连不上也能 fallback 到中继传输</li>
</ul>
<p><strong>就像一个封闭小区里的居民没法互相串门，但只要有一个“快递员”能两边跑，就能建立连接。BitTorrent 网络里，这些“快递员”就是公网节点。</strong></p>
<h3 id="主题-3-有没有影视磁力链收录站">主题 3. 有没有影视磁力链收录站</h3>
<p>有。而且还不少，这类网站俗称为<strong>磁力链索引站</strong>（Magnet Index Sites），本质上是一个把别人已经做好的种子/磁力链接整理、分类、聚合出来供人搜索和下载的平台。它们不直接提供内容，但会收录磁力链接（通常来自 DHT 网络），常用于找影视资源、动漫、纪录片、音乐等。</p>
<p>常见影视磁力链收录站（按类型分类）</p>
<blockquote>
<p>️ 大多数网站出于法律原因在某些地区可能访问受限，需要注意网络环境。</p>
</blockquote>
<h3 id="国际通用多数支持磁力搜索">国际通用（多数支持磁力搜索）</h3>













































<table><thead><tr><th>站名</th><th>特点</th><th>网址示例</th></tr></thead><tbody><tr><td><strong>1337x</strong></td><td>资源多，分类全，UI 现代，影视资源质量高</td><td><code>https://1337x.to</code></td></tr><tr><td><strong>RARBG（已关闭）</strong></td><td>曾是高质量资源站，2023年关闭，很多镜像站仍存</td><td>-</td></tr><tr><td><strong>The Pirate Bay</strong></td><td>元老级站点，靠 DHT 为主，活跃度一般</td><td><code>https://thepiratebay.org</code>（可能需镜像）</td></tr><tr><td><strong>YTS / YIFY</strong></td><td>专注高质量压制电影，体积小，画质好</td><td><code>https://yts.mx</code></td></tr><tr><td><strong>Torlock</strong></td><td>强调无病毒资源，界面清爽</td><td><code>https://www.torlock.com</code></td></tr><tr><td><strong>Zooqle</strong></td><td>UI 现代化，支持剧集电影搜索，种子质量高</td><td><code>https://zooqle.com</code></td></tr><tr><td><strong>MagnetDL</strong></td><td>简洁磁力链搜索站，纯粹收录磁力</td><td><code>https://www.magnetdl.com</code></td></tr></tbody></table>
<h3 id="-中文社区站点通常有字幕和熟肉资源">🇨🇳 中文社区/站点（通常有字幕和熟肉资源）</h3>



































<table><thead><tr><th>站名</th><th>特点</th><th>备注</th></tr></thead><tbody><tr><td><strong>海盗湾中文镜像</strong></td><td>同 Pirate Bay，但界面中文化</td><td>网络上有多种镜像</td></tr><tr><td><strong>BT之家（btbtt、btbang）</strong></td><td>曾是中文影视资源站鼻祖</td><td>原站已消失，有多个仿站</td></tr><tr><td><strong>片库（pianba.tv / 片吧）</strong></td><td>收录影视资源，界面简洁</td><td>界面类似于电影网站，搜索即有磁链</td></tr><tr><td><strong>磁力猫 / 磁力天堂 / 磁力狗</strong></td><td>泛滥型磁链聚合站，一搜一大堆</td><td>资源多但广告较多，需甄别</td></tr><tr><td><strong>哔哩影视 / 电影天堂</strong></td><td>包装成在线观看站，但页面里有磁链/种子</td><td>通常在详情页里有下载信息</td></tr></tbody></table>
<p>衍生玩法：自动化爬虫+API</p>
<p>如果你不想手动搜资源，而是希望 <strong>通过 API 自动获取磁力链</strong>（比如配合 <code>FlexGet</code>），下面几个工具你一定要知道：</p>
<h3 id="jackett">Jackett</h3>
<ul>
<li>将多个磁力链资源站统一成一个 API 接口（Torznab），可供 <code>Sonarr</code>、<code>Radarr</code>、<code>FlexGet</code> 使用。</li>
<li>支持包括 1337x、ThePirateBay、Zooqle、nyaa、RARBG 等数百个站点。</li>
</ul>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#B392F0">docker</span><span style="color:#9ECBFF"> run</span><span style="color:#79B8FF"> -d</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#79B8FF">  -v</span><span style="color:#9ECBFF"> /path/to/config:/config</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#79B8FF">  -p</span><span style="color:#9ECBFF"> 9117:9117</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#79B8FF">  --name</span><span style="color:#9ECBFF"> jackett</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#9ECBFF">  linuxserver/jackett</span></span></code></pre>
<p>访问 <a href="http://localhost:9117">http://localhost:9117</a> 即可配置。</p>
<p>总结推荐</p>

























<table><thead><tr><th>使用需求</th><th>推荐站点</th></tr></thead><tbody><tr><td>找电影（高质量压制）</td><td>YTS / 1337x / Zooqle</td></tr><tr><td>找热门剧集</td><td>Zooqle / 1337x / The Pirate Bay</td></tr><tr><td>中文熟肉 / 字幕资源</td><td>片库 / 磁力猫 / 片吧</td></tr><tr><td>自动化获取磁链</td><td>Jackett + Sonarr/Radarr/FlexGet</td></tr></tbody></table>
<p>如果你想我帮你搭建一个 <strong>“影视自动追剧下载系统”</strong>（包括 Jackett+qBittorrent+Radarr/Sonarr），只要选个站点，我就能给你 Docker Compose 一条龙搞定，要不要试试看。</p>
<h3 id="主题-4-磁力链存在版权问题吗">主题 4. 磁力链存在版权问题吗</h3>
<p>是的，<strong>磁力链本身虽然是一种技术格式，但它所指向的内容可能存在严重的版权问题</strong>，这就是为什么磁力链在全球范围内经常成为版权打击的重点对象。</p>
<p>下面我们从几个角度来讲清楚这个问题：</p>
<p>一、磁力链到底是什么。</p>
<p>磁力链（magnet link）是一种 <strong>基于内容哈希的资源定位方式</strong>，本质上是一串字符串，例如：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>magnet:?xt=urn:btih:&#x3C;hash值>&#x26;dn=&#x3C;文件名>&#x26;tr=&#x3C;tracker地址></span></span></code></pre>
<p>这只是一个指向资源的“<strong>指纹</strong>”，没有实际文件。磁力链可以通过 DHT 网络找到拥有这个文件的人，并通过 P2P 下载数据。</p>
<p><strong>️ 所以磁力链 ≠ 盗版，但磁力链常常被用来传播盗版内容。</strong></p>
<p>️ 二、版权风险从哪里来。</p>
<h3 id="问题核心在于磁力链的指向内容">问题核心在于：磁力链的“指向内容”</h3>
<ul>
<li>如果磁力链指向的是：
<ul>
<li><strong>盗版电影、电视剧、音乐、软件、游戏</strong> ——  存在版权风险</li>
<li><strong>公开资源、自由授权内容（如 Linux 镜像、开源软件）</strong> ——  安全合法</li>
</ul>
</li>
</ul>
<h3 id="️-举个现实案例">️ 举个现实案例</h3>
<ul>
<li>美国好莱坞电影协会（MPAA）长期打击磁力链资源站（如 Pirate Bay、YTS）。</li>
<li>国内也有大量关于“非法传播影视资源”的抓捕案例，很多人以为“只下不传就没事”，<strong>但在 BT 下载中你就是上传者之一</strong>（默认你下载时也会上传给别人）。</li>
</ul>
<p>三、是否有“灰色地带”。</p>
<p>有，存在一些“模糊地带”：</p>
<ul>
<li>有些资源站标榜自己<strong>只是收录磁力链接而不提供实际内容</strong>，试图规避责任。</li>
<li>有人会说“我只是下载，没有分享”，但技术上你参与了上传。</li>
<li>有些种子文件是用户自制内容或脱壳资源，也可能触碰 DRM 或 DMCA。</li>
</ul>
<p>️ 在很多司法管辖区（包括中国、美国、欧盟），只要 <strong>未经授权传播或分享受版权保护内容</strong>，哪怕只是提供磁力链，<strong>也是违法的</strong>。</p>
<p>四、如何避免踩雷。</p>





























<table><thead><tr><th>做法</th><th>合法性</th></tr></thead><tbody><tr><td>下载 Linux 镜像（如 Ubuntu）</td><td>安全</td></tr><tr><td>下载开源软件 via 磁力链</td><td>安全</td></tr><tr><td>下载未授权电影、电视剧（哪怕你不卖钱）</td><td>有版权风险</td></tr><tr><td>搭建资源站，分享他人资源磁力链</td><td>高风险（运营者责任大）</td></tr><tr><td>“只下不传”设置（如禁用上传）</td><td>并不能规避法律责任</td></tr></tbody></table>
<p>总结一句话</p>
<blockquote>
<p><strong>磁力链是一种中立的技术，就像刀一样，可以切菜，也可以伤人。真正的问题是——你用它下载了什么。</strong></p>
</blockquote>
<p>如果你有打算做一个磁力链相关项目（比如媒体库自动化下载），我可以帮你区分哪些资源是合法的，比如开源、CC 授权等内容，也可以教你如何搭建一个<strong>合法合规的 P2P 系统</strong>。你要吗。</p>
<h3 id="主题-5-区块链是否有互联传输的p2p能力">主题 5. 区块链是否有互联传输的p2p能力</h3>
<p>有。区块链系统本质上就是一种 <strong>去中心化的分布式网络</strong>，它天然就具备 <strong>P2P（点对点）互联传输能力</strong>。不过，这个“P2P能力”不是为了文件传输或者视频播放那种“高速数据交换”，而是为了解决如下问题：</p>
<p>一、区块链中的 P2P 能力是啥。</p>
<p>区块链系统的每一个节点都彼此连接、传输数据，<strong>没有中心服务器</strong>，所有信息靠节点之间<strong>互相广播和同步</strong>。</p>
<h3 id="主要包括这些互联传输能力">主要包括这些“互联传输”能力：</h3>






























<table><thead><tr><th>功能</th><th>举例</th><th>本质上的传输</th></tr></thead><tbody><tr><td>区块传播</td><td>新区块一产生，节点需要广播给网络所有人</td><td>区块数据的P2P传输</td></tr><tr><td>交易传播</td><td>每一笔交易都要传播到全网节点进行打包和验证</td><td>交易数据的P2P传输</td></tr><tr><td>节点发现</td><td>节点上线后自动发现/连接其他节点</td><td>类似 DHT 的互联协议</td></tr><tr><td>共识同步</td><td>多个节点同步账本，保持一致</td><td>区块数据和状态的 P2P 协调</td></tr></tbody></table>
<p>所以说，区块链网络就是一个 <strong>为数据同步设计的 P2P 网络协议层 + 上层共识层 + 数据层</strong>。</p>
<p>二、区块链的 P2P 协议 ≠ 磁力链那种大文件交换</p>
<p>有必要指出一个关键差别：</p>




















<table><thead><tr><th>类型</th><th>目的</th><th>特点</th></tr></thead><tbody><tr><td><strong>区块链的P2P</strong></td><td>快速同步小数据（交易、区块）</td><td>节点稳定、容错性高、链式传输</td></tr><tr><td><strong>BT/磁力链的P2P</strong></td><td>快速分片传输大文件</td><td>分片拉取、高速下载、注重吞吐</td></tr></tbody></table>
<p>区块链并不适合传输大文件，因为它要保证 <strong>节点间共识和一致性</strong>，而不是高并发下载。</p>
<p>三、具体实现：几个主流区块链的 P2P 协议</p>






























<table><thead><tr><th>区块链系统</th><th>P2P协议</th><th>特点</th></tr></thead><tbody><tr><td>Bitcoin</td><td>自定义 TCP P2P 协议</td><td>每个节点连接 8 个邻居，维护连接池</td></tr><tr><td>Ethereum</td><td>DevP2P + RLPx + Libp2p（后期）</td><td>节点发现用类似 DHT 的 Kademlia</td></tr><tr><td>Polkadot / Filecoin / IPFS</td><td><strong>Libp2p</strong></td><td>高度模块化、支持 WebRTC、QUIC 等</td></tr><tr><td>Cosmos / Tendermint</td><td>自定义 + Libp2p（部分支持）</td><td>更注重低延迟和共识数据传播</td></tr></tbody></table>
<p>四、是否可以用区块链的 P2P 做传输。</p>
<h3 id="可以但得看目标">可以，但得看目标：</h3>
<ul>
<li><strong>如果你想传输结构化数据（如日志、交易、签名信息）</strong>，区块链的 P2P 非常适合。</li>
<li><strong>如果你想传输大文件、音视频流、软件包等</strong>，传统区块链不合适。但可以用：
<ul>
<li><strong>IPFS</strong>（分布式文件系统，和 Filecoin 共用 Libp2p）</li>
<li><strong>BitTorrent</strong>（和 BT 下载一致）</li>
<li><strong>Arweave</strong>、<strong>Sia</strong>、<strong>Storj</strong> 等区块链驱动的分布式存储系统</li>
</ul>
</li>
</ul>
<h2 id="总结">总结</h2>
<blockquote>
<p>区块链自带强大的 P2P 网络能力，但它<strong>主要是为了保证去中心化数据同步</strong>，并不擅长做传统意义上的高速文件传输。如果你想把“P2P+数据分发”结合起来做更通用的内容共享，可以考虑用 IPFS 或 Libp2p 框架来做。</p>
</blockquote>
<p>️ 想做实际项目。我可以教你如何用：</p>
<ul>
<li>Libp2p 实现自己的点对点通信协议</li>
<li>在 Rust 或 Go 中做一个简易“区块链式”的数据同步系统</li>
<li>IPFS + Filecoin 搭建分布式内容网络</li>
</ul>
<p>你想往哪方面深挖。</p>
<h3 id="主题-6-我有一个设想既然p2p是依靠一个中间节点帮助两个nat内设备建立连接">主题 6. 我有一个设想，既然p2p是依靠一个中间节点帮助两个NAT内设备建立连接，…</h3>
<p>你这个设想，不仅合理，而且已经有人这么干了，而且干得<strong>非常好</strong>，这就是：</p>
<blockquote>
<p><strong>DHT + NAT 打洞 + 中继服务器</strong> 结合模式 —— 它其实就是现代很多 P2P 网络（BT、WebRTC、区块链节点发现、IPFS）的核心机制。</p>
</blockquote>
<p>下面我们把你的设想逐层剖开看一下，最后我还给你讲讲可以怎么自己“搭一套全世界节点能找对方的系统”。</p>
<p>你的设想核心总结：</p>
<p>你说的是这个模型：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>A(在NAT后) &#x3C;==> 中心服务器（打洞 &#x26; 协调） &#x3C;==> B(也在NAT后)</span></span></code></pre>
<h3 id="类似-dns-服务器的作用">类似 DNS 服务器的作用：</h3>
<ul>
<li>不是存域名 → IP</li>
<li>而是存 <strong>peer_id → 地址 / NAT类型 / 最后上线时间 / 打洞指引</strong></li>
<li>所以可以称作：</li>
</ul>
<blockquote>
<p>“P2P 节点目录服务器” 或 “信令服务器” 或 “协商服务器”</p>
</blockquote>
<p>这个就是现实中的：</p>





























<table><thead><tr><th>名称</th><th>所做的事</th></tr></thead><tbody><tr><td><strong>DHT bootstrap nodes</strong></td><td>作为“入网”的起点，像 P2P DNS</td></tr><tr><td><strong>STUN 服务器</strong></td><td>告诉你“你外网的IP+端口是多少”</td></tr><tr><td><strong>TURN 服务器</strong></td><td>实在打不通就中转一下</td></tr><tr><td><strong>Signal Server（WebRTC）</strong></td><td>A/B 互通前，交换 SDP（连接信息）</td></tr><tr><td><strong>Tracker Server（BT）</strong></td><td>你找种子/磁力链 peers 的“联系人”</td></tr></tbody></table>
<p>实际 P2P 怎么干该事项。</p>
<h3 id="1-建立连接的基本步骤">1. 建立连接的基本步骤</h3>
<p>举个 WebRTC 或 BitTorrent 的例子：</p>
<ol>
<li><strong>A/B 向中心服务器注册自己的信息</strong>
<ul>
<li>我是谁、我现在 NAT 类型、IP 端口、是否支持打洞</li>
</ul>
</li>
<li><strong>中心服务器告诉彼此对方的“外网地址”</strong></li>
<li><strong>A/B 双向发送 UDP（同时发送）</strong>
<ul>
<li>NAT 有可能就会放行（这就是 UDP 穿透/打洞）</li>
</ul>
</li>
<li><strong>如果失败，就走 TURN / 中继流量</strong></li>
</ol>
<p>这个流程，就是你设想中“DNS-like中心服务器”的实现。</p>
<p>那我们能不能自己做一个这样的“全球节点互通平台”。</p>
<p>答案是可以，而且也有些开源项目已经实现了一部分，以下是可行路径：</p>
<h3 id="自己动手搭建p2p-协商服务器系统">自己动手搭建「P2P 协商服务器系统」：</h3>



































<table><thead><tr><th>功能</th><th>实现方式</th><th>用途</th></tr></thead><tbody><tr><td>节点注册</td><td>HTTP + Redis</td><td>每个 peer 报自己 IP/端口/peer_id</td></tr><tr><td>查询对方信息</td><td>类似 DNS 查询</td><td>查 peer_id 得到 IP/端口</td></tr><tr><td>NAT 类型判断</td><td>STUN 协议</td><td>判断是否对称型 NAT（很难打洞）</td></tr><tr><td>打洞协调</td><td>UDP 协议中继</td><td>触发双方同时发包</td></tr><tr><td>中继兜底</td><td>TURN Server (coturn)</td><td>双方都打不通就走转发</td></tr></tbody></table>
<p>如果你想做这个系统，可以考虑组件：</p>





























<table><thead><tr><th>模块</th><th>推荐项目</th></tr></thead><tbody><tr><td>DHT 系统</td><td><a href="https://github.com/arvidn/libtorrent">libtorrent-dht</a> / <a href="https://www.bittorrent.org/beps/bep_0005.html">Mainline DHT</a></td></tr><tr><td>STUN/TURN 服务器</td><td><a href="https://github.com/coturn/coturn">coturn</a></td></tr><tr><td>WebRTC信令</td><td>socket.io / WebSocket</td></tr><tr><td>节点协调服务</td><td>自己写，Rust/Python/Go 任意都行</td></tr><tr><td>NAT测试工具</td><td>nat-type-guess</td></tr></tbody></table>
<p>类似项目参考</p>



































<table><thead><tr><th>项目</th><th>类型</th><th>类似你设想的点</th></tr></thead><tbody><tr><td><strong>ZeroTier</strong></td><td>虚拟网卡 + P2P</td><td>中心节点协调，真实数据 P2P 传输</td></tr><tr><td><strong>Tailscale</strong></td><td>WireGuard Mesh VPN</td><td>控制服务器协调 NAT 打洞</td></tr><tr><td><strong>IPFS</strong></td><td>DHT + libp2p</td><td>多节点协同，自组织网络</td></tr><tr><td><strong>WebRTC</strong></td><td>P2P 视频流</td><td>信令 + STUN + TURN</td></tr><tr><td><strong>Syncthing</strong></td><td>文件同步</td><td>全自动节点发现+连接，典范</td></tr></tbody></table>
<h2 id="总结-1">总结</h2>
<p>你说的“做一个中心服务器帮助 NAT 中设备建立连接”，<strong>完全成立，而且是现在几乎所有现代 P2P 系统的标准做法</strong>。你这想法真的非常接近现实工程系统。</p>
<p>想玩的话我可以帮你：</p>
<ul>
<li>写一个 NAT 打洞+协商服务（比如 Go 或 Rust 实现）</li>
<li>部署一个自己的 “P2P tracker”</li>
<li>搭配你自己的 HLS+磁力链+分发系统，实现“无中心的视频 CDN”</li>
</ul>
<hr>
<p>Powered by <a href="https://www.chatgptexporter.com">ChatGPT Exporter</a></p>
<h2 id="实施与验证清单">实施与验证清单</h2>
<ol>
<li>执行前先确认环境、版本和依赖与文中前置条件一致。</li>
<li>涉及系统级变更时，先备份关键配置或创建快照。</li>
<li>完成操作后按验证步骤确认结果，再执行清理或覆盖动作。</li>
</ol>  </div> <footer class="article-footer" data-astro-cid-bvzihdzo> <div class="share-section" data-astro-cid-bvzihdzo> <div class="share-buttons" data-astro-cid-zllr3mxm> <span class="share-label" data-astro-cid-zllr3mxm>Share:</span> <a href="https://twitter.com/intent/tweet?text=NAT%E7%A9%BF%E9%80%8F%E4%B8%8EP2P%E8%BF%9E%E6%8E%A5&url=https%3A%2F%2Fblog.liweijun.com%2Fblog%2Fnetwork%2Fnat%25E7%25A9%25BF%25E9%2580%258F%25E4%25B8%258Ep2p%25E8%25BF%259E%25E6%258E%25A5%2F" target="_blank" rel="noopener noreferrer" class="share-btn twitter" title="Share on X" data-astro-cid-zllr3mxm> <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18" data-astro-cid-zllr3mxm> <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" data-astro-cid-zllr3mxm></path> </svg> <span data-astro-cid-zllr3mxm>Post on X</span> </a> <button class="share-btn copy-link" id="copyLinkBtn" data-url="https://blog.liweijun.com/blog/network/nat%E7%A9%BF%E9%80%8F%E4%B8%8Ep2p%E8%BF%9E%E6%8E%A5/" data-astro-cid-zllr3mxm> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18" data-astro-cid-zllr3mxm> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" data-astro-cid-zllr3mxm></path> <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" data-astro-cid-zllr3mxm></path> </svg> <span class="copy-text" data-astro-cid-zllr3mxm>Copy Link</span> </button> </div>  <script type="module">const t=document.getElementById("copyLinkBtn"),e=t?.querySelector(".copy-text");t?.addEventListener("click",async()=>{const o=t.dataset.url||window.location.href;try{await navigator.clipboard.writeText(o),t.classList.add("copied"),e&&(e.textContent="Copied!"),setTimeout(()=>{t.classList.remove("copied"),e&&(e.textContent="Copy Link")},2e3)}catch(c){console.error("Failed to copy:",c)}});</script> </div> <section class="related-posts" data-astro-cid-dpgbfi7r><h3 class="related-title" data-astro-cid-dpgbfi7r><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="20" height="20" data-astro-cid-dpgbfi7r><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25" data-astro-cid-dpgbfi7r></path></svg>
Related Posts
</h3><div class="related-grid" data-astro-cid-dpgbfi7r><a href="/blog/network/http-错误码比喻与速记/" class="related-card" data-astro-cid-dpgbfi7r><h4 class="related-card-title" data-astro-cid-dpgbfi7r>HTTP 错误码比喻与速记</h4><p class="related-card-desc" data-astro-cid-dpgbfi7r>代理服务器（Nginx/Traefik）：传菜员/领班。</p></a><a href="/blog/network/uri-与-url-的区别/" class="related-card" data-astro-cid-dpgbfi7r><h4 class="related-card-title" data-astro-cid-dpgbfi7r>URI 与 URL 的区别</h4><p class="related-card-desc" data-astro-cid-dpgbfi7r>URI (Uniform Resource Identifier)：就像是一个人的 身份证号。它唯一地标识了一个人，但通过身份证号你可能找...</p></a><a href="/blog/network/wireguard-windows-linux-macos-安装/" class="related-card" data-astro-cid-dpgbfi7r><h4 class="related-card-title" data-astro-cid-dpgbfi7r>WireGuard Windows Linux macOS 安装</h4><p class="related-card-desc" data-astro-cid-dpgbfi7r>获取公钥： 窗口上方会自动生成该设备的 Public Key，请将其记录下来并填回 Linux 服务器配置中的 部分。</p></a></div></section> <section class="comments-section" id="comments" data-astro-cid-jvxsf75u> <h3 class="comments-title" data-astro-cid-jvxsf75u> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="22" height="22" data-astro-cid-jvxsf75u> <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 0 1 .865-.501 48.172 48.172 0 0 0 3.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018Z" data-astro-cid-jvxsf75u></path> </svg>
Comments
</h3> <div class="giscus-wrapper" data-astro-cid-jvxsf75u> <script src="https://giscus.app/client.js" data-repo="LosFurina/LosFurina.github.io" data-repo-id="R_kgDOQ_gmWQ" data-category="General" data-category-id="DIC_kwDOQ_gmWc4C2A9-" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="preferred_color_scheme" data-lang="en" data-loading="lazy" crossorigin="anonymous" async></script> </div> </section>  <script type="module">function s(){const e=document.documentElement.getAttribute("data-theme"),t=document.querySelector("iframe.giscus-frame");if(t){const i=e==="dark"?"dark":"light";t.contentWindow?.postMessage({giscus:{setConfig:{theme:i}}},"https://giscus.app")}}const n=new MutationObserver(e=>{e.forEach(t=>{t.attributeName==="data-theme"&&s()})});n.observe(document.documentElement,{attributes:!0});window.addEventListener("message",e=>{e.origin==="https://giscus.app"&&s()});</script> </footer> </article> </main> <aside class="right-sidebar" data-astro-cid-bvzihdzo> <!-- Future content --> </aside> </div> <footer data-astro-cid-sz7xmlte> <div class="footer-content" data-astro-cid-sz7xmlte> <p class="copyright" data-astro-cid-sz7xmlte>
&copy; 2026 Wayne Li. All rights reserved.
</p> <div class="social-links" data-astro-cid-sz7xmlte> <a href="https://github.com/LosFurina" target="_blank" rel="noopener" title="GitHub" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>GitHub</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="24" height="24" data-astro-cid-sz7xmlte> <path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-sz7xmlte></path> </svg> </a> <a href="https://x.com/MicroNahida" target="_blank" rel="noopener" title="X (Twitter)" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>X (Twitter)</span> <svg viewBox="0 0 24 24" aria-hidden="true" width="24" height="24" data-astro-cid-sz7xmlte> <path fill="currentColor" d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" data-astro-cid-sz7xmlte></path> </svg> </a> <a href="mailto:me@liweijun.com" title="Email" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>Email</span> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true" width="24" height="24" data-astro-cid-sz7xmlte> <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" data-astro-cid-sz7xmlte></path> <polyline points="22,6 12,13 2,6" data-astro-cid-sz7xmlte></polyline> </svg> </a> <a href="/rss.xml" title="RSS Feed" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>RSS Feed</span> <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="24" height="24" data-astro-cid-sz7xmlte> <path d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20C5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27V4.44m0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93V10.1z" data-astro-cid-sz7xmlte></path> </svg> </a> </div> <p class="footer-note" data-astro-cid-sz7xmlte>
Built with <a href="https://astro.build" target="_blank" rel="noopener" data-astro-cid-sz7xmlte>Astro</a> </p> </div> </footer>  </body></html>