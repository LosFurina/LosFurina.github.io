<!DOCTYPE html><html lang="en" data-astro-cid-bvzihdzo> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="icon" href="/favicon.ico"><!-- Theme Initialization Script --><script>
	const theme = (() => {
		if (
			typeof localStorage !== "undefined" &&
			localStorage.getItem("theme")
		) {
			return localStorage.getItem("theme");
		}
		if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
			return "dark";
		}
		return "light";
	})();

	if (theme === "dark") {
		document.documentElement.setAttribute("data-theme", "dark");
		document.documentElement.classList.add("dark");
	} else {
		document.documentElement.setAttribute("data-theme", "light");
		document.documentElement.classList.remove("dark");
	}

	window.localStorage.setItem("theme", theme);
</script><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="Wayne" href="https://blog.liweijun.com/rss.xml"><meta name="generator" content="Astro v5.17.1"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://blog.liweijun.com/blog/infra/rust-%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88%E5%8C%BA%E5%88%AB/"><!-- Primary Meta Tags --><title>Rust æ™ºèƒ½æŒ‡é’ˆåŒºåˆ«</title><meta name="title" content="Rust æ™ºèƒ½æŒ‡é’ˆåŒºåˆ«"><meta name="description" content="åªæ”¯æŒå¤åˆ¶ç±»å‹çš„ get/setï¼Œæ— æ³•è¿”å›å¼•ç”¨ã€‚"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://blog.liweijun.com/blog/infra/rust-%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88%E5%8C%BA%E5%88%AB/"><meta property="og:title" content="Rust æ™ºèƒ½æŒ‡é’ˆåŒºåˆ«"><meta property="og:description" content="åªæ”¯æŒå¤åˆ¶ç±»å‹çš„ get/setï¼Œæ— æ³•è¿”å›å¼•ç”¨ã€‚"><meta property="og:image" content="https://blog.liweijun.com/_astro/blog-placeholder-1.Bx0Zcyzv.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://blog.liweijun.com/blog/infra/rust-%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88%E5%8C%BA%E5%88%AB/"><meta property="twitter:title" content="Rust æ™ºèƒ½æŒ‡é’ˆåŒºåˆ«"><meta property="twitter:description" content="åªæ”¯æŒå¤åˆ¶ç±»å‹çš„ get/setï¼Œæ— æ³•è¿”å›å¼•ç”¨ã€‚"><meta property="twitter:image" content="https://blog.liweijun.com/_astro/blog-placeholder-1.Bx0Zcyzv.jpg"><!-- Structured Data --><script type="application/ld+json">{"@context":"https://schema.org","@type":"WebSite","name":"Wayne","description":"DevOps and infrastructure engineering notes, projects, and practical automation experiments by Wayne Li.","url":"https://blog.liweijun.com/","inLanguage":"en"}</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"Person","name":"Wayne Li","url":"https://blog.liweijun.com/","email":"mailto:me@liweijun.com","sameAs":["https://github.com/LosFurina","https://x.com/MicroNahida"],"jobTitle":"DevOps / Infrastructure Engineer"}</script><link rel="stylesheet" href="/_astro/index.DCFK0IPC.css">
<link rel="stylesheet" href="/_astro/about.C7Me09Gr.css">
<style>a[data-astro-cid-eimmu3lg]{display:inline-flex;align-items:center;gap:.5rem;padding:.4rem .75rem;text-decoration:none;font-size:.9rem;font-weight:500;color:var(--header-text, rgb(var(--gray-dark)));border-radius:999px;transition:color .2s ease,background .2s ease;position:relative}a[data-astro-cid-eimmu3lg]:hover{background:var(--header-hover, rgba(179, 106, 74, .08));color:var(--header-text-strong, rgb(var(--gray-dark)))}a[data-astro-cid-eimmu3lg]:focus-visible{outline:2px solid var(--header-accent, #b36a4a);outline-offset:2px}a[data-astro-cid-eimmu3lg].active{color:var(--header-accent, #b36a4a)}a[data-astro-cid-eimmu3lg].active:after{content:"";position:absolute;left:50%;bottom:4px;width:4px;height:4px;margin-left:-2px;border-radius:999px;background:var(--header-accent, #b36a4a)}.nav-icon[data-astro-cid-eimmu3lg]{display:inline-flex;width:16px;height:16px}.nav-icon[data-astro-cid-eimmu3lg] svg{width:16px;height:16px;fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round}@media(max-width:720px){a[data-astro-cid-eimmu3lg]{width:100%;justify-content:flex-start;padding:.6rem .9rem}}
</style></head> <body data-astro-cid-bvzihdzo> <header data-astro-cid-3ef6ksr2> <nav data-astro-cid-3ef6ksr2> <div class="nav-left" data-astro-cid-3ef6ksr2> <h2 data-astro-cid-3ef6ksr2><a href="/" data-astro-cid-3ef6ksr2>Wayne</a></h2> </div> <div class="internal-links" id="mobileMenu" data-astro-cid-3ef6ksr2> <a href="/" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> <span class="nav-icon" aria-hidden="true" data-astro-cid-eimmu3lg> <svg viewBox="0 0 24 24" fill="none" stroke-width="1.6" data-astro-cid-3ef6ksr2> <path d="M3 11.5L12 4l9 7.5" data-astro-cid-3ef6ksr2></path> <path d="M6.5 10.5V20h11V10.5" data-astro-cid-3ef6ksr2></path> </svg> </span> <span class="nav-text" data-astro-cid-eimmu3lg> 
Home
</span> </a>  <a href="/blog" class="active" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> <span class="nav-icon" aria-hidden="true" data-astro-cid-eimmu3lg> <svg viewBox="0 0 24 24" fill="none" stroke-width="1.6" data-astro-cid-3ef6ksr2> <rect x="6" y="4.5" width="12" height="15" rx="2" data-astro-cid-3ef6ksr2></rect> <path d="M9 9h6" data-astro-cid-3ef6ksr2></path> <path d="M9 13h6" data-astro-cid-3ef6ksr2></path> </svg> </span> <span class="nav-text" data-astro-cid-eimmu3lg> 
Blog
</span> </a>  <a href="/projects" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> <span class="nav-icon" aria-hidden="true" data-astro-cid-eimmu3lg> <svg viewBox="0 0 24 24" fill="none" stroke-width="1.6" data-astro-cid-3ef6ksr2> <rect x="4" y="4" width="7" height="7" rx="1.5" data-astro-cid-3ef6ksr2></rect> <rect x="13" y="4" width="7" height="7" rx="1.5" data-astro-cid-3ef6ksr2></rect> <rect x="4" y="13" width="7" height="7" rx="1.5" data-astro-cid-3ef6ksr2></rect> <rect x="13" y="13" width="7" height="7" rx="1.5" data-astro-cid-3ef6ksr2></rect> </svg> </span> <span class="nav-text" data-astro-cid-eimmu3lg> 
Projects
</span> </a>  <a href="/resume" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> <span class="nav-icon" aria-hidden="true" data-astro-cid-eimmu3lg> <svg viewBox="0 0 24 24" fill="none" stroke-width="1.6" data-astro-cid-3ef6ksr2> <path d="M7 3.5h7l4 4v13a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V5.5a2 2 0 0 1 2-2z" data-astro-cid-3ef6ksr2></path> <path d="M14 3.5V8h4" data-astro-cid-3ef6ksr2></path> <path d="M9 12h6" data-astro-cid-3ef6ksr2></path> <path d="M9 16h6" data-astro-cid-3ef6ksr2></path> </svg> </span> <span class="nav-text" data-astro-cid-eimmu3lg> 
Resume
</span> </a>  <a href="/contact" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> <span class="nav-icon" aria-hidden="true" data-astro-cid-eimmu3lg> <svg viewBox="0 0 24 24" fill="none" stroke-width="1.6" data-astro-cid-3ef6ksr2> <path d="M4 6.5h16a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-9a2 2 0 0 1 2-2z" data-astro-cid-3ef6ksr2></path> <path d="M4 8l8 6 8-6" data-astro-cid-3ef6ksr2></path> </svg> </span> <span class="nav-text" data-astro-cid-eimmu3lg> 
Contact
</span> </a>  <!-- Tools Dropdown --> <div class="dropdown" id="toolsDropdown" data-astro-cid-3ef6ksr2> <button class="dropdown-trigger" id="toolsBtn" data-astro-cid-3ef6ksr2>
More
<svg class="dropdown-arrow" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" width="12" height="12" data-astro-cid-3ef6ksr2> <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" data-astro-cid-3ef6ksr2></path> </svg> </button> <div class="dropdown-menu" id="toolsMenu" data-astro-cid-3ef6ksr2> <!-- æœ¬ç«™é¡µé¢ --> <a href="/about" class="dropdown-item" data-astro-cid-3ef6ksr2> <span class="item-icon" data-astro-cid-3ef6ksr2>ğŸ‘¤</span>
About
</a> <a href="/uses" class="dropdown-item" data-astro-cid-3ef6ksr2> <span class="item-icon" data-astro-cid-3ef6ksr2>ğŸ› ï¸</span>
Uses
</a> <a href="/now" class="dropdown-item" data-astro-cid-3ef6ksr2> <span class="item-icon" data-astro-cid-3ef6ksr2>â°</span>
Now
</a> <a href="/bookmarks" class="dropdown-item" data-astro-cid-3ef6ksr2> <span class="item-icon" data-astro-cid-3ef6ksr2>ğŸ”–</span>
Bookmarks
</a> <a href="/guestbook" class="dropdown-item" data-astro-cid-3ef6ksr2> <span class="item-icon" data-astro-cid-3ef6ksr2>ğŸ“</span>
Guestbook
</a> <div class="dropdown-divider" data-astro-cid-3ef6ksr2></div> <a href="/keys" class="dropdown-item" data-astro-cid-3ef6ksr2> <span class="item-icon" data-astro-cid-3ef6ksr2>ğŸ”</span>
GPG Keys
</a> <div class="dropdown-divider" data-astro-cid-3ef6ksr2></div> <!-- å¤–éƒ¨é“¾æ¥ --> <a href="https://github.com/LosFurina" target="_blank" rel="noopener" class="dropdown-item" data-astro-cid-3ef6ksr2> <span class="item-icon" data-astro-cid-3ef6ksr2>ğŸ“¦</span>
GitHub
<span class="external-icon" data-astro-cid-3ef6ksr2>â†—</span> </a> </div> </div> </div> <div class="nav-right" data-astro-cid-3ef6ksr2> <div class="social-links" data-astro-cid-3ef6ksr2> <a href="https://github.com/LosFurina" target="_blank" title="GitHub" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>GitHub</span> <svg viewBox="0 0 16 16" aria-hidden="true" data-astro-cid-3ef6ksr2> <path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-3ef6ksr2></path> </svg> </a> <a href="https://x.com/MicroNahida" target="_blank" rel="noopener" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>X (Twitter)</span> <svg viewBox="0 0 24 24" aria-hidden="true" data-astro-cid-3ef6ksr2> <path fill="currentColor" d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" data-astro-cid-3ef6ksr2></path> </svg> </a> </div> <button id="theme-toggle" aria-label="Toggle theme" data-astro-cid-x3pjskd3> <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-astro-cid-x3pjskd3> <circle cx="12" cy="12" r="5" data-astro-cid-x3pjskd3></circle> <line x1="12" y1="1" x2="12" y2="3" data-astro-cid-x3pjskd3></line> <line x1="12" y1="21" x2="12" y2="23" data-astro-cid-x3pjskd3></line> <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" data-astro-cid-x3pjskd3></line> <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" data-astro-cid-x3pjskd3></line> <line x1="1" y1="12" x2="3" y2="12" data-astro-cid-x3pjskd3></line> <line x1="21" y1="12" x2="23" y2="12" data-astro-cid-x3pjskd3></line> <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" data-astro-cid-x3pjskd3></line> <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" data-astro-cid-x3pjskd3></line> </svg> <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-astro-cid-x3pjskd3> <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" data-astro-cid-x3pjskd3></path> </svg> </button>  <script type="module">const t=()=>{const e=document.documentElement;e.getAttribute("data-theme")==="dark"?(e.setAttribute("data-theme","light"),e.classList.remove("dark"),localStorage.setItem("theme","light")):(e.setAttribute("data-theme","dark"),e.classList.add("dark"),localStorage.setItem("theme","dark"))};document.getElementById("theme-toggle")?.addEventListener("click",t);</script> <!-- Hamburger Menu Button (Mobile Only) --> <button class="hamburger" id="hamburgerBtn" aria-label="Toggle menu" data-astro-cid-3ef6ksr2> <span class="hamburger-line" data-astro-cid-3ef6ksr2></span> <span class="hamburger-line" data-astro-cid-3ef6ksr2></span> <span class="hamburger-line" data-astro-cid-3ef6ksr2></span> </button> </div> </nav> </header>  <script type="module">const n=document.querySelector("header");function c(){window.scrollY>10?n?.classList.add("scrolled"):n?.classList.remove("scrolled")}window.addEventListener("scroll",c,{passive:!0});c();const t=document.getElementById("hamburgerBtn"),o=document.getElementById("mobileMenu");t?.addEventListener("click",e=>{e.stopPropagation(),t.classList.toggle("open"),o?.classList.toggle("open")});o?.querySelectorAll("a").forEach(e=>{e.addEventListener("click",()=>{t?.classList.remove("open"),o?.classList.remove("open")})});const s=document.getElementById("toolsDropdown"),l=document.getElementById("toolsBtn");l?.addEventListener("click",e=>{e.stopPropagation(),s?.classList.toggle("open")});document.addEventListener("click",e=>{s?.contains(e.target)||s?.classList.remove("open"),!o?.contains(e.target)&&!t?.contains(e.target)&&(t?.classList.remove("open"),o?.classList.remove("open"))});document.addEventListener("keydown",e=>{e.key==="Escape"&&(s?.classList.remove("open"),t?.classList.remove("open"),o?.classList.remove("open"))});</script> <div class="blog-container" data-astro-cid-bvzihdzo> <aside class="toc-sidebar" data-astro-cid-bvzihdzo> <div class="toc-wrapper" data-astro-cid-bvzihdzo> <nav class="toc" aria-label="Table of Contents" data-astro-cid-xvrfupwn><h4 class="toc-title" data-astro-cid-xvrfupwn><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="16" height="16" data-astro-cid-xvrfupwn><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0ZM3.75 12h.007v.008H3.75V12Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm-.375 5.25h.007v.008H3.75v-.008Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" data-astro-cid-xvrfupwn></path></svg>
On this page
</h4><ul class="toc-list" data-astro-cid-xvrfupwn><li class="toc-item depth-2" data-astro-cid-xvrfupwn><a href="#èƒŒæ™¯ä¸ç›®æ ‡" class="toc-link" data-astro-cid-xvrfupwn>èƒŒæ™¯ä¸ç›®æ ‡</a></li><li class="toc-item depth-2" data-astro-cid-xvrfupwn><a href="#æ ¸å¿ƒå†…å®¹" class="toc-link" data-astro-cid-xvrfupwn>æ ¸å¿ƒå†…å®¹</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#ä¸»é¢˜-1-rustçš„æ™ºèƒ½æŒ‡é’ˆéƒ½æœ‰ä»€ä¹ˆåŒºåˆ«" class="toc-link" data-astro-cid-xvrfupwn>ä¸»é¢˜ 1. rustçš„æ™ºèƒ½æŒ‡é’ˆéƒ½æœ‰ä»€ä¹ˆåŒºåˆ«</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#1-boxt--æœ€çº¯ç²¹çš„å †æŒ‡é’ˆ" class="toc-link" data-astro-cid-xvrfupwn>1. Box&lt;T&gt; â€”â€” æœ€çº¯ç²¹çš„â€œå †æŒ‡é’ˆâ€</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#2-rct-vs-arct--å…±äº«ä¹‹é“è®¡æ•°ä¹‹æœ¯" class="toc-link" data-astro-cid-xvrfupwn>2. Rc&lt;T&gt; vs Arc&lt;T&gt; â€”â€” â€œå…±äº«ä¹‹é“ï¼Œè®¡æ•°ä¹‹æœ¯â€</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#3-refcellt-vs-cellt--çœ‹ä¼¼ä¸å¯å˜å®åˆ™æš—è—ç„æœº" class="toc-link" data-astro-cid-xvrfupwn>3. RefCell&lt;T&gt; vs Cell&lt;T&gt; â€”â€” â€œçœ‹ä¼¼ä¸å¯å˜ï¼Œå®åˆ™æš—è—ç„æœºâ€</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#4-mutext-vs-rwlockt--å¤šçº¿ç¨‹å®‰å…¨å¸¦é”ä¸Šé˜µ" class="toc-link" data-astro-cid-xvrfupwn>4. Mutex&lt;T&gt; vs RwLock&lt;T&gt; â€”â€” â€œå¤šçº¿ç¨‹å®‰å…¨ï¼Œå¸¦é”ä¸Šé˜µâ€</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#ä¸»é¢˜-2-åˆ›å»ºä¸€ä¸ªåŒå‘é“¾è¡¨å¹¶è·å–head-and-tail-pointer" class="toc-link" data-astro-cid-xvrfupwn>ä¸»é¢˜ 2. åˆ›å»ºä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå¹¶è·å–head and tail pointer</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#æœ€å°åŒå‘é“¾è¡¨å®ç°--è·å–-head-å’Œ-tail" class="toc-link" data-astro-cid-xvrfupwn>æœ€å°åŒå‘é“¾è¡¨å®ç° + è·å– head å’Œ tail</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#ä½¿ç”¨ç¤ºä¾‹" class="toc-link" data-astro-cid-xvrfupwn>ä½¿ç”¨ç¤ºä¾‹ï¼š</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#è¯´æ˜" class="toc-link" data-astro-cid-xvrfupwn>è¯´æ˜ï¼š</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#æ’æŸ¥åœºæ™¯-1-è¿™æ ·å®šä¹‰æœ‰ä»€ä¹ˆé—®é¢˜" class="toc-link" data-astro-cid-xvrfupwn>æ’æŸ¥åœºæ™¯ 1. è¿™æ ·å®šä¹‰æœ‰ä»€ä¹ˆé—®é¢˜</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#æ’æŸ¥åœºæ™¯-2-ä¸ºä»€ä¹ˆä¼šè¡Œç¨‹å¾ªç¯å¼•ç”¨è¯¦ç»†è§£é‡Šä¸€ä¸‹" class="toc-link" data-astro-cid-xvrfupwn>æ’æŸ¥åœºæ™¯ 2. ä¸ºä»€ä¹ˆä¼šè¡Œç¨‹å¾ªç¯å¼•ç”¨ï¼Œè¯¦ç»†è§£é‡Šä¸€ä¸‹</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#è§‚å¯Ÿå¼•ç”¨è®¡æ•°" class="toc-link" data-astro-cid-xvrfupwn>è§‚å¯Ÿå¼•ç”¨è®¡æ•°ï¼š</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#è¿™æ—¶" class="toc-link" data-astro-cid-xvrfupwn>è¿™æ—¶ï¼š</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#ä¸»é¢˜-3-ä¸ºä»€ä¹ˆrcè¿˜è¦åµŒå¥—ä¸€ä¸ªrefcell" class="toc-link" data-astro-cid-xvrfupwn>ä¸»é¢˜ 3. ä¸ºä»€ä¹ˆRcè¿˜è¦åµŒå¥—ä¸€ä¸ªRefCell</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#åœ¨-rust-ä¸­æœ‰ä¸¤æ¡é“å¾‹ç¼–è¯‘æ—¶å°±æ£€æŸ¥" class="toc-link" data-astro-cid-xvrfupwn>åœ¨ Rust ä¸­æœ‰ä¸¤æ¡é“å¾‹ï¼ˆç¼–è¯‘æ—¶å°±æ£€æŸ¥ï¼‰ï¼š</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#ä¸»é¢˜-4-let-shared--rcnew-data-value-42" class="toc-link" data-astro-cid-xvrfupwn>ä¸»é¢˜ 4. let shared = Rc::new Data value: 42â€¦</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#1ï¸âƒ£-mut-shared-çš„æ„æ€æ˜¯" class="toc-link" data-astro-cid-xvrfupwn>1ï¸âƒ£ mut shared çš„æ„æ€æ˜¯ï¼š</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#2ï¸âƒ£-è€Œä½ ä¸èƒ½è¿™ä¹ˆåš" class="toc-link" data-astro-cid-xvrfupwn>2ï¸âƒ£ è€Œä½ ä¸èƒ½è¿™ä¹ˆåšï¼š</a></li><li class="toc-item depth-2" data-astro-cid-xvrfupwn><a href="#æ€»ç»“" class="toc-link" data-astro-cid-xvrfupwn>æ€»ç»“</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#ä¸»é¢˜-5-rcæä¾›ä¸å¯å˜å¼•ç”¨é‚£boxå‘¢" class="toc-link" data-astro-cid-xvrfupwn>ä¸»é¢˜ 5. Rcæä¾›ä¸å¯å˜å¼•ç”¨ï¼Œé‚£Boxå‘¢</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#æ‰€ä»¥ä½ å¯ä»¥ç›´æ¥æ”¹-box-ä¸­çš„å€¼" class="toc-link" data-astro-cid-xvrfupwn>æ‰€ä»¥ä½ å¯ä»¥ç›´æ¥æ”¹ Box ä¸­çš„å€¼ï¼š</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#ä¸»é¢˜-6-é‚£æˆ‘ç†è§£çš„æ˜¯-let-mut-b--box-new-5-ä¸-let-b" class="toc-link" data-astro-cid-xvrfupwn>ä¸»é¢˜ 6. é‚£æˆ‘ç†è§£çš„æ˜¯ let mut b = Box new 5 ä¸ let bâ€¦</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#1ï¸âƒ£-let-mut-b-" class="toc-link" data-astro-cid-xvrfupwn>1ï¸âƒ£ let mut b = ...</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#2ï¸âƒ£-let-b-" class="toc-link" data-astro-cid-xvrfupwn>2ï¸âƒ£ let b = ...</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#ä¸»é¢˜-7-æœ‰ä»€ä¹ˆåŒºåˆ«" class="toc-link" data-astro-cid-xvrfupwn>ä¸»é¢˜ 7. æœ‰ä»€ä¹ˆåŒºåˆ«</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#boxt-çš„ç‰¹ç‚¹" class="toc-link" data-astro-cid-xvrfupwn>Box&lt;T&gt; çš„ç‰¹ç‚¹ï¼š</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#rct-çš„ç‰¹ç‚¹" class="toc-link" data-astro-cid-xvrfupwn>Rc&lt;T&gt; çš„ç‰¹ç‚¹ï¼š</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#ä¸»é¢˜-8-ä¸ºä»€ä¹ˆè¿™é‡Œåˆä¸ç”¨mutäº†" class="toc-link" data-astro-cid-xvrfupwn>ä¸»é¢˜ 8. ä¸ºä»€ä¹ˆè¿™é‡Œåˆä¸ç”¨mutäº†</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#1ï¸âƒ£-rcrefcellt-æ˜¯ä¸¤ä¸ªä¸œè¥¿å åœ¨ä¸€èµ·" class="toc-link" data-astro-cid-xvrfupwn>1ï¸âƒ£ Rc&lt;RefCell&lt;T&gt;&gt; æ˜¯ä¸¤ä¸ªä¸œè¥¿å åœ¨ä¸€èµ·ï¼š</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#mut-x-çš„æ„æ€æ˜¯æˆ‘å¯ä»¥æ”¹å˜å˜é‡ç»‘å®š-x-æœ¬èº«" class="toc-link" data-astro-cid-xvrfupwn>mut x çš„æ„æ€æ˜¯ï¼šâ€œæˆ‘å¯ä»¥æ”¹å˜å˜é‡ç»‘å®š x æœ¬èº«â€</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#ï¸-å€Ÿç”¨è§„åˆ™è¿˜æ˜¯åœ¨çš„åªä¸è¿‡åœ¨è¿è¡Œæ—¶è€Œéç¼–è¯‘æ—¶æ£€æŸ¥" class="toc-link" data-astro-cid-xvrfupwn>ï¸ å€Ÿç”¨è§„åˆ™è¿˜æ˜¯åœ¨çš„ï¼Œåªä¸è¿‡åœ¨è¿è¡Œæ—¶è€Œéç¼–è¯‘æ—¶æ£€æŸ¥ã€‚</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#ä¸»é¢˜-9-refcellåœ¨æˆ‘æ‹¿åˆ°ä¸€ä¸ªä¸å¯å˜å¼•ç”¨è¿˜å¯ä»¥ä¿®æ”¹å²‚ä¸æ˜¯è¿åäº†è§„åˆ™" class="toc-link" data-astro-cid-xvrfupwn>ä¸»é¢˜ 9. RefCellåœ¨æˆ‘æ‹¿åˆ°ä¸€ä¸ªä¸å¯å˜å¼•ç”¨è¿˜å¯ä»¥ä¿®æ”¹ï¼Œå²‚ä¸æ˜¯è¿åäº†è§„åˆ™</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#å†…éƒ¨å¯å˜æ€§interior-mutability" class="toc-link" data-astro-cid-xvrfupwn>â€œå†…éƒ¨å¯å˜æ€§ï¼ˆInterior Mutabilityï¼‰â€</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#ä¸»é¢˜-10-é‚£rcrefcellt-å’Œboxrefcellt-æœ‰ä»€ä¹ˆåŒºåˆ«" class="toc-link" data-astro-cid-xvrfupwn>ä¸»é¢˜ 10. é‚£Rc&lt;RefCell&lt;T å’ŒBox&lt;RefCell&lt;T æœ‰ä»€ä¹ˆåŒºåˆ«</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#boxrefcell-ç¤ºä¾‹" class="toc-link" data-astro-cid-xvrfupwn>Box&lt;RefCell&gt; ç¤ºä¾‹</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#rcrefcell-ç¤ºä¾‹" class="toc-link" data-astro-cid-xvrfupwn>Rc&lt;RefCell&gt; ç¤ºä¾‹</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#æ’æŸ¥åœºæ™¯-3-rustçš„try-intoå’Œintoæœ‰ä»€ä¹ˆç”¨" class="toc-link" data-astro-cid-xvrfupwn>æ’æŸ¥åœºæ™¯ 3. rustçš„try intoå’Œintoæœ‰ä»€ä¹ˆç”¨</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#èƒŒåå®ç°çš„æ˜¯fromt-for-u-å’Œ-intou-for-t" class="toc-link" data-astro-cid-xvrfupwn>èƒŒåå®ç°çš„æ˜¯ï¼šFrom&lt;T&gt; for U å’Œ Into&lt;U&gt; for T</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#èƒŒåå®ç°çš„æ˜¯tryfromt-for-u-å’Œ-tryintou-for-t" class="toc-link" data-astro-cid-xvrfupwn>èƒŒåå®ç°çš„æ˜¯ï¼šTryFrom&lt;T&gt; for U å’Œ TryInto&lt;U&gt; for T</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#into-ç¤ºä¾‹string---vec" class="toc-link" data-astro-cid-xvrfupwn>into() ç¤ºä¾‹ï¼šString -&gt; Vec</a></li><li class="toc-item depth-3" data-astro-cid-xvrfupwn><a href="#try_into-ç¤ºä¾‹string---æ•°å­—" class="toc-link" data-astro-cid-xvrfupwn>try_into() ç¤ºä¾‹ï¼šString -&gt; æ•°å­—</a></li><li class="toc-item depth-2" data-astro-cid-xvrfupwn><a href="#å®æ–½ä¸éªŒè¯æ¸…å•" class="toc-link" data-astro-cid-xvrfupwn>å®æ–½ä¸éªŒè¯æ¸…å•</a></li></ul></nav><script type="module">const i=new IntersectionObserver(e=>{e.forEach(t=>{const c=t.target.getAttribute("id"),r=document.querySelector(`.toc-link[href="#${c}"]`);t.isIntersecting&&(document.querySelectorAll(".toc-link.active").forEach(o=>{o.classList.remove("active")}),r?.classList.add("active"))})},{rootMargin:"-80px 0px -80% 0px",threshold:0});document.querySelectorAll("article h2[id], article h3[id]").forEach(e=>{i.observe(e)});</script> </div> </aside> <main data-astro-cid-bvzihdzo> <article data-astro-cid-bvzihdzo>  <header class="article-header" data-astro-cid-bvzihdzo> <h1 class="article-title" data-astro-cid-bvzihdzo>Rust æ™ºèƒ½æŒ‡é’ˆåŒºåˆ«</h1> <div class="article-meta" data-astro-cid-bvzihdzo>  <time datetime="2025-06-29T00:00:00.000Z"> Jun 28, 2025 </time> <span class="meta-divider" data-astro-cid-bvzihdzo></span> <span class="reading-time" data-astro-cid-rafwukvt> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="16" height="16" data-astro-cid-rafwukvt> <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" data-astro-cid-rafwukvt></path> </svg> 33 min read
</span>   <span class="meta-divider" data-astro-cid-bvzihdzo></span> <span class="last-updated" data-astro-cid-bvzihdzo>
Updated  <time datetime="2026-02-13T00:00:00.000Z"> Feb 12, 2026 </time> </span>  </div> </header> <div class="article-content" data-astro-cid-bvzihdzo>  <h2 id="èƒŒæ™¯ä¸ç›®æ ‡">èƒŒæ™¯ä¸ç›®æ ‡</h2>
<p>æœ¬æ–‡å›´ç»•â€œrustçš„æ™ºèƒ½æŒ‡é’ˆéƒ½æœ‰ä»€ä¹ˆåŒºåˆ«â€å±•å¼€ï¼Œæ•´ç†å¯ç›´æ¥å¤ç”¨çš„æ­¥éª¤ã€åŸç†è¯´æ˜ä¸æ’æŸ¥ç»éªŒã€‚</p>
<h2 id="æ ¸å¿ƒå†…å®¹">æ ¸å¿ƒå†…å®¹</h2>
<h3 id="ä¸»é¢˜-1-rustçš„æ™ºèƒ½æŒ‡é’ˆéƒ½æœ‰ä»€ä¹ˆåŒºåˆ«">ä¸»é¢˜ 1. rustçš„æ™ºèƒ½æŒ‡é’ˆéƒ½æœ‰ä»€ä¹ˆåŒºåˆ«</h3>
<p>Rust çš„æ™ºèƒ½æŒ‡é’ˆå¯ä»¥è¯´æ˜¯å®ƒå†…å­˜å®‰å…¨å’Œé›¶æˆæœ¬æŠ½è±¡çš„çµé­‚ç»„ä»¶ä¹‹ä¸€ã€‚è™½ç„¶ä½ å¯èƒ½ä¼šè§‰å¾—â€œéƒ½æ˜¯æŒ‡é’ˆï¼Œæœ‰å•¥å¥½åŒºåˆ†çš„ã€‚â€ï¼Œä½†å®ƒä»¬åœ¨ç”¨é€”ã€æ‰€æœ‰æƒè¯­ä¹‰ã€æ€§èƒ½å¼€é”€ä¸Šå„æœ‰ä¹¾å¤ï¼Œå°±åƒæ˜¯æ±Ÿæ¹–ä¸­çš„å„é—¨æ´¾é«˜æ‰‹â€”â€”çœ‹ä¼¼éƒ½èƒ½æ‰“ï¼Œå®åˆ™æ‹›å¼å®Œå…¨ä¸åŒã€‚</p>
<p>å¸¸è§çš„æ™ºèƒ½æŒ‡é’ˆï¼ˆæŒ‰ç”¨é€”åˆ†ç±»ï¼‰ï¼š</p>


















































<table><thead><tr><th>æ™ºèƒ½æŒ‡é’ˆ</th><th>ç‰¹ç‚¹</th><th>å¸¸ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><code>Box&#x3C;T></code></td><td>åˆ†é…åœ¨å †ä¸Šï¼Œæ‹¥æœ‰æ‰€æœ‰æƒ</td><td>å¤§å¯¹è±¡å †åˆ†é…ã€é€’å½’ç±»å‹</td></tr><tr><td><code>Rc&#x3C;T></code></td><td>å¤šæ‰€æœ‰è€…è®¡æ•°ï¼ˆå•çº¿ç¨‹ï¼‰</td><td>å•çº¿ç¨‹å…±äº«ä¸å¯å˜æ•°æ®</td></tr><tr><td><code>Arc&#x3C;T></code></td><td>åŸå­å¼•ç”¨è®¡æ•°ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰</td><td>å¤šçº¿ç¨‹å…±äº«ä¸å¯å˜æ•°æ®</td></tr><tr><td><code>RefCell&#x3C;T></code></td><td>å†…éƒ¨å¯å˜æ€§ï¼ˆè¿è¡Œæ—¶å€Ÿç”¨æ£€æŸ¥ï¼‰</td><td>å•çº¿ç¨‹ä¸‹å®ç°å¯å˜å€Ÿç”¨</td></tr><tr><td><code>Cell&#x3C;T></code></td><td>ç®€å•å†…éƒ¨å¯å˜æ€§ï¼ˆå¤åˆ¶è¯­ä¹‰ï¼‰</td><td>å°æ•°æ®ç±»å‹çš„å†…éƒ¨ä¿®æ”¹</td></tr><tr><td><code>Mutex&#x3C;T></code></td><td>å¤šçº¿ç¨‹ä¸‹çš„äº’æ–¥è®¿é—®</td><td>å¤šçº¿ç¨‹å¯å˜å…±äº«æ•°æ®</td></tr><tr><td><code>RwLock&#x3C;T></code></td><td>å¤šçº¿ç¨‹ä¸‹çš„è¯»å†™é”</td><td>å¤šè¯»å°‘å†™åœºæ™¯</td></tr><tr><td><code>UnsafeCell&#x3C;T></code></td><td>æ‰€æœ‰å†…éƒ¨å¯å˜æ€§çš„åŸºçŸ³</td><td>ç¼–å†™åº•å±‚åº“æ—¶çš„é»‘ç§‘æŠ€</td></tr></tbody></table>
<p>å®ƒä»¬åˆ°åº•æœ‰å•¥åŒºåˆ«ã€‚</p>
<h3 id="1-boxt--æœ€çº¯ç²¹çš„å †æŒ‡é’ˆ">1. <code>Box&#x3C;T></code> â€”â€” æœ€çº¯ç²¹çš„â€œå †æŒ‡é’ˆâ€</h3>
<ul>
<li>ç±»ä¼¼ C++ çš„ <code>unique_ptr&#x3C;T></code>ï¼Œä½†æ›´å®‰å…¨ã€‚</li>
<li><strong>ç”¨é€”</strong>ï¼šæŠŠå¤§å¯¹è±¡æˆ–è€…é€’å½’ç±»å‹ï¼ˆæ¯”å¦‚é“¾è¡¨ï¼‰ä¸¢åˆ°å †ä¸Šã€‚</li>
<li><strong>é™åˆ¶</strong>ï¼šåªæœ‰ä¸€ä¸ªæ‰€æœ‰è€…ï¼Œä¸èƒ½å…‹éš†ï¼Œä¸å¯å…±äº«ã€‚</li>
</ul>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> b </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Box</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">);</span></span></code></pre>
<h3 id="2-rct-vs-arct--å…±äº«ä¹‹é“è®¡æ•°ä¹‹æœ¯">2. <code>Rc&#x3C;T></code> vs <code>Arc&#x3C;T></code> â€”â€” â€œå…±äº«ä¹‹é“ï¼Œè®¡æ•°ä¹‹æœ¯â€</h3>
<ul>
<li><code>Rc&#x3C;T></code>ï¼š<strong>å•çº¿ç¨‹å…±äº«</strong>å¼•ç”¨è®¡æ•°ï¼Œçº¿ç¨‹é—´ä¸èƒ½ç”¨ã€‚</li>
<li><code>Arc&#x3C;T></code>ï¼š<strong>å¤šçº¿ç¨‹å…±äº«</strong>ç‰ˆæœ¬ï¼Œè®¡æ•°æ˜¯åŸå­æ“ä½œï¼Œçº¿ç¨‹å®‰å…¨ä½†æ…¢ä¸€ç‚¹ã€‚</li>
</ul>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">use</span><span style="color:#B392F0"> std</span><span style="color:#F97583">::</span><span style="color:#B392F0">rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">Rc</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> a </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">String</span><span style="color:#F97583">::</span><span style="color:#B392F0">from</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"hello"</span><span style="color:#E1E4E8">));</span></span>
<span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> b </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">clone</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">&#x26;</span><span style="color:#E1E4E8">a);</span></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">use</span><span style="color:#B392F0"> std</span><span style="color:#F97583">::</span><span style="color:#B392F0">sync</span><span style="color:#F97583">::</span><span style="color:#B392F0">Arc</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> a </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Arc</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">String</span><span style="color:#F97583">::</span><span style="color:#B392F0">from</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"hello"</span><span style="color:#E1E4E8">));</span></span>
<span class="line"><span style="color:#6A737D">// å¯ç”¨äºçº¿ç¨‹é—´ä¼ é€’</span></span></code></pre>
<h3 id="3-refcellt-vs-cellt--çœ‹ä¼¼ä¸å¯å˜å®åˆ™æš—è—ç„æœº">3. <code>RefCell&#x3C;T></code> vs <code>Cell&#x3C;T></code> â€”â€” â€œçœ‹ä¼¼ä¸å¯å˜ï¼Œå®åˆ™æš—è—ç„æœºâ€</h3>
<blockquote>
<p>å®ƒä»¬å®ç°â€œå†…éƒ¨å¯å˜æ€§â€ï¼Œç»•è¿‡ Rust çš„ç¼–è¯‘æœŸå€Ÿç”¨æ£€æŸ¥ã€‚</p>
</blockquote>
<ul>
<li><code>RefCell&#x3C;T></code>ï¼šè¿è¡Œæ—¶æ£€æŸ¥å€Ÿç”¨è§„åˆ™ï¼Œæ”¯æŒå¤šä¸ªä¸å¯å˜/ä¸€ä¸ªå¯å˜å¼•ç”¨ã€‚</li>
<li><code>Cell&#x3C;T></code>ï¼šåªæ”¯æŒå¤åˆ¶ç±»å‹çš„ get/setï¼Œæ— æ³•è¿”å›å¼•ç”¨ã€‚</li>
</ul>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">use</span><span style="color:#B392F0"> std</span><span style="color:#F97583">::</span><span style="color:#B392F0">cell</span><span style="color:#F97583">::</span><span style="color:#B392F0">RefCell</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> data </span><span style="color:#F97583">=</span><span style="color:#B392F0"> RefCell</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">vec!</span><span style="color:#E1E4E8">[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">]);</span></span>
<span class="line"><span style="color:#E1E4E8">data</span><span style="color:#F97583">.</span><span style="color:#B392F0">borrow_mut</span><span style="color:#E1E4E8">()</span><span style="color:#F97583">.</span><span style="color:#B392F0">push</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">);</span></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">use</span><span style="color:#B392F0"> std</span><span style="color:#F97583">::</span><span style="color:#B392F0">cell</span><span style="color:#F97583">::</span><span style="color:#B392F0">Cell</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> x </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Cell</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">x</span><span style="color:#F97583">.</span><span style="color:#B392F0">set</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">); </span><span style="color:#6A737D">// æ²¡ borrowï¼Œç›´æ¥è¦†ç›–</span></span></code></pre>
<h3 id="4-mutext-vs-rwlockt--å¤šçº¿ç¨‹å®‰å…¨å¸¦é”ä¸Šé˜µ">4. <code>Mutex&#x3C;T></code> vs <code>RwLock&#x3C;T></code> â€”â€” â€œå¤šçº¿ç¨‹å®‰å…¨ï¼Œå¸¦é”ä¸Šé˜µâ€</h3>
<ul>
<li><code>Mutex&#x3C;T></code>ï¼šä¸€æ¬¡åªèƒ½ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼ˆå¯å˜/ä¸å¯å˜éƒ½ä¸€æ ·ï¼‰</li>
<li><code>RwLock&#x3C;T></code>ï¼šå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è¯»ï¼Œä½†å†™å¿…é¡»ç‹¬å </li>
</ul>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">use</span><span style="color:#B392F0"> std</span><span style="color:#F97583">::</span><span style="color:#B392F0">sync</span><span style="color:#F97583">::</span><span style="color:#B392F0">Mutex</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> data </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Mutex</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#F97583">    let</span><span style="color:#F97583"> mut</span><span style="color:#E1E4E8"> num </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> data</span><span style="color:#F97583">.</span><span style="color:#B392F0">lock</span><span style="color:#E1E4E8">()</span><span style="color:#F97583">.</span><span style="color:#B392F0">unwrap</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">    *</span><span style="color:#E1E4E8">num </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>æ€»ç»“å£è¯€ï¼ˆæ–¹ä¾¿è®°å¿†ï¼‰ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Box å †ä¸Šåˆ†é…å¿«ï¼Œå•äººç‹¬èˆä¸å®¹æ’ï¼›</span></span>
<span class="line"><span>Rc å¤šäººå…±äº«ä¸å¯å˜ï¼Œçº¿ç¨‹ä¹‹ä¸­åˆ«ä¹±æ‹¿ï¼›</span></span>
<span class="line"><span>Arc å¤šçº¿ç¨‹å…±äº«é¦™ï¼Œä½†æ…¢ä¸€ç‚¹è¦ä»£ä»·ï¼›</span></span>
<span class="line"><span>RefCell çœ‹ä¼¼ä¸å¯å˜ï¼Œè¿è¡Œå€Ÿç”¨èƒ½å˜åŒ–ï¼›</span></span>
<span class="line"><span>Cell å¿«é€Ÿæ›¿æ¢å°ç©æ„ï¼Œä¸è¿”å›å¼•ç”¨é  copyï¼›</span></span>
<span class="line"><span>Mutex é”å®šæ•´ä¸ªç©å…·ç®±ï¼›</span></span>
<span class="line"><span>RwLock åˆ†å¼€è¯»å†™ä¸æ‰“æ¶ã€‚</span></span></code></pre>
<p>å¦‚æœä½ å‘Šè¯‰æˆ‘ä½ è¦åœ¨å“ªç§åœºæ™¯ä¸‹ç”¨æŒ‡é’ˆï¼ˆæ¯”å¦‚æ„å»ºå›¾ç»“æ„ã€çº¿ç¨‹å…±äº«ã€æˆ–å®ç°ç¼“å­˜ï¼‰ï¼Œæˆ‘å¯ä»¥å¸®ä½ å…·ä½“æ¨èé€‚åˆç”¨å“ªä¸ªã€‚æ€»ä¹‹ï¼Œè¿™äº›æ™ºèƒ½æŒ‡é’ˆå°±åƒã€Šç¬‘å‚²æ±Ÿæ¹–ã€‹é‡Œçš„å„å¤§é—¨æ´¾â€”â€”å„æœ‰æ‹›æ•°ï¼Œç”¨å¥½äº†å°±æ˜¯é™é¾™åå…«æŒã€‚</p>
<h3 id="ä¸»é¢˜-2-åˆ›å»ºä¸€ä¸ªåŒå‘é“¾è¡¨å¹¶è·å–head-and-tail-pointer">ä¸»é¢˜ 2. åˆ›å»ºä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå¹¶è·å–head and tail pointer</h3>
<p>å½“ç„¶å¯ä»¥ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ Rust ä»é›¶æ‰‹å†™ä¸€ä¸ªç®€å•çš„ <strong>åŒå‘é“¾è¡¨ï¼ˆDoubly Linked Listï¼‰</strong>ï¼Œç„¶åå®ç° <strong><code>head</code> å’Œ <code>tail</code> æŒ‡é’ˆçš„è·å–</strong>ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªæœ€å°ä½†å®Œæ•´å¯è¿è¡Œçš„ä¾‹å­ï¼Œæ³¨é‡Šå¾ˆå…¨ï¼š</p>
<h3 id="æœ€å°åŒå‘é“¾è¡¨å®ç°--è·å–-head-å’Œ-tail">æœ€å°åŒå‘é“¾è¡¨å®ç° + è·å– <code>head</code> å’Œ <code>tail</code></h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">use</span><span style="color:#B392F0"> std</span><span style="color:#F97583">::</span><span style="color:#B392F0">cell</span><span style="color:#F97583">::</span><span style="color:#E1E4E8">{</span><span style="color:#B392F0">RefCell</span><span style="color:#E1E4E8">};</span></span>
<span class="line"><span style="color:#F97583">use</span><span style="color:#B392F0"> std</span><span style="color:#F97583">::</span><span style="color:#B392F0">rc</span><span style="color:#F97583">::</span><span style="color:#E1E4E8">{</span><span style="color:#B392F0">Rc</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">Weak</span><span style="color:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">type</span><span style="color:#B392F0"> Link</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">> </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Option</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Rc</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">RefCell</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Node</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">>>>>;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">struct</span><span style="color:#B392F0"> Node</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">> {</span></span>
<span class="line"><span style="color:#E1E4E8">    value</span><span style="color:#F97583">:</span><span style="color:#B392F0"> T</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    prev</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Option</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Weak</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">RefCell</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Node</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">>>>>,</span></span>
<span class="line"><span style="color:#E1E4E8">    next</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Link</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">>,</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">pub</span><span style="color:#F97583"> struct</span><span style="color:#B392F0"> DoublyLinkedList</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">> {</span></span>
<span class="line"><span style="color:#E1E4E8">    head</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Link</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">>,</span></span>
<span class="line"><span style="color:#E1E4E8">    tail</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Link</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">>,</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">impl</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">> </span><span style="color:#B392F0">DoublyLinkedList</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">> {</span></span>
<span class="line"><span style="color:#F97583">    pub</span><span style="color:#F97583"> fn</span><span style="color:#B392F0"> new</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">-></span><span style="color:#79B8FF"> Self</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">        DoublyLinkedList</span><span style="color:#E1E4E8"> { head</span><span style="color:#F97583">:</span><span style="color:#B392F0"> None</span><span style="color:#E1E4E8">, tail</span><span style="color:#F97583">:</span><span style="color:#B392F0"> None</span><span style="color:#E1E4E8"> }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    pub</span><span style="color:#F97583"> fn</span><span style="color:#B392F0"> push_back</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">&#x26;mut</span><span style="color:#79B8FF"> self</span><span style="color:#E1E4E8">, value</span><span style="color:#F97583">:</span><span style="color:#B392F0"> T</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        let</span><span style="color:#E1E4E8"> new_node </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">RefCell</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">Node</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">            value,</span></span>
<span class="line"><span style="color:#E1E4E8">            prev</span><span style="color:#F97583">:</span><span style="color:#B392F0"> None</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">            next</span><span style="color:#F97583">:</span><span style="color:#B392F0"> None</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">        }));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">        match</span><span style="color:#79B8FF"> self</span><span style="color:#F97583">.</span><span style="color:#E1E4E8">tail</span><span style="color:#F97583">.</span><span style="color:#B392F0">take</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#B392F0">            Some</span><span style="color:#E1E4E8">(old_tail) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">                old_tail</span><span style="color:#F97583">.</span><span style="color:#B392F0">borrow_mut</span><span style="color:#E1E4E8">()</span><span style="color:#F97583">.</span><span style="color:#E1E4E8">next </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Some</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">Rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">clone</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">&#x26;</span><span style="color:#E1E4E8">new_node));</span></span>
<span class="line"><span style="color:#E1E4E8">                new_node</span><span style="color:#F97583">.</span><span style="color:#B392F0">borrow_mut</span><span style="color:#E1E4E8">()</span><span style="color:#F97583">.</span><span style="color:#E1E4E8">prev </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Some</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">Rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">downgrade</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">&#x26;</span><span style="color:#E1E4E8">old_tail));</span></span>
<span class="line"><span style="color:#79B8FF">                self</span><span style="color:#F97583">.</span><span style="color:#E1E4E8">tail </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Some</span><span style="color:#E1E4E8">(new_node);</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#B392F0">            None</span><span style="color:#F97583"> =></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">                // é“¾è¡¨ä¸ºç©ºï¼Œhead å’Œ tail éƒ½æ˜¯æ–°èŠ‚ç‚¹</span></span>
<span class="line"><span style="color:#79B8FF">                self</span><span style="color:#F97583">.</span><span style="color:#E1E4E8">head </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Some</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">Rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">clone</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">&#x26;</span><span style="color:#E1E4E8">new_node));</span></span>
<span class="line"><span style="color:#79B8FF">                self</span><span style="color:#F97583">.</span><span style="color:#E1E4E8">tail </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Some</span><span style="color:#E1E4E8">(new_node);</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    pub</span><span style="color:#F97583"> fn</span><span style="color:#B392F0"> head</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">&#x26;</span><span style="color:#79B8FF">self</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">-></span><span style="color:#B392F0"> Option</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Rc</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">RefCell</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Node</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">>>>> {</span></span>
<span class="line"><span style="color:#79B8FF">        self</span><span style="color:#F97583">.</span><span style="color:#E1E4E8">head</span><span style="color:#F97583">.</span><span style="color:#B392F0">as_ref</span><span style="color:#E1E4E8">()</span><span style="color:#F97583">.</span><span style="color:#B392F0">map</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">Rc</span><span style="color:#F97583">::</span><span style="color:#E1E4E8">clone)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    pub</span><span style="color:#F97583"> fn</span><span style="color:#B392F0"> tail</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">&#x26;</span><span style="color:#79B8FF">self</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">-></span><span style="color:#B392F0"> Option</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Rc</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">RefCell</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Node</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">>>>> {</span></span>
<span class="line"><span style="color:#79B8FF">        self</span><span style="color:#F97583">.</span><span style="color:#E1E4E8">tail</span><span style="color:#F97583">.</span><span style="color:#B392F0">as_ref</span><span style="color:#E1E4E8">()</span><span style="color:#F97583">.</span><span style="color:#B392F0">map</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">Rc</span><span style="color:#F97583">::</span><span style="color:#E1E4E8">clone)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="ä½¿ç”¨ç¤ºä¾‹">ä½¿ç”¨ç¤ºä¾‹ï¼š</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">fn</span><span style="color:#B392F0"> main</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">    let</span><span style="color:#F97583"> mut</span><span style="color:#E1E4E8"> list </span><span style="color:#F97583">=</span><span style="color:#B392F0"> DoublyLinkedList</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    list</span><span style="color:#F97583">.</span><span style="color:#B392F0">push_back</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    list</span><span style="color:#F97583">.</span><span style="color:#B392F0">push_back</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">20</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    list</span><span style="color:#F97583">.</span><span style="color:#B392F0">push_back</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">30</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#F97583"> let</span><span style="color:#B392F0"> Some</span><span style="color:#E1E4E8">(head) </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> list</span><span style="color:#F97583">.</span><span style="color:#B392F0">head</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#B392F0">        println!</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Head: {}"</span><span style="color:#E1E4E8">, head</span><span style="color:#F97583">.</span><span style="color:#B392F0">borrow</span><span style="color:#E1E4E8">()</span><span style="color:#F97583">.</span><span style="color:#E1E4E8">value); </span><span style="color:#6A737D">// è¾“å‡º 10</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#F97583"> let</span><span style="color:#B392F0"> Some</span><span style="color:#E1E4E8">(tail) </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> list</span><span style="color:#F97583">.</span><span style="color:#B392F0">tail</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#B392F0">        println!</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Tail: {}"</span><span style="color:#E1E4E8">, tail</span><span style="color:#F97583">.</span><span style="color:#B392F0">borrow</span><span style="color:#E1E4E8">()</span><span style="color:#F97583">.</span><span style="color:#E1E4E8">value); </span><span style="color:#6A737D">// è¾“å‡º 30</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="è¯´æ˜">è¯´æ˜ï¼š</h3>
<ul>
<li>æˆ‘ä»¬ç”¨ <code>Rc&#x3C;RefCell&#x3C;Node&#x3C;T>>></code> è®©å¤šä¸ªèŠ‚ç‚¹å…±äº«å¼•ç”¨ï¼ŒåŒæ—¶èƒ½å†…éƒ¨å¯å˜ï¼›</li>
<li><code>prev</code> ä½¿ç”¨ <code>Weak</code>ï¼Œé¿å…å¾ªç¯å¼•ç”¨ï¼›</li>
<li><code>head</code> å’Œ <code>tail</code> æ˜¯é“¾è¡¨ä¸¤ç«¯çš„èŠ‚ç‚¹ï¼›</li>
<li><code>push_back</code> å¾€é“¾è¡¨æœ«å°¾åŠ èŠ‚ç‚¹ï¼›</li>
<li><code>head()</code> å’Œ <code>tail()</code> åˆ†åˆ«è¿”å›æŒ‡å‘å¤´å°¾èŠ‚ç‚¹çš„ Rc å¼•ç”¨ã€‚</li>
</ul>
<p>å¦‚æœä½ æƒ³åŠ ä¸Š <code>pop_front</code>ã€<code>pop_back</code>ã€<code>iter</code> ç­‰åŠŸèƒ½ï¼Œæˆ–è€…æ”¯æŒæ³›å‹ä¸­ <code>Copy</code> çš„è¯ï¼Œå¯ä»¥ç»§ç»­æ‰©å±•è¿™ä¸ªç»“æ„ã€‚éœ€è¦æˆ‘ç»§ç»­è¡¥å…¨é“¾è¡¨åŠŸèƒ½ä¹Ÿå¯ä»¥è¯´ã€‚</p>
<h3 id="æ’æŸ¥åœºæ™¯-1-è¿™æ ·å®šä¹‰æœ‰ä»€ä¹ˆé—®é¢˜">æ’æŸ¥åœºæ™¯ 1. è¿™æ ·å®šä¹‰æœ‰ä»€ä¹ˆé—®é¢˜</h3>
<ul>
<li>åœºæ™¯ï¼šè¿™æ ·å®šä¹‰æœ‰ä»€ä¹ˆé—®é¢˜</li>
<li>å¤„ç†è¦ç‚¹ï¼š<br>
ä½ è¿™ä¸ªå®šä¹‰ï¼š</li>
</ul>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">struct</span><span style="color:#B392F0"> Node</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    key</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Option</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">i32</span><span style="color:#E1E4E8">>,</span></span>
<span class="line"><span style="color:#E1E4E8">    val</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Option</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">i32</span><span style="color:#E1E4E8">>,</span></span>
<span class="line"><span style="color:#E1E4E8">    prev</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Option</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Box</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Node</span><span style="color:#E1E4E8">>>,</span></span>
<span class="line"><span style="color:#E1E4E8">    next</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Option</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Box</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Node</span><span style="color:#E1E4E8">>>,</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>é—®é¢˜å¾ˆå¤§ï¼Œè€Œä¸”ç¼–è¯‘å™¨ä¼šç›´æ¥æŠ¥é”™ã€‚</strong></p>
<p>åŸå› ï¼šé€’å½’ç»“æ„å¯¼è‡´â€œæ— é™å¤§å°â€ â€”â€” Rust æ— æ³•æ¨æ–­å¤§å°</p>
<p>ä½ è¿™ä¸ªç»“æ„æ˜¯ä¸€ä¸ªé€’å½’å®šä¹‰çš„ç»“æ„ä½“ï¼Œå®ƒåœ¨ <code>prev</code> å’Œ <code>next</code> å­—æ®µé‡ŒåˆåµŒå¥—äº† <code>Box&#x3C;Node></code>ï¼Œè¿™æ ·æ²¡é”™æ˜¯ä¸ºäº†å®ç°é“¾è¡¨çš„â€œå‰åæŒ‡é’ˆâ€ï¼Œ<strong>ä½†é—®é¢˜æ˜¯</strong>ï¼š</p>
<blockquote>
<p><strong>ä½ åŒæ—¶ç”¨äº†ä¸¤ä¸ª <code>Box&#x3C;Node></code>ï¼Œè€Œä¸æ˜¯é€šè¿‡æ™ºèƒ½å¼•ç”¨é¿å…â€œç»“æ„è‡ªåŒ…å«â€çš„é—®é¢˜ã€‚</strong></p>
</blockquote>
<p>Rust åœ¨ç¼–è¯‘æœŸè¦æ±‚æ‰€æœ‰ç±»å‹çš„å¤§å°æ˜¯ç¡®å®šçš„ï¼ˆ<code>Sized</code> traitï¼‰ï¼Œä½†è¿™ç§å®šä¹‰æ–¹å¼ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">struct</span><span style="color:#B392F0"> Node</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    prev</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Option</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Box</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Node</span><span style="color:#E1E4E8">>>,</span></span>
<span class="line"><span style="color:#E1E4E8">    next</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Option</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Box</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Node</span><span style="color:#E1E4E8">>>,</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>åœ¨å•å‘é“¾è¡¨é‡Œï¼Œåªæœ‰ <code>next</code> æ˜¯ <code>Box&#x3C;Node></code>ï¼Œç¼–è¯‘å™¨è¿˜èƒ½å¤„ç†ï¼›ä½†ä½ è¿™é‡Œæ˜¯ <strong>åŒå‘é“¾è¡¨</strong>ï¼Œå‰åéƒ½æœ‰ <code>Box&#x3C;Node></code>ï¼Œå¯¼è‡´é“¾è¡¨ç»“æ„æ˜¯ <strong>åŒé‡åµŒå¥—é€’å½’å¼•ç”¨</strong>ï¼Œæœ€ç»ˆæ— æ³•åœ¨æ ˆä¸Šè®¡ç®—å¤§å°ã€‚</p>
<p>æ­£ç¡®åšæ³•ï¼šä½¿ç”¨ <code>Rc&#x3C;RefCell&#x3C;Node>></code> å’Œ <code>Weak</code> æ‰“ç ´å¾ªç¯å¼•ç”¨</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">use</span><span style="color:#B392F0"> std</span><span style="color:#F97583">::</span><span style="color:#B392F0">rc</span><span style="color:#F97583">::</span><span style="color:#E1E4E8">{</span><span style="color:#B392F0">Rc</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">Weak</span><span style="color:#E1E4E8">};</span></span>
<span class="line"><span style="color:#F97583">use</span><span style="color:#B392F0"> std</span><span style="color:#F97583">::</span><span style="color:#B392F0">cell</span><span style="color:#F97583">::</span><span style="color:#B392F0">RefCell</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">struct</span><span style="color:#B392F0"> Node</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    key</span><span style="color:#F97583">:</span><span style="color:#B392F0"> i32</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    val</span><span style="color:#F97583">:</span><span style="color:#B392F0"> i32</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    prev</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Option</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Weak</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">RefCell</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Node</span><span style="color:#E1E4E8">>>>,</span></span>
<span class="line"><span style="color:#E1E4E8">    next</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Option</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Rc</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">RefCell</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Node</span><span style="color:#E1E4E8">>>>,</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<ul>
<li><code>Rc&#x3C;RefCell&#x3C;Node>></code>ï¼šç”¨äº <code>next</code>ï¼Œè¡¨ç¤ºæ‹¥æœ‰å¼•ç”¨ï¼Œå¯å˜ã€‚</li>
<li><code>Weak&#x3C;RefCell&#x3C;Node>></code>ï¼šç”¨äº <code>prev</code>ï¼Œè¡¨ç¤ºå¼±å¼•ç”¨ï¼Œä¸å¢åŠ å¼•ç”¨è®¡æ•°ï¼Œé˜²æ­¢å¾ªç¯å¼•ç”¨ã€‚</li>
<li>ä¸éœ€è¦å†åŒ…ä¸€å±‚ <code>Box</code>ï¼Œ<code>Rc</code> æœ¬èº«å°±æ˜¯æ™ºèƒ½æŒ‡é’ˆã€‚</li>
</ul>
<p>ä¸ºå•¥ <code>prev</code> ç”¨ <code>Weak</code>ã€‚</p>
<p>å¦‚æœä½ å†™æˆè¿™æ ·ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#E1E4E8">prev</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Option</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Rc</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">RefCell</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Node</span><span style="color:#E1E4E8">>>>,</span></span>
<span class="line"><span style="color:#E1E4E8">next</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Option</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Rc</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">RefCell</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Node</span><span style="color:#E1E4E8">>>>,</span></span></code></pre>
<p>é‚£æ¯ä¸ªèŠ‚ç‚¹çš„ <code>next</code> éƒ½ä¼šæŒæœ‰ <code>Rc</code> å¼ºå¼•ç”¨ï¼Œè€Œ <code>prev</code> ä¹Ÿä¼šæŒæœ‰ä¸€ä¸ªå¼ºå¼•ç”¨ â€”â€” è¿™æ ·å½¢æˆäº† <strong>å¾ªç¯å¼•ç”¨</strong>ï¼Œä¸¤ä¸ªèŠ‚ç‚¹éƒ½ä¸ä¼šè¢«é‡Šæ”¾ï¼Œå†…å­˜æ³„æ¼ã€‚ï¼ˆåœ¨ Rust é‡Œå°±æ˜¯â€œå†…å­˜æ— æ³•è‡ªåŠ¨é‡Šæ”¾â€ï¼Œä¸æ˜¯ unsafeï¼Œä½†ä»¤äººæŠ“ç‹‚ï¼‰</p>
<p><code>Weak</code> å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜çš„ã€‚</p>
<p>ï¸ å°ç»“å£è¯€ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>å•å‘é“¾è¡¨ï¼šOption&#x3C;Box&#x3C;Node>></span></span>
<span class="line"><span>åŒå‘é“¾è¡¨ï¼šRc + RefCell + Weak</span></span></code></pre>
<p>å¦‚æœä½ éè¦ç”¨ <code>Box</code> å®ç°åŒå‘é“¾è¡¨ï¼Œä¹Ÿä¸æ˜¯ä¸è¡Œ â€”â€” ä½†é‚£æ˜¯é«˜çº§ç©æ³•ï¼Œéœ€è¦ <code>raw pointer</code> + <code>unsafe</code> æ¥æ‰“ç ´ç”Ÿå‘½å‘¨æœŸç¯èŠ‚ã€‚æ²¡ç‰¹åˆ«éœ€æ±‚å»ºè®®ç”¨ä¸Šé¢çš„å®‰å…¨å®ç°ã€‚</p>
<p>è¦æˆ‘æ¼”ç¤º unsafe + Box çš„åŒå‘é“¾è¡¨å®ç°ï¼Œä¹Ÿå¯ä»¥ï¼Œä¸è¿‡çœŸçš„ã€‚</p>
<h3 id="æ’æŸ¥åœºæ™¯-2-ä¸ºä»€ä¹ˆä¼šè¡Œç¨‹å¾ªç¯å¼•ç”¨è¯¦ç»†è§£é‡Šä¸€ä¸‹">æ’æŸ¥åœºæ™¯ 2. ä¸ºä»€ä¹ˆä¼šè¡Œç¨‹å¾ªç¯å¼•ç”¨ï¼Œè¯¦ç»†è§£é‡Šä¸€ä¸‹</h3>
<ul>
<li>åœºæ™¯ï¼šä¸ºä»€ä¹ˆä¼šè¡Œç¨‹å¾ªç¯å¼•ç”¨ï¼Œè¯¦ç»†è§£é‡Šä¸€ä¸‹</li>
<li>å¤„ç†è¦ç‚¹ï¼š<br>
éå¸¸æ£’çš„é—®é¢˜ã€‚â€œå¾ªç¯å¼•ç”¨â€è¿™ä¸ªæ¦‚å¿µåœ¨ Rust å’Œå…¶ä»–è¯­è¨€ä¸­éƒ½æ˜¯å†…å­˜æ³„æ¼çš„æ¸©åºŠï¼Œå°¤å…¶æ˜¯åœ¨å¼•ç”¨è®¡æ•°æ¨¡å‹ï¼ˆå¦‚ <code>Rc</code>ï¼‰ä¸­ã€‚æˆ‘ä»¬æ¥<strong>ç»†è‡´åœ°å‰–æä¸€ä¸‹</strong>è¿™ä¸ªæœºåˆ¶ï¼Œä»¥åŠä¸ºä»€ä¹ˆ Rust ä¼šå› ä¸ºå®ƒ<strong>å¯¼è‡´å†…å­˜æ— æ³•é‡Šæ”¾</strong>ã€‚</li>
</ul>
<p>ä»€ä¹ˆæ˜¯å¾ªç¯å¼•ç”¨ã€‚</p>
<p>å¾ªç¯å¼•ç”¨æŒ‡çš„æ˜¯ï¼š</p>
<blockquote>
<p><strong>å¯¹è±¡ A å¼•ç”¨å¯¹è±¡ Bï¼ŒB åˆå¼•ç”¨å¯¹è±¡ Aï¼Œå¯¼è‡´è¿™ä¸¤ä¸ªå¯¹è±¡éƒ½ä¸ä¼šè¢«é”€æ¯ï¼Œå› ä¸ºå®ƒä»¬çš„å¼•ç”¨è®¡æ•°æ°¸è¿œä¸ä¸º 0ã€‚</strong></p>
</blockquote>
<p>ä¸¾ä¸ªé€šä¿—æ¯”å–»ï¼š<br>
ä½ ä½åœ¨ä¸€ä¸ªå°é—­ç¤¾åŒºï¼Œæ¯ä¸ªäººéƒ½æŒ‡ç€å¯¹æ–¹è¯´â€œä»–è¿˜åœ¨ï¼Œæˆ‘ä¸èƒ½æ¬èµ°â€ï¼Œäºæ˜¯å¤§å®¶éƒ½è°ä¹Ÿä¸èµ°ï¼Œæœ€åç¤¾åŒºé‡Œä¸€ä¸ªäººéƒ½èµ°ä¸äº†â€”â€”è¿™å°±å«å¾ªç¯å¼•ç”¨ã€‚</p>
<p>ä¸¾ä¸ªç®€å• Rust æ ·ä¾‹</p>
<p>æˆ‘ä»¬ç”¨ <code>Rc</code> å’Œ <code>RefCell</code> æ¥æ¨¡æ‹Ÿä¸€ä¸ªåŒå‘é“¾è¡¨èŠ‚ç‚¹ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">use</span><span style="color:#B392F0"> std</span><span style="color:#F97583">::</span><span style="color:#B392F0">rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">Rc</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">use</span><span style="color:#B392F0"> std</span><span style="color:#F97583">::</span><span style="color:#B392F0">cell</span><span style="color:#F97583">::</span><span style="color:#B392F0">RefCell</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">struct</span><span style="color:#B392F0"> Node</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    value</span><span style="color:#F97583">:</span><span style="color:#B392F0"> i32</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    next</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Option</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Rc</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">RefCell</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Node</span><span style="color:#E1E4E8">>>>,</span></span>
<span class="line"><span style="color:#E1E4E8">    prev</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Option</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Rc</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">RefCell</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Node</span><span style="color:#E1E4E8">>>>, </span><span style="color:#6A737D">// æ³¨æ„è¿™é‡Œæ˜¯ Rcï¼Œä¸æ˜¯ Weak</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>ç„¶åè¿™æ ·è¿æ¥ä¸¤ä¸ªèŠ‚ç‚¹ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">fn</span><span style="color:#B392F0"> main</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">    let</span><span style="color:#E1E4E8"> node1 </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">RefCell</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">Node</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        value</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">        next</span><span style="color:#F97583">:</span><span style="color:#B392F0"> None</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">        prev</span><span style="color:#F97583">:</span><span style="color:#B392F0"> None</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    }));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    let</span><span style="color:#E1E4E8"> node2 </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">RefCell</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">Node</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        value</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">        next</span><span style="color:#F97583">:</span><span style="color:#B392F0"> None</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">        prev</span><span style="color:#F97583">:</span><span style="color:#B392F0"> None</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    }));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // node1 -> node2</span></span>
<span class="line"><span style="color:#E1E4E8">    node1</span><span style="color:#F97583">.</span><span style="color:#B392F0">borrow_mut</span><span style="color:#E1E4E8">()</span><span style="color:#F97583">.</span><span style="color:#E1E4E8">next </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Some</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">Rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">clone</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">&#x26;</span><span style="color:#E1E4E8">node2));</span></span>
<span class="line"><span style="color:#6A737D">    // node2 -> node1</span></span>
<span class="line"><span style="color:#E1E4E8">    node2</span><span style="color:#F97583">.</span><span style="color:#B392F0">borrow_mut</span><span style="color:#E1E4E8">()</span><span style="color:#F97583">.</span><span style="color:#E1E4E8">prev </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Some</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">Rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">clone</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">&#x26;</span><span style="color:#E1E4E8">node1));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // åˆ°è¿™é‡Œï¼Œnode1 å’Œ node2 äº’ç›¸å¼•ç”¨ï¼Œå¯¹æ–¹çš„ strong_count æ°¸è¿œæ˜¯ â‰¥1</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="è§‚å¯Ÿå¼•ç”¨è®¡æ•°">è§‚å¯Ÿå¼•ç”¨è®¡æ•°ï¼š</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#B392F0">println!</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"node1 strong: {}"</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">Rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">strong_count</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">&#x26;</span><span style="color:#E1E4E8">node1)); </span><span style="color:#6A737D">// è¾“å‡º 2</span></span>
<span class="line"><span style="color:#B392F0">println!</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"node2 strong: {}"</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">Rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">strong_count</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">&#x26;</span><span style="color:#E1E4E8">node2)); </span><span style="color:#6A737D">// è¾“å‡º 2</span></span></code></pre>
<ul>
<li><code>node1</code> å’Œ <code>node2</code> å„è‡ªéƒ½æœ‰ä¸€ä¸ªå¤–éƒ¨å˜é‡å¼•ç”¨</li>
<li>äº’ç›¸ <code>prev/next</code> ä¸­åˆæŒæœ‰äº†å¯¹æ–¹çš„ <code>Rc</code>ï¼Œæ‰€ä»¥å¼•ç”¨æ•°å˜æˆäº† 2</li>
<li><strong>å³ä½¿å‡½æ•°ç»“æŸï¼Œå˜é‡å‡ºä½œç”¨åŸŸï¼Œå¼•ç”¨æ•°ä¹Ÿä¸ä¼šå˜æˆ 0 â‡’ å†…å­˜æ— æ³•é‡Šæ”¾ã€‚</strong></li>
</ul>
<p>ä¸ºä»€ä¹ˆä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚</p>
<p>åœ¨ Rust ä¸­ï¼Œ<code>Rc</code> æ˜¯å¼•ç”¨è®¡æ•°æ™ºèƒ½æŒ‡é’ˆï¼Œåªæœ‰å½“ <strong>strong å¼•ç”¨è®¡æ•°ä¸º 0</strong> æ—¶ï¼Œæ•°æ®æ‰ä¼šè¢«çœŸæ­£é‡Šæ”¾ã€‚</p>
<p>ä¸€æ—¦äº’ç›¸æŒæœ‰ <code>Rc</code>ï¼Œå°±é™·å…¥äº†ä¸€ä¸ªâ€œä½ ä¸å…ˆæ­»æˆ‘å°±ä¸èƒ½æ­»â€çš„å±€é¢ï¼Œè°ä¹Ÿä¸ä¼šé‡Šæ”¾ã€‚<strong>Rust ç¼–è¯‘å™¨ä¸ä¼šæŠ¥é”™</strong>ï¼Œå› ä¸ºå®ƒè®¤ä¸ºä½ è¿™ä¹ˆåšæ˜¯åˆæ³•çš„ï¼Œä½†è¿è¡Œæ—¶ä½ å°±ä¼šå‘ç°å†…å­˜è¢«æ°¸ä¹…å ç”¨äº†ã€‚</p>
<p>å¦‚ä½•ç ´å±€ã€‚å¼•å…¥ <code>Weak</code></p>
<p>æˆ‘ä»¬ç”¨ <code>Weak</code> æ›¿ä»£ <code>prev</code>ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">use</span><span style="color:#B392F0"> std</span><span style="color:#F97583">::</span><span style="color:#B392F0">rc</span><span style="color:#F97583">::</span><span style="color:#E1E4E8">{</span><span style="color:#B392F0">Rc</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">Weak</span><span style="color:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">struct</span><span style="color:#B392F0"> Node</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    value</span><span style="color:#F97583">:</span><span style="color:#B392F0"> i32</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    next</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Option</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Rc</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">RefCell</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Node</span><span style="color:#E1E4E8">>>>,</span></span>
<span class="line"><span style="color:#E1E4E8">    prev</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Option</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Weak</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">RefCell</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Node</span><span style="color:#E1E4E8">>>>, </span><span style="color:#6A737D">// Weak ä¸å¢åŠ  strong_count</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#E1E4E8">node1</span><span style="color:#F97583">.</span><span style="color:#B392F0">borrow_mut</span><span style="color:#E1E4E8">()</span><span style="color:#F97583">.</span><span style="color:#E1E4E8">next </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Some</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">Rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">clone</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">&#x26;</span><span style="color:#E1E4E8">node2));</span></span>
<span class="line"><span style="color:#E1E4E8">node2</span><span style="color:#F97583">.</span><span style="color:#B392F0">borrow_mut</span><span style="color:#E1E4E8">()</span><span style="color:#F97583">.</span><span style="color:#E1E4E8">prev </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Some</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">Rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">downgrade</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">&#x26;</span><span style="color:#E1E4E8">node1)); </span><span style="color:#6A737D">// ä½¿ç”¨ Weakï¼</span></span></code></pre>
<h3 id="è¿™æ—¶">è¿™æ—¶ï¼š</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#B392F0">Rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">strong_count</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">&#x26;</span><span style="color:#E1E4E8">node1) </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> 1</span><span style="color:#6A737D"> // åªæœ‰ next å¼•ç”¨å®ƒ</span></span>
<span class="line"><span style="color:#B392F0">Rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">strong_count</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">&#x26;</span><span style="color:#E1E4E8">node2) </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> 1</span><span style="color:#6A737D"> // è¢«å¤–éƒ¨å˜é‡å¼•ç”¨</span></span></code></pre>
<ul>
<li><code>Weak</code> ä¸å¢åŠ å¼ºå¼•ç”¨è®¡æ•°ï¼Œåªæ˜¯ä¸ªå¼±å¼•ç”¨</li>
<li><code>Rc</code> æ•°æ®å¯åœ¨ strong count ä¸º 0 æ—¶å®‰å…¨å›æ”¶</li>
</ul>
<p>æ€»ç»“å›¾ç¤ºï¼ˆæç®€ï¼‰ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span> å¾ªç¯å¼•ç”¨ï¼ˆä¸¤è¾¹éƒ½æ˜¯ Rcï¼‰ï¼š</span></span>
<span class="line"><span></span></span>
<span class="line"><span> Rc&#x3C;Node1> &#x3C;------ Rc&#x3C;Node2></span></span>
<span class="line"><span>    â†‘               â†“</span></span>
<span class="line"><span>  next           prev</span></span>
<span class="line"><span></span></span>
<span class="line"><span> æ­£ç¡®åšæ³•ï¼ˆä¸€ä¸ªæ˜¯ Rcï¼Œä¸€ä¸ªæ˜¯ Weakï¼‰ï¼š</span></span>
<span class="line"><span></span></span>
<span class="line"><span> Rc&#x3C;Node1> &#x3C;------ Weak&#x3C;Node2></span></span>
<span class="line"><span>    â†‘               â†“</span></span>
<span class="line"><span>  next           prev</span></span></code></pre>
<p>å°ç»“å£è¯€ï¼š</p>
<blockquote>
<p><strong>â€œRc å»ºæ¡¥ï¼ŒWeak æ‰“æ–­â€</strong><br>
ç”¨ <code>Rc</code> æ„å»ºä¸»é“¾å…³ç³»ï¼›ç”¨ <code>Weak</code> è¡¨ç¤ºâ€œä»å±ã€å›æŒ‡ã€ä¸å‚ä¸ç”Ÿå‘½ç®¡ç†â€çš„é“¾æ¥ã€‚</p>
</blockquote>
<p>å¦‚æœä½ å¯¹å¾ªç¯å¼•ç”¨çš„æ£€æµ‹æˆ– <code>Weak</code> çš„å‡çº§ (<code>upgrade</code>) ä½¿ç”¨æ–¹æ³•ä¹Ÿæ„Ÿå…´è¶£ï¼Œæˆ‘å¯ä»¥ç»§ç»­ä¸¾ä¾‹è®²è®²ã€‚è¿™ä¸ªæ¦‚å¿µç†è§£é€äº†ï¼Œä¸ç®¡åšé“¾è¡¨ã€å›¾ç»“æ„ã€DOM æ ‘ï¼Œéƒ½æ˜¯æ¸¸åˆƒæœ‰ä½™ã€‚</p>
<h3 id="ä¸»é¢˜-3-ä¸ºä»€ä¹ˆrcè¿˜è¦åµŒå¥—ä¸€ä¸ªrefcell">ä¸»é¢˜ 3. ä¸ºä»€ä¹ˆRcè¿˜è¦åµŒå¥—ä¸€ä¸ªRefCell</h3>
<p>ä½ çœ‹å¾—å‡ºæ¥ï¼Œ<code>Rc&#x3C;T></code> å’Œ <code>RefCell&#x3C;T></code> åˆ†åˆ«è§£å†³çš„æ˜¯ <strong>å…±äº«</strong> å’Œ <strong>å¯å˜</strong>ï¼Œå®ƒä»¬ç»„åˆåœ¨ä¸€èµ·çš„è®¾è®¡ï¼Œå…¶å®æ˜¯ä¸€ç§éå¸¸å…¸å‹çš„ Rust ç¼–ç¨‹æ¨¡å¼ï¼Œè¢«ç§°ä¸ºï¼š</p>
<blockquote>
<p><strong>â€œå¯å˜å…±äº«çš„å†…å­˜æ¨¡å‹ï¼ˆInterior Mutability with Shared Ownershipï¼‰â€</strong></p>
</blockquote>
<p>èƒŒåçš„æ ¸å¿ƒé™åˆ¶ï¼šRust çš„<strong>æ‰€æœ‰æƒ + å€Ÿç”¨è§„åˆ™</strong></p>
<h3 id="åœ¨-rust-ä¸­æœ‰ä¸¤æ¡é“å¾‹ç¼–è¯‘æ—¶å°±æ£€æŸ¥">åœ¨ Rust ä¸­æœ‰ä¸¤æ¡é“å¾‹ï¼ˆç¼–è¯‘æ—¶å°±æ£€æŸ¥ï¼‰ï¼š</h3>
<ol>
<li><strong>ä½ å¯ä»¥æœ‰å¤šä¸ªä¸å¯å˜å¼•ç”¨</strong>ï¼ˆ<code>&#x26;T</code>ï¼‰ï¼Œ<strong>æˆ–è€…ä¸€ä¸ªå¯å˜å¼•ç”¨</strong>ï¼ˆ<code>&#x26;mut T</code>ï¼‰ï¼Œ<strong>ä½†ä¸èƒ½åŒæ—¶æ‹¥æœ‰</strong>ã€‚</li>
<li><strong>Rc<t> åªèƒ½æä¾›ä¸å¯å˜å¼•ç”¨</t></strong>ï¼ˆ<code>&#x26;T</code>ï¼‰ï¼Œå› ä¸ºå®ƒå¯èƒ½æœ‰å¤šä¸ªæŒæœ‰è€…ã€‚</li>
</ol>
<p>æ‰€ä»¥é—®é¢˜æ¥äº†ï¼š</p>
<blockquote>
<p>â€œå¦‚æœæˆ‘ç”¨ <code>Rc</code> å…±äº«ä¸€ä¸ªå¯¹è±¡ï¼Œä½†è¿˜æƒ³æ”¹å®ƒæ€ä¹ˆåŠã€‚â€</p>
</blockquote>
<p>ä½ å°±ä¼šæ’åˆ° Rust çš„å¢™ï¼šâ€œ<strong>ä½ ä¸èƒ½å¯å˜åœ° borrow ä¸€ä¸ª Rc<t> çš„å†…å®¹ã€‚</t></strong>â€</p>
<p>ä¸¾ä¸ªä¾‹å­è¯´æ˜</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">use</span><span style="color:#B392F0"> std</span><span style="color:#F97583">::</span><span style="color:#B392F0">rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">Rc</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">struct</span><span style="color:#B392F0"> Data</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    value</span><span style="color:#F97583">:</span><span style="color:#B392F0"> i32</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">fn</span><span style="color:#B392F0"> main</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">    let</span><span style="color:#E1E4E8"> shared </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">Data</span><span style="color:#E1E4E8"> { value</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> 42</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    //  ä¸‹é¢ä¸èƒ½æ”¹å®ƒçš„å€¼</span></span>
<span class="line"><span style="color:#6A737D">    // shared.value = 100;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>Rust ä¼šå‘Šè¯‰ä½ ï¼š<strong>ä¸èƒ½ä¿®æ”¹ï¼Œå› ä¸ºä½ åªæ‹¥æœ‰ä¸å¯å˜å¼•ç”¨</strong>ã€‚</p>
<p>ç”¨ RefCell è§£å†³å†…éƒ¨å¯å˜æ€§</p>
<p>æˆ‘ä»¬ç”¨ <code>RefCell</code> åŒ…è£¹ <code>Data</code>ï¼Œå°±èƒ½ç»•è¿‡ç¼–è¯‘æœŸçš„é™åˆ¶ï¼Œåœ¨ <strong>è¿è¡Œæ—¶</strong> è¿›è¡Œ borrow æ£€æŸ¥ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">use</span><span style="color:#B392F0"> std</span><span style="color:#F97583">::</span><span style="color:#B392F0">rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">Rc</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">use</span><span style="color:#B392F0"> std</span><span style="color:#F97583">::</span><span style="color:#B392F0">cell</span><span style="color:#F97583">::</span><span style="color:#B392F0">RefCell</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">struct</span><span style="color:#B392F0"> Data</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    value</span><span style="color:#F97583">:</span><span style="color:#B392F0"> i32</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">fn</span><span style="color:#B392F0"> main</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">    let</span><span style="color:#E1E4E8"> shared </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">RefCell</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">Data</span><span style="color:#E1E4E8"> { value</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> 42</span><span style="color:#E1E4E8"> }));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    shared</span><span style="color:#F97583">.</span><span style="color:#B392F0">borrow_mut</span><span style="color:#E1E4E8">()</span><span style="color:#F97583">.</span><span style="color:#E1E4E8">value </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 100</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">//  ä¿®æ”¹æˆåŠŸ</span></span>
<span class="line"><span style="color:#B392F0">    println!</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"value = {}"</span><span style="color:#E1E4E8">, shared</span><span style="color:#F97583">.</span><span style="color:#B392F0">borrow</span><span style="color:#E1E4E8">()</span><span style="color:#F97583">.</span><span style="color:#E1E4E8">value);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<ul>
<li><code>Rc</code> è´Ÿè´£å¤šä¸ªæ‰€æœ‰è€…å¼•ç”¨å…±äº«</li>
<li><code>RefCell</code> è´Ÿè´£è¿è¡Œæ—¶å†…éƒ¨å¯å˜æ€§ï¼ˆåœ¨è¿è¡Œæ—¶æ£€æŸ¥ borrowï¼‰</li>
</ul>
<p>ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨ <code>Rc</code> + <code>mut</code>ã€‚</p>
<p>å› ä¸º <code>Rc</code> æ˜¯ç»™<strong>å¤šæ‰€æœ‰è€…ä½¿ç”¨çš„</strong>ï¼ŒRust ä¸å…è®¸å¤šä¸ªæ‰€æœ‰è€…æŒæœ‰ <code>&#x26;mut</code>ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> a </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">RefCell</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">));</span></span>
<span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> b </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">clone</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">&#x26;</span><span style="color:#E1E4E8">a);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">*</span><span style="color:#E1E4E8">b</span><span style="color:#F97583">.</span><span style="color:#B392F0">borrow_mut</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">// OK</span></span></code></pre>
<p>ä½ å¯ä»¥çœ‹åˆ°ï¼š</p>
<ul>
<li><code>a</code> å’Œ <code>b</code> éƒ½æŒ‡å‘åŒä¸€ä¸ªå€¼ï¼›</li>
<li>ä½†å› ä¸º <code>RefCell</code> è¿è¡Œæ—¶åšå€Ÿç”¨æ£€æŸ¥ï¼Œæ‰€ä»¥å¯ä»¥å¤šä¸ª <code>Rc</code>ï¼Œä½†ä»ä¿è¯åªæœ‰ä¸€ä¸ªå¯å˜ borrowã€‚</li>
</ul>
<p>å°ç»“å£è¯€ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Rc è´Ÿè´£å…±äº«æ‰€æœ‰æƒ</span></span>
<span class="line"><span>RefCell è´Ÿè´£å†…éƒ¨å¯å˜</span></span>
<span class="line"><span></span></span>
<span class="line"><span>åˆèµ·æ¥ï¼šå¤šä¸»å…±ç®¡ + åŠ¨æ€å˜æ›´</span></span></code></pre>
<p>è¿™ç§ç»„åˆåœ¨æ„å»ºï¼š</p>
<ul>
<li>åŒå‘é“¾è¡¨</li>
<li>æ ‘ç»“æ„ï¼ˆå¦‚ DOM Treeï¼‰</li>
<li>å›¾ç»“æ„</li>
<li>ç¼“å­˜æ± ï¼ˆå¦‚ LRUï¼‰</li>
</ul>
<p>ä¸­éƒ½éå¸¸å¸¸è§ã€‚</p>
<p>å¦‚æœä½ æƒ³çŸ¥é“è¿™ç§ç»„åˆæœ‰æ²¡æœ‰å¤šçº¿ç¨‹ç‰ˆæœ¬ â€”â€” ç­”æ¡ˆæ˜¯æœ‰çš„ï¼Œé‚£å°±æ˜¯ <code>Arc&#x3C;Mutex&#x3C;T>></code> æˆ– <code>Arc&#x3C;RwLock&#x3C;T>></code>ï¼ŒåŸç†ç±»ä¼¼ï¼Œä½†åŠ äº†çº¿ç¨‹å®‰å…¨ã€‚</p>
<p>éœ€è¦æˆ‘å¯¹æ¯”è®²è®²å®ƒä»¬å’Œ <code>Rc&#x3C;RefCell&#x3C;T>></code> çš„å…³ç³»å—ã€‚</p>
<h3 id="ä¸»é¢˜-4-let-shared--rcnew-data-value-42">ä¸»é¢˜ 4. let shared = Rc::new Data value: 42â€¦</h3>
<p>ä½ å†™çš„è¿™æ®µï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">let</span><span style="color:#F97583"> mut</span><span style="color:#E1E4E8"> shared </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">Data</span><span style="color:#E1E4E8"> { value</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> 42</span><span style="color:#E1E4E8"> });</span></span></code></pre>
<p>ç›¸æ¯”è¿™æ®µï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> shared </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">Data</span><span style="color:#E1E4E8"> { value</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> 42</span><span style="color:#E1E4E8"> });</span></span></code></pre>
<p>å¤§éƒ¨åˆ†æ–°æ‰‹ä¼šä»¥ä¸ºè¿™ä¸¤æ®µçš„åŒºåˆ«åœ¨äºâ€œæ˜¯ä¸æ˜¯èƒ½ä¿®æ”¹ <code>Data</code> çš„ <code>value</code>â€ï¼Œä½†å…¶å®è¿™æ ¹æœ¬ä¸æ˜¯é‡ç‚¹ã€‚</p>
<p>æœ¬è´¨åŒºåˆ«ï¼š<code>mut shared</code> å’Œ <code>shared</code> çš„â€œå¯å˜æ€§â€æŒ‡çš„æ˜¯å˜é‡ç»‘å®šæœ¬èº«</p>
<h3 id="1ï¸âƒ£-mut-shared-çš„æ„æ€æ˜¯">1ï¸âƒ£ <code>mut shared</code> çš„æ„æ€æ˜¯ï¼š</h3>
<blockquote>
<p>ä½ å¯ä»¥é‡æ–°èµ‹å€¼ <code>shared</code> æœ¬èº«ï¼Œæ¯”å¦‚æ¢æ‰è¿™ä¸ªæŒ‡é’ˆï¼š</p>
</blockquote>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">let</span><span style="color:#F97583"> mut</span><span style="color:#E1E4E8"> shared </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">Data</span><span style="color:#E1E4E8"> { value</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> 42</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#E1E4E8">shared </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">Data</span><span style="color:#E1E4E8"> { value</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> 100</span><span style="color:#E1E4E8"> }); </span><span style="color:#6A737D">//  åˆæ³•ï¼</span></span></code></pre>
<p>è¿™è¡¨ç¤ºï¼šä½ è¿™ä¸ª <code>Rc</code> å˜é‡ç»‘å®šæ˜¯<strong>å¯å˜çš„ç»‘å®š</strong>ï¼ˆ<code>mut</code> ä¿®é¥°çš„æ˜¯å˜é‡åï¼Œä¸æ˜¯å€¼ï¼‰ã€‚</p>
<h3 id="2ï¸âƒ£-è€Œä½ ä¸èƒ½è¿™ä¹ˆåš">2ï¸âƒ£ è€Œä½ ä¸èƒ½è¿™ä¹ˆåšï¼š</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> shared </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">Data</span><span style="color:#E1E4E8"> { value</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> 42</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#E1E4E8">shared</span><span style="color:#F97583">.</span><span style="color:#E1E4E8">value </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 100</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">//  ç¼–è¯‘é”™è¯¯</span></span></code></pre>
<p>å› ä¸º <code>Rc</code> åªæä¾› <code>&#x26;T</code>ï¼ˆä¸å¯å˜å€Ÿç”¨ï¼‰ï¼Œä½ æ²¡æ³•æ”¹ <code>value</code>ï¼Œè·Ÿä½  <code>mut</code> ä¸ <code>mut</code> æ ¹æœ¬æ²¡å…³ç³»ã€‚</p>
<p>æ­£ç¡®æƒ³æ”¹é‡Œé¢çš„å€¼ï¼Œè¦ç”¨ <code>Rc&#x3C;RefCell&#x3C;T>></code>ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">use</span><span style="color:#B392F0"> std</span><span style="color:#F97583">::</span><span style="color:#B392F0">rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">Rc</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">use</span><span style="color:#B392F0"> std</span><span style="color:#F97583">::</span><span style="color:#B392F0">cell</span><span style="color:#F97583">::</span><span style="color:#B392F0">RefCell</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">struct</span><span style="color:#B392F0"> Data</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    value</span><span style="color:#F97583">:</span><span style="color:#B392F0"> i32</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">fn</span><span style="color:#B392F0"> main</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">    let</span><span style="color:#E1E4E8"> shared </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">RefCell</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">Data</span><span style="color:#E1E4E8"> { value</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> 42</span><span style="color:#E1E4E8"> }));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    shared</span><span style="color:#F97583">.</span><span style="color:#B392F0">borrow_mut</span><span style="color:#E1E4E8">()</span><span style="color:#F97583">.</span><span style="color:#E1E4E8">value </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 100</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">    println!</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"{}"</span><span style="color:#E1E4E8">, shared</span><span style="color:#F97583">.</span><span style="color:#B392F0">borrow</span><span style="color:#E1E4E8">()</span><span style="color:#F97583">.</span><span style="color:#E1E4E8">value);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<ul>
<li>ä½ è¿™é‡Œçš„ <code>shared</code> ç”šè‡³å¯ä»¥æ˜¯ <code>let shared</code>ï¼ˆ<strong>ä¸å¯å˜ç»‘å®š</strong>ï¼‰ï¼Œä½†ä½ ä¾ç„¶å¯ä»¥æ”¹å†…å®¹ã€‚</li>
<li>å› ä¸ºçœŸæ­£å†³å®šèƒ½ä¸èƒ½æ”¹çš„ï¼Œæ˜¯å†…éƒ¨çš„ <code>RefCell</code>ï¼Œè€Œä¸æ˜¯å¤–å±‚å˜é‡çš„ <code>mut</code>ã€‚</li>
</ul>
<h2 id="æ€»ç»“">æ€»ç»“</h2>

























<table><thead><tr><th>å†™æ³•</th><th>å«ä¹‰</th><th>æ˜¯å¦èƒ½æ”¹å†…éƒ¨æ•°æ®</th></tr></thead><tbody><tr><td><code>let shared = Rc::new(Data { .. })</code></td><td>ä¸å¯å˜ç»‘å®š Rcï¼Œä¸èƒ½æ”¹ Rc å˜é‡æœ¬èº«</td><td>æ— æ³•æ”¹å†…éƒ¨ <code>value</code></td></tr><tr><td><code>let mut shared = Rc::new(Data { .. })</code></td><td>å¯å˜ç»‘å®š Rcï¼Œå¯ä»¥é‡æ–°èµ‹å€¼</td><td>ä¾ç„¶æ— æ³•æ”¹å†…éƒ¨ <code>value</code></td></tr><tr><td><code>let shared = Rc::new(RefCell::new(Data { .. }))</code></td><td>ä¸å¯å˜ç»‘å®š Rc<refcell>ï¼Œä½† RefCell æä¾›å†…éƒ¨å¯å˜æ€§</refcell></td><td>å¯æ”¹å†…éƒ¨æ•°æ®ã€‚</td></tr></tbody></table>
<p>ä¸€å¥è¯æ€»ç»“ï¼š</p>
<blockquote>
<p><code>mut shared</code> è®©ä½ èƒ½æ¢æ‰ <code>shared</code>ï¼Œ<br>
ä½†åªæœ‰ <code>RefCell</code>ï¼ˆæˆ– <code>Cell</code>ï¼‰èƒ½è®©ä½ <strong>æ”¹æ‰ shared æŒ‡å‘çš„å€¼</strong>ã€‚</p>
</blockquote>
<p>éœ€è¦æˆ‘ç”»å›¾æˆ–è€…ç”¨æ›´å…·è±¡çš„å†…å­˜ç¤ºæ„æ¥è¯´æ˜è¿™ä¸ªåŒºåˆ«ä¹Ÿå¯ä»¥å“ˆã€‚è¿™å—åƒé€äº†ï¼ŒRust å°±å½»åº•å¼€çªäº†ã€‚</p>
<h3 id="ä¸»é¢˜-5-rcæä¾›ä¸å¯å˜å¼•ç”¨é‚£boxå‘¢">ä¸»é¢˜ 5. Rcæä¾›ä¸å¯å˜å¼•ç”¨ï¼Œé‚£Boxå‘¢</h3>
<p>å¤ªå¥½äº†ï¼Œä½ ç°åœ¨æŠŠé—®é¢˜é—®åˆ°æ ¸å¿ƒäº†ã€‚</p>
<blockquote>
<p><strong>Rc æä¾›ä¸å¯å˜å¼•ç”¨ï¼Œé‚£ Box å‘¢ã€‚å®ƒèƒ½æä¾›å¯å˜å¼•ç”¨å—ã€‚</strong></p>
</blockquote>
<p>ç­”æ¡ˆæ˜¯â€”â€”<strong>èƒ½ã€‚è€Œä¸”æ˜¯å”¯ä¸€åˆæ³•æ‹¥æœ‰å¯å˜å¼•ç”¨çš„æ™ºèƒ½æŒ‡é’ˆã€‚</strong></p>
<p>è®©æˆ‘ä»¬æ¥æ·±æŒ–ä¸€ä¸‹ã€‚</p>
<p>å…ˆå¯¹æ¯”ä¸€ä¸‹ Rc å’Œ Box çš„æ‰€æœ‰æƒæ¨¡å‹ï¼š</p>























<table><thead><tr><th>æŒ‡é’ˆç±»å‹</th><th>æ˜¯å¦å †åˆ†é…</th><th>æ‰€æœ‰æƒæ•°é‡</th><th>æ˜¯å¦å¯å˜è®¿é—®å†…éƒ¨å€¼</th></tr></thead><tbody><tr><td><code>Box&#x3C;T></code></td><td>æ˜¯</td><td><strong>å”¯ä¸€æ‰€æœ‰è€…</strong></td><td>å¯ä»¥å¯å˜è®¿é—®</td></tr><tr><td><code>Rc&#x3C;T></code></td><td>æ˜¯</td><td><strong>å¤šä¸ªæ‰€æœ‰è€…</strong></td><td>ä¸å¯å˜è®¿é—®ï¼ˆé™¤éé…åˆ RefCellï¼‰</td></tr></tbody></table>
<p>Box<t> çš„æœ¬è´¨ï¼š<strong>å”¯ä¸€æ‰€æœ‰æƒçš„å †æŒ‡é’ˆ</strong></t></p>
<p>Box å°±åƒä¸€ä¸ªè£…åœ¨ç›’å­é‡Œçš„å¯¹è±¡ï¼Œå®ƒï¼š</p>
<ul>
<li>æ‹¥æœ‰æ•°æ®çš„å”¯ä¸€æ‰€æœ‰æƒ</li>
<li>æ•°æ®åœ¨å †ä¸Šåˆ†é…</li>
<li>å’Œè£¸æŒ‡é’ˆä¸åŒï¼ŒBox åœ¨é‡Šæ”¾æ—¶ä¼šè‡ªåŠ¨ drop</li>
</ul>
<h3 id="æ‰€ä»¥ä½ å¯ä»¥ç›´æ¥æ”¹-box-ä¸­çš„å€¼">æ‰€ä»¥ä½ å¯ä»¥ç›´æ¥æ”¹ Box ä¸­çš„å€¼ï¼š</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">fn</span><span style="color:#B392F0"> main</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">    let</span><span style="color:#F97583"> mut</span><span style="color:#E1E4E8"> b </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Box</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">    *</span><span style="color:#E1E4E8">b </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">;  </span><span style="color:#6A737D">//  åˆæ³•ï¼šBox&#x3C;T> æ”¯æŒå¯å˜è§£å¼•ç”¨</span></span>
<span class="line"><span style="color:#B392F0">    println!</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"b = {}"</span><span style="color:#E1E4E8">, b);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>ä¹Ÿå¯ä»¥åƒè¿™æ ·ä¼  <code>&#x26;mut</code> åˆ°å‡½æ•°é‡Œï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">fn</span><span style="color:#B392F0"> add_one</span><span style="color:#E1E4E8">(x</span><span style="color:#F97583">:</span><span style="color:#F97583"> &#x26;mut</span><span style="color:#B392F0"> Box</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">i32</span><span style="color:#E1E4E8">>) {</span></span>
<span class="line"><span style="color:#F97583">    **</span><span style="color:#E1E4E8">x </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">fn</span><span style="color:#B392F0"> main</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">    let</span><span style="color:#F97583"> mut</span><span style="color:#E1E4E8"> b </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Box</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">    add_one</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">&#x26;mut</span><span style="color:#E1E4E8"> b);  </span><span style="color:#6A737D">//  å¯å˜å€Ÿç”¨</span></span>
<span class="line"><span style="color:#B392F0">    println!</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"b = {}"</span><span style="color:#E1E4E8">, b);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>Rc<t> å°±ä¸è¡Œï¼š</t></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">fn</span><span style="color:#B392F0"> main</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">    let</span><span style="color:#E1E4E8"> x </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">    *</span><span style="color:#E1E4E8">x </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">//  ç¼–è¯‘é”™è¯¯ï¼šcan't assign to data in an Rc</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>å› ä¸º Rc å¯èƒ½æœ‰å¤šä¸ªå¼•ç”¨ï¼ŒRust ç¼–è¯‘å™¨æ— æ³•ä¿è¯â€œä½ ä¿®æ”¹çš„æ—¶å€™æ²¡äººè¯»â€ï¼Œæ‰€ä»¥å®ƒå¹²è„†ç¦æ­¢ä¿®æ”¹ã€‚</p>
<p>ç±»æ¯”æ€»ç»“ï¼ˆå½¢è±¡æ¯”å–»ï¼‰</p>




















<table><thead><tr><th>æ™ºèƒ½æŒ‡é’ˆ</th><th>æ¯”å–»</th><th>è°èƒ½åŠ¨é‡Œé¢çš„ä¸œè¥¿ã€‚</th></tr></thead><tbody><tr><td><code>Box&#x3C;T></code></td><td>ä½ è‡ªå·±ç§Ÿäº†ä¸€æ•´é—´åŠå…¬å®¤</td><td>æƒ³æ€ä¹ˆè£…æ½¢æ€ä¹ˆæ”¹éƒ½è¡Œ</td></tr><tr><td><code>Rc&#x3C;T></code></td><td>å¤§å®¶ä¸€èµ·åˆç§ŸåŠå…¬å®¤</td><td>è°éƒ½ä¸èƒ½ç§è‡ªåŠ¨å·¥ï¼Œåªèƒ½çœ‹</td></tr></tbody></table>
<blockquote>
<p>å¦‚æœä½ æƒ³åœ¨åˆç§ŸçŠ¶æ€ä¸‹æ”¹å¸ƒå±€ï¼Œå¿…é¡»ç”¨ <code>Rc&#x3C;RefCell&#x3C;T>></code>ï¼Œè¿™å°±åƒæå‰çº¦å®šå¥½è°èƒ½å€Ÿé’¥åŒ™è¿›å»è£…ä¿®ã€‚</p>
</blockquote>
<p>é‡ç‚¹ç»“è®ºï¼š</p>
<ul>
<li><code>Box&#x3C;T></code>ï¼šå”¯ä¸€æ‰€æœ‰æƒï¼Œæ‰€ä»¥å¯ä»¥å®‰å…¨åœ°æä¾› <code>&#x26;mut T</code>ï¼Œ<strong>ç›´æ¥æ”¯æŒä¿®æ”¹</strong></li>
<li><code>Rc&#x3C;T></code>ï¼šå…±äº«æ‰€æœ‰æƒï¼Œåªèƒ½ç»™ä½  <code>&#x26;T</code>ï¼Œ<strong>ä¸èƒ½ä¿®æ”¹</strong></li>
<li>æ‰€ä»¥ï¼Œå¦‚æœä½ ï¼š
<ul>
<li>è¦â€œè‡ªå·±ç®¡â€ï¼Œç”¨ <code>Box&#x3C;T></code></li>
<li>è¦â€œå¤§å®¶å…±ç”¨â€ï¼Œç”¨ <code>Rc&#x3C;T></code></li>
<li>è¦â€œå…±ç”¨è¿˜èƒ½æ”¹â€ï¼Œé‚£å°± <code>Rc&#x3C;RefCell&#x3C;T>></code></li>
</ul>
</li>
</ul>
<h3 id="ä¸»é¢˜-6-é‚£æˆ‘ç†è§£çš„æ˜¯-let-mut-b--box-new-5-ä¸-let-b">ä¸»é¢˜ 6. é‚£æˆ‘ç†è§£çš„æ˜¯ let mut b = Box new 5 ä¸ let bâ€¦</h3>
<p>ä½ ç†è§£å¾—<strong>éå¸¸æ¥è¿‘çœŸç›¸äº†</strong>ï¼Œæˆ‘ä»¬å°±æ¥ææ¸…æ¥šè¿™ä¸ªç»†å¾®ä½†å…³é”®çš„å·®åˆ«ï¼š</p>
<p><code>let mut b = Box::new(5)</code> å’Œ <code>let b = Box::new(5)</code> æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚</p>
<h3 id="1ï¸âƒ£-let-mut-b-">1ï¸âƒ£ <code>let mut b = ...</code></h3>
<p>è¿™è¡¨ç¤ºï¼š</p>
<blockquote>
<p>ä½ å¯ä»¥æ”¹å˜ <strong><code>b</code> è¿™ä¸ªå˜é‡æœ¬èº«</strong>ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥é‡æ–°ç»™ <code>b</code> èµ‹å€¼ï¼Œæˆ–è€…é€šè¿‡å®ƒä¿®æ”¹å†…éƒ¨çš„æ•°æ®ã€‚</p>
</blockquote>
<p>æ¯”å¦‚ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">let</span><span style="color:#F97583"> mut</span><span style="color:#E1E4E8"> b </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Box</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">*</span><span style="color:#E1E4E8">b </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">;         </span><span style="color:#6A737D">//  æ”¹å†…éƒ¨å€¼</span></span>
<span class="line"><span style="color:#E1E4E8">b </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Box</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">42</span><span style="color:#E1E4E8">); </span><span style="color:#6A737D">//  æ”¹æ•´ä¸ª box æœ¬èº«</span></span></code></pre>
<h3 id="2ï¸âƒ£-let-b-">2ï¸âƒ£ <code>let b = ...</code></h3>
<p>è¿™è¡¨ç¤ºï¼š</p>
<blockquote>
<p>ä½ åªèƒ½åªè¯»åœ°ä½¿ç”¨ <code>b</code>ï¼Œä¸èƒ½æ›´æ”¹ <code>b</code> æœ¬èº«ï¼Œä¹Ÿä¸èƒ½é€šè¿‡ <code>b</code> è·å– <code>&#x26;mut T</code> å»æ”¹é‡Œé¢çš„å€¼ã€‚</p>
</blockquote>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> b </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Box</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">*</span><span style="color:#E1E4E8">b </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">;         </span><span style="color:#6A737D">//  ç¼–è¯‘é”™è¯¯ï¼šä¸èƒ½ä¿®æ”¹</span></span>
<span class="line"><span style="color:#E1E4E8">b </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Box</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">42</span><span style="color:#E1E4E8">); </span><span style="color:#6A737D">//  ç¼–è¯‘é”™è¯¯ï¼šb æ˜¯ä¸å¯å˜ç»‘å®š</span></span></code></pre>
<p>é‚£æ˜¯ä¸æ˜¯ <code>let b = Box::new(5)</code> å°±å®Œå…¨ä¸èƒ½æ”¹é‡Œé¢çš„å€¼ã€‚</p>
<p>ç­”æ¡ˆæ˜¯ï¼š<strong>æ˜¯çš„ï¼Œä¸èƒ½ç›´æ¥ä¿®æ”¹</strong>ï¼Œå› ä¸ºï¼š</p>
<ul>
<li>è™½ç„¶ <code>Box&#x3C;T></code> ç†è®ºä¸Šæ‹¥æœ‰æ•°æ®çš„å”¯ä¸€æ‰€æœ‰æƒ</li>
<li>ä½† <code>let b =</code> åˆ›å»ºçš„æ˜¯<strong>ä¸å¯å˜ç»‘å®š</strong></li>
<li>Rust ä¼šè®¤ä¸ºä½ å¯èƒ½æœ‰å¤šä¸ª <code>&#x26;b</code> å­˜åœ¨ï¼Œå› æ­¤ä¸èƒ½ä»ä¸­è·å¾— <code>&#x26;mut T</code></li>
</ul>
<p><strong>å“ªæ€•ä½ æ‹¥æœ‰çš„æ˜¯ <code>Box&#x3C;T></code>ï¼ŒRust ä¹Ÿä¸ä¼šé»˜è®¤å…è®¸ä½ ä»ä¸å¯å˜å˜é‡ä¸­å€Ÿå‡º <code>&#x26;mut</code>ã€‚</strong></p>
<p>æ›´å½¢è±¡åœ°ç†è§£ä¸€ä¸‹ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> b </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Box</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">);</span></span></code></pre>
<p>è¿™æ˜¯è¯´ï¼š</p>
<blockquote>
<p>â€œä½ æœ‰ä¸€ä¸ªä¿é™©ç®±ï¼ˆ<code>Box</code>ï¼‰ï¼Œä½ çŸ¥é“é‡Œé¢æœ‰ä»€ä¹ˆï¼Œä½†ä½ æ‰¿è¯ºè‡ªå·±<strong>æ°¸è¿œä¸ä¼šæ¢é”æˆ–ä¿®æ”¹å†…å®¹</strong>ã€‚â€</p>
</blockquote>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">let</span><span style="color:#F97583"> mut</span><span style="color:#E1E4E8"> b </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Box</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">);</span></span></code></pre>
<p>è¿™æ˜¯è¯´ï¼š</p>
<blockquote>
<p>â€œä½ æœ‰ä¸€æŠŠé’¥åŒ™ï¼Œè€Œä¸”ä½ è¯´â€˜æˆ‘éšæ—¶å¯èƒ½è¿›ä¿é™©ç®±åŠ ä¸ªæ–‡ä»¶ï¼Œæˆ–è€…ç›´æ¥æ¢ä¸€æ•´ä¸ªç®±å­â€™ã€‚â€</p>
</blockquote>
<p>æ‰€ä»¥æ€»ç»“å°±æ˜¯ï¼š</p>




















<table><thead><tr><th>å†™æ³•</th><th>èƒ½å¦é‡æ–°èµ‹å€¼ <code>b</code></th><th>èƒ½å¦ä¿®æ”¹ Box ä¸­çš„å€¼</th></tr></thead><tbody><tr><td><code>let b = Box::new(5)</code></td><td>ä¸èƒ½</td><td>ä¸èƒ½ï¼ˆå› ä¸ºä¸èƒ½è·å¾— &#x26;mutï¼‰</td></tr><tr><td><code>let mut b = Box::new(5)</code></td><td>å¯ä»¥</td><td>å¯ä»¥ï¼ˆé€šè¿‡ <code>*b = 10</code>ï¼‰</td></tr></tbody></table>
<p>æ€»ç»“å£è¯€ï¼š</p>
<blockquote>
<p><strong>æ•°æ®æ˜¯å¦èƒ½æ”¹ï¼Œå–å†³äºä¸¤ç‚¹ï¼š</strong></p>
<ul>
<li>å˜é‡ <code>b</code> æœ¬èº«æ˜¯ä¸æ˜¯ <code>mut</code></li>
<li>æ•°æ®ç±»å‹æ˜¯ä¸æ˜¯æ”¯æŒå¯å˜è®¿é—®ï¼ˆæ¯”å¦‚ <code>Box&#x3C;T></code> æ”¯æŒï¼‰</li>
</ul>
</blockquote>
<p>ä¸€å¥è¯æ€»ç»“ä½ è¿™å¥ç†è§£ï¼š</p>
<p><strong>ä½ è¯´å¾—å¯¹ â€”â€” <code>let mut b = ...</code> å’Œ <code>let b = ...</code>ï¼Œå½±å“çš„æ˜¯å˜é‡ <code>b</code> æœ¬èº«èƒ½ä¸èƒ½æ”¹ï¼Œ<br>
ä½†å¦‚æœä½ æƒ³â€œæ”¹å€¼â€ï¼Œä½ </strong>ä¹Ÿå¿…é¡»å†™ <code>mut</code>ï¼Œå› ä¸º Rust ç¼–è¯‘å™¨ä¸ä¼šè‡ªåŠ¨å¸®ä½ è§£å¥—ã€‚**</p>
<p>æƒ³è¦ä½“éªŒä¸€äº›ç‰¹æ®Šæƒ…å†µä¸‹<strong>ä¸å†™ mut ä¹Ÿèƒ½æ”¹å€¼</strong>çš„ä¾‹å­ã€‚æ¯”å¦‚ <code>RefCell&#x3C;T></code>ã€‚é‚£å°±æ˜¯çœŸæ­£çš„ interior mutabilityï¼Œç»§ç»­æ·±å…¥ä¹Ÿå¾ˆæœ‰è¶£ã€‚éœ€è¦æˆ‘å±•å¼€è®²è®²ã€‚</p>
<h3 id="ä¸»é¢˜-7-æœ‰ä»€ä¹ˆåŒºåˆ«">ä¸»é¢˜ 7. æœ‰ä»€ä¹ˆåŒºåˆ«</h3>
<p>ä½ çš„è¿™ä¸ªå¯¹æ¯” â€”â€”</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">let</span><span style="color:#F97583"> mut</span><span style="color:#E1E4E8"> b </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Box</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> c </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">);</span></span></code></pre>
<p>å¯ä»¥è¯´æ˜¯ Rust æ‰€æœ‰æƒç³»ç»Ÿå’Œæ™ºèƒ½æŒ‡é’ˆ<strong>æœ€æœ¬è´¨åŒºåˆ«</strong>çš„ä¸€ä¸ªç¼©å½±ã€‚</p>
<p>æ€»ç»“ä¸€å¥è¯ï¼š</p>
<blockquote>
<p><strong><code>Box&#x3C;T></code> æ˜¯ â€œå”¯ä¸€æ‰€æœ‰è€… + å¯å˜è®¿é—®â€</strong><br>
<strong><code>Rc&#x3C;T></code> æ˜¯ â€œå¤šæ‰€æœ‰è€… + åªè¯»è®¿é—®â€</strong></p>
</blockquote>
<p>åˆ†å¼€è®²ï¼š</p>
<h3 id="boxt-çš„ç‰¹ç‚¹"><code>Box&#x3C;T></code> çš„ç‰¹ç‚¹ï¼š</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">let</span><span style="color:#F97583"> mut</span><span style="color:#E1E4E8"> b </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Box</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">*</span><span style="color:#E1E4E8">b </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">//  åˆæ³•ï¼šä½ æ‹¥æœ‰å”¯ä¸€æ‰€æœ‰æƒ + å¯å˜ç»‘å®š</span></span></code></pre>
<ul>
<li>æ•°æ®åœ¨å †ä¸Š</li>
<li>ä½ æ˜¯<strong>å”¯ä¸€æ‰€æœ‰è€…</strong></li>
<li>åªè¦ä½ ç”¨ <code>mut</code>ï¼Œä½ å°±å¯ä»¥<strong>ä¿®æ”¹é‡Œé¢çš„æ•°æ®</strong></li>
<li><code>Box</code> æ²¡æœ‰å¼•ç”¨è®¡æ•°ï¼Œæ€§èƒ½æ›´è½»</li>
</ul>
<h3 id="rct-çš„ç‰¹ç‚¹"><code>Rc&#x3C;T></code> çš„ç‰¹ç‚¹ï¼š</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> c </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">// *c = 10;  é”™è¯¯ï¼šRc&#x3C;T> åªæä¾›ä¸å¯å˜å¼•ç”¨</span></span></code></pre>
<ul>
<li>æ•°æ®ä¹Ÿåœ¨å †ä¸Š</li>
<li>ä½†ä½ ä¸æ˜¯å”¯ä¸€çš„ä¸»äººï¼Œ<strong>å¤šä¸ª Rc å¯ä»¥å…±äº«åŒä¸€ä»½æ•°æ®</strong></li>
<li>æ‰€ä»¥åªèƒ½æä¾› <strong>ä¸å¯å˜å¼•ç”¨ï¼ˆ<code>&#x26;T</code>ï¼‰</strong></li>
<li>æƒ³ä¿®æ”¹ã€‚å¾—é…åˆ <code>RefCell</code> æ‰èƒ½åšåˆ°ï¼š</li>
</ul>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> c </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">RefCell</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">));</span></span>
<span class="line"><span style="color:#F97583">*</span><span style="color:#E1E4E8">c</span><span style="color:#F97583">.</span><span style="color:#B392F0">borrow_mut</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">// </span></span></code></pre>
<p>ç±»æ¯”è¯´æ˜ï¼ˆå½¢è±¡å¯¹æ¯”ï¼‰ï¼š</p>





























<table><thead><tr><th>æŒ‡é’ˆç±»å‹</th><th>æ‹¥æœ‰è€…æ•°é‡</th><th>æ˜¯å¦èƒ½æ”¹å†…éƒ¨å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>Box&#x3C;T></code></td><td>åªæœ‰ä½ ä¸€ä¸ª</td><td>å¯ä»¥æ”¹ï¼ˆåªè¦ä½  <code>mut</code>ï¼‰</td><td>å°±åƒä½ ç‹¬è‡ªæ‹¥æœ‰ä¸€æœ¬æ—¥è®°ï¼Œæƒ³æ”¹å°±æ”¹</td></tr><tr><td><code>Rc&#x3C;T></code></td><td>å¯ä»¥å…‹éš†ï¼Œå¤šä¸ªä¸»äºº</td><td>ä¸å…è®¸ç›´æ¥æ”¹</td><td>å°±åƒåˆç§ŸåˆåŒï¼Œä½ ä¸èƒ½è‡ªå·±æ¶‚æ”¹å†…å®¹</td></tr><tr><td><code>Rc&#x3C;RefCell&#x3C;T>></code></td><td>å¤šä¸ªä¸»äºº + å†…éƒ¨å¯å˜æ€§</td><td>è¿è¡Œæ—¶å€Ÿç”¨æ£€æŸ¥ï¼Œèƒ½æ”¹</td><td>æ¯ä¸ªäººéƒ½èƒ½æ‰“å¼€ç¬”è®°æœ¬æ”¹ï¼Œä½†å¿…é¡»æ’é˜Ÿå€Ÿç”¨é’¥åŒ™</td></tr></tbody></table>
<p>å†çœ‹å…·ä½“ä¾‹å­ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">let</span><span style="color:#F97583"> mut</span><span style="color:#E1E4E8"> b </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Box</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">*</span><span style="color:#E1E4E8">b </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">;  </span><span style="color:#6A737D">//  ä½ æ˜¯å”¯ä¸€ä¸»äººï¼Œæƒ³æ”¹å°±æ”¹</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> c </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">// *c += 1; //  ç¼–è¯‘æŠ¥é”™ï¼šRc ä¸æä¾› &#x26;mut</span></span></code></pre>
<p>æ‰€ä»¥ä¸¤è€…æœ€å¤§çš„åŒºåˆ«ï¼š</p>



































<table><thead><tr><th>å¯¹æ¯”ç‚¹</th><th><code>Box&#x3C;T></code></th><th><code>Rc&#x3C;T></code></th></tr></thead><tbody><tr><td>å †ä¸Šåˆ†é…ã€‚</td><td>æ˜¯</td><td>æ˜¯</td></tr><tr><td>æ‰€æœ‰æƒã€‚</td><td>å”¯ä¸€æ‰€æœ‰æƒ</td><td>å¤šæ‰€æœ‰æƒï¼ˆå¼•ç”¨è®¡æ•°ï¼‰</td></tr><tr><td>å¯å˜æ€§ã€‚</td><td>æ”¯æŒå¯å˜è®¿é—®ï¼ˆå‰ææ˜¯ <code>mut</code>ï¼‰</td><td>ä¸æ”¯æŒå¯å˜è®¿é—®ï¼ˆå¿…é¡»é…åˆ <code>RefCell</code>ï¼‰</td></tr><tr><td>æ€§èƒ½ã€‚</td><td>å¿«ï¼Œé›¶å¼€é”€</td><td>æ…¢ä¸€äº›ï¼Œæœ‰å¼•ç”¨è®¡æ•°é€»è¾‘</td></tr><tr><td>çº¿ç¨‹å®‰å…¨ã€‚</td><td>ä¸æ”¯æŒå¤šçº¿ç¨‹</td><td>Rc ä¸æ˜¯çº¿ç¨‹å®‰å…¨ï¼ˆè¦ç”¨ Arcï¼‰</td></tr></tbody></table>
<p>ä»€ä¹ˆæ—¶å€™ç”¨å“ªä¸ªã€‚</p>





























<table><thead><tr><th>éœ€æ±‚</th><th>ç”¨è¿™ä¸ª</th></tr></thead><tbody><tr><td>åªéœ€è¦ä¸€ä¸ªæ‹¥æœ‰è€…ï¼Œæ•°æ®éœ€è¦å †ä¸Šåˆ†é…</td><td><code>Box&#x3C;T></code></td></tr><tr><td>å¤šä¸ªåœ°æ–¹éƒ½éœ€è¦å…±äº«è¯»æ•°æ®ï¼ˆå•çº¿ç¨‹ï¼‰</td><td><code>Rc&#x3C;T></code></td></tr><tr><td>å¤šä¸ªåœ°æ–¹éƒ½éœ€è¦å…±äº« + ä¿®æ”¹ï¼ˆå•çº¿ç¨‹ï¼‰</td><td><code>Rc&#x3C;RefCell&#x3C;T>></code></td></tr><tr><td>å¤šä¸ªçº¿ç¨‹å…±äº«åªè¯»æ•°æ®</td><td><code>Arc&#x3C;T></code></td></tr><tr><td>å¤šä¸ªçº¿ç¨‹å…±äº«å¹¶ä¿®æ”¹æ•°æ®</td><td><code>Arc&#x3C;Mutex&#x3C;T>></code> or <code>Arc&#x3C;RwLock&#x3C;T>></code></td></tr></tbody></table>
<h3 id="ä¸»é¢˜-8-ä¸ºä»€ä¹ˆè¿™é‡Œåˆä¸ç”¨mutäº†">ä¸»é¢˜ 8. ä¸ºä»€ä¹ˆè¿™é‡Œåˆä¸ç”¨mutäº†</h3>
<p>ä½ é—®åˆ°äº† Rust çš„ä¸€ä¸ªè¶…æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š</p>
<blockquote>
<p>ä¸ºä»€ä¹ˆ <code>let c = Rc::new(RefCell::new(5));</code> ä¸æ˜¯ <code>mut c</code>ï¼Œå´èƒ½ä¿®æ”¹é‡Œé¢çš„å€¼ã€‚</p>
</blockquote>
<p>è¿™çœ‹èµ·æ¥åƒæ˜¯åœ¨è¿å Rust çš„å€Ÿç”¨è§„åˆ™ï¼Œä½†å…¶å®<strong>ä¸æ˜¯ã€‚</strong><br>
å®ƒæ˜¯å€ŸåŠ©äº† <code>RefCell</code> çš„<strong>å†…éƒ¨å¯å˜æ€§ï¼ˆInterior Mutabilityï¼‰æœºåˆ¶</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š</p>
<blockquote>
<p><strong>ä½ ç»‘å®šå˜é‡çš„æ—¶å€™ä¸éœ€è¦ <code>mut</code>ï¼Œåªè¦å†…éƒ¨å®ç°äº†â€œå¯å˜æ€§â€ï¼Œä½ å°±èƒ½æ”¹ã€‚</strong></p>
</blockquote>
<p>åˆ†è§£è§£é‡Šï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> c </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">RefCell</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">));</span></span>
<span class="line"><span style="color:#F97583">*</span><span style="color:#E1E4E8">c</span><span style="color:#F97583">.</span><span style="color:#B392F0">borrow_mut</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">;  </span><span style="color:#6A737D">// </span></span></code></pre>
<p>æˆ‘ä»¬æ¥æ‹†å¼€è¿™è¡Œä»£ç é‡Œå‘ç”Ÿäº†ä»€ä¹ˆé­”æ³•ï¼š</p>
<h3 id="1ï¸âƒ£-rcrefcellt-æ˜¯ä¸¤ä¸ªä¸œè¥¿å åœ¨ä¸€èµ·">1ï¸âƒ£ <code>Rc&#x3C;RefCell&#x3C;T>></code> æ˜¯ä¸¤ä¸ªä¸œè¥¿å åœ¨ä¸€èµ·ï¼š</h3>
<ul>
<li><code>Rc&#x3C;T></code>ï¼šè®©å¤šä¸ªåœ°æ–¹å…±äº«åŒä¸€ä¸ªæ•°æ®ï¼ˆå…±äº«æ‰€æœ‰æƒï¼‰</li>
<li><code>RefCell&#x3C;T></code>ï¼šå…è®¸ä½ åœ¨ <strong>åªæ‹¿åˆ°ä¸å¯å˜å¼•ç”¨ï¼ˆ&#x26;ï¼‰çš„æƒ…å†µä¸‹</strong>ï¼Œ<strong>ä»ç„¶ä¿®æ”¹é‡Œé¢çš„å€¼ã€‚</strong></li>
</ul>
<p>è¿™å°±æ˜¯ <code>RefCell</code> æœ€å¤§çš„è¶…èƒ½åŠ›ã€‚</p>
<p>ä¸ºä»€ä¹ˆä¸ç”¨ <code>mut</code>ã€‚</p>
<p>æ¥çœ‹è¿™ä¸ªå¯¹æ¯”ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">let</span><span style="color:#F97583"> mut</span><span style="color:#E1E4E8"> x </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 5</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">x </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">//  å› ä¸ºå˜é‡æ˜¯ mut</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> x </span><span style="color:#F97583">=</span><span style="color:#B392F0"> RefCell</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">*</span><span style="color:#E1E4E8">x</span><span style="color:#F97583">.</span><span style="color:#B392F0">borrow_mut</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">//  å³ä½¿ x ä¸æ˜¯ mutï¼</span></span></code></pre>
<p>åŸå› å¦‚ä¸‹ï¼š</p>
<h3 id="mut-x-çš„æ„æ€æ˜¯æˆ‘å¯ä»¥æ”¹å˜å˜é‡ç»‘å®š-x-æœ¬èº«"><code>mut x</code> çš„æ„æ€æ˜¯ï¼šâ€œæˆ‘å¯ä»¥æ”¹å˜å˜é‡ç»‘å®š <code>x</code> æœ¬èº«â€</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">let</span><span style="color:#F97583"> mut</span><span style="color:#E1E4E8"> x </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 5</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">x </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 6</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">// </span></span></code></pre>
<p>ä½† <code>RefCell&#x3C;T></code> çš„ç”¨æ³•ä¸æ˜¯æ”¹ <code>x</code> æœ¬èº«ï¼Œè€Œæ˜¯ï¼š</p>
<blockquote>
<p>ä¿®æ”¹ <code>x</code> é‡Œé¢é‚£ä¸ª <code>T</code>ï¼ˆåœ¨è¿™é‡Œæ˜¯ 5ï¼‰ï¼Œé€šè¿‡å†…éƒ¨é€»è¾‘å€Ÿå‡ºæ¥çš„ <strong>å¯å˜å¼•ç”¨</strong> å»æ”¹çš„ã€‚</p>
</blockquote>
<p>è¿™æ—¶å€™ <code>x</code> æœ¬èº«å¹¶æ²¡æœ‰åŠ¨ï¼Œæ‰€ä»¥ä½ <strong>ä¸éœ€è¦ mut</strong>ã€‚</p>
<p>RefCell å¦‚ä½•å®ç°è¿™ç§â€œçœ‹èµ·æ¥ä¸åˆç†â€çš„æ“ä½œã€‚</p>
<p>é€šè¿‡å®ƒå†…éƒ¨çš„<strong>è¿è¡Œæ—¶å€Ÿç”¨æ£€æŸ¥å™¨</strong>ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#6A737D">// æºç ç®€åŒ–é€»è¾‘ï¼ˆä¼ªä»£ç ï¼‰</span></span>
<span class="line"><span style="color:#F97583">struct</span><span style="color:#B392F0"> RefCell</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">> {</span></span>
<span class="line"><span style="color:#E1E4E8">    value</span><span style="color:#F97583">:</span><span style="color:#B392F0"> T</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    borrow_flag</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Cell</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">isize</span><span style="color:#E1E4E8">>,</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">fn</span><span style="color:#B392F0"> borrow_mut</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">&#x26;</span><span style="color:#79B8FF">self</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">-></span><span style="color:#B392F0"> RefMut</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">> {</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#79B8FF"> self</span><span style="color:#F97583">.</span><span style="color:#E1E4E8">borrow_flag </span><span style="color:#F97583">!=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">        panic!</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"already borrowed"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#79B8FF">    self</span><span style="color:#F97583">.</span><span style="color:#E1E4E8">borrow_flag </span><span style="color:#F97583">=</span><span style="color:#F97583"> -</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6A737D">    // è¿”å›ä¸€ä¸ªå°è£…çš„ &#x26;mut å¼•ç”¨</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="ï¸-å€Ÿç”¨è§„åˆ™è¿˜æ˜¯åœ¨çš„åªä¸è¿‡åœ¨è¿è¡Œæ—¶è€Œéç¼–è¯‘æ—¶æ£€æŸ¥">ï¸ å€Ÿç”¨è§„åˆ™è¿˜æ˜¯åœ¨çš„ï¼Œåªä¸è¿‡åœ¨è¿è¡Œæ—¶è€Œéç¼–è¯‘æ—¶æ£€æŸ¥ã€‚</h3>
<p>å¦‚æœä½ åœ¨å¤šä¸ªåœ°æ–¹åŒæ—¶ <code>.borrow_mut()</code>ï¼Œç¨‹åºä¼šåœ¨è¿è¡Œæ—¶ panicã€‚</p>
<p>æ€»ç»“ä¸€æ³¢</p>

























<table><thead><tr><th>å†™æ³•</th><th>æ„ä¹‰</th><th>æ˜¯å¦éœ€è¦ <code>mut</code></th></tr></thead><tbody><tr><td><code>let mut x = 5</code></td><td>ä¿®æ”¹å˜é‡ç»‘å®šæœ¬èº«</td><td></td></tr><tr><td><code>let x = RefCell::new(5)</code></td><td>ä¿®æ”¹å†…éƒ¨å€¼</td><td></td></tr><tr><td><code>let mut x = RefCell::new(5)</code></td><td>ä¿®æ”¹å†…éƒ¨å€¼ + æ¢æ‰æ•´ä¸ª <code>x</code> æœ¬èº«</td><td></td></tr></tbody></table>
<p>ä¸€å¥è¯æ€»ç»“ï¼š</p>
<blockquote>
<p>åœ¨ Rust é‡Œï¼Œ<strong>æ˜¯å¦éœ€è¦ <code>mut</code>ï¼Œå–å†³äºä½ æ˜¯ä¸æ˜¯è¦â€œæ”¹å˜é‡æœ¬èº«â€ã€‚</strong><br>
å¦‚æœä½ åªæ˜¯é€šè¿‡ RefCell çš„æ–¹æ³•å»â€œå†…éƒ¨ä¿®æ”¹â€ï¼Œé‚£ä¹ˆ <strong>åªè¦å€Ÿç”¨çš„ä¸æ˜¯ <code>&#x26;mut self</code>ï¼Œä½ ä¸éœ€è¦ <code>mut</code>ã€‚</strong></p>
</blockquote>
<p>å¦‚æœä½ æƒ³çœ‹ä¸€ä¸ªåä¾‹ï¼š<code>RefCell</code> å†…éƒ¨è¢«åŒæ—¶ <code>.borrow_mut()</code> ä¸¤æ¬¡ï¼Œç¨‹åº panic çš„ä¾‹å­ï¼Œæˆ‘ä¹Ÿå¯ä»¥ç»™ä½ å†™ä¸€æ®µ</p>
<h3 id="ä¸»é¢˜-9-refcellåœ¨æˆ‘æ‹¿åˆ°ä¸€ä¸ªä¸å¯å˜å¼•ç”¨è¿˜å¯ä»¥ä¿®æ”¹å²‚ä¸æ˜¯è¿åäº†è§„åˆ™">ä¸»é¢˜ 9. RefCellåœ¨æˆ‘æ‹¿åˆ°ä¸€ä¸ªä¸å¯å˜å¼•ç”¨è¿˜å¯ä»¥ä¿®æ”¹ï¼Œå²‚ä¸æ˜¯è¿åäº†è§„åˆ™</h3>
<p>ç¡®å®ï¼Œä»å­—é¢ä¸Šçœ‹ï¼Œä½ æ‹¿äº†ä¸ª<strong>ä¸å¯å˜å¼•ç”¨</strong>ï¼Œå´èƒ½ä¿®æ”¹å†…å®¹ï¼Œè¿™è·ŸRustå¹³æ—¶â€œå€Ÿç”¨è§„åˆ™â€å¥½åƒå†²çªï¼Œæ„Ÿè§‰åƒæ˜¯â€œå·æ¢æ¢æŸ±â€ï¼Œä½†å…¶å®å®ƒæœ‰ä¸€å¥—<strong>åˆæ³•çš„å¹•åé€»è¾‘</strong>ã€‚æˆ‘ä»¬æ·±å…¥å‰–æä¸‹ã€‚</p>
<p>1ï¸âƒ£ å…ˆå›é¡¾ä¸€ä¸‹Rustçš„å€Ÿç”¨è§„åˆ™</p>
<blockquote>
<ul>
<li>åœ¨ä»»ä½•æ—¶åˆ»ï¼Œä½ è¦ä¹ˆæœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨ <code>&#x26;mut T</code>ï¼ˆå”¯ä¸€ï¼‰ï¼Œ</li>
<li>è¦ä¹ˆæœ‰ä»»æ„å¤šä¸ªä¸å¯å˜å¼•ç”¨ <code>&#x26;T</code>ï¼Œä½†ä¸èƒ½åŒæ—¶æœ‰å¯å˜å¼•ç”¨ã€‚</li>
</ul>
</blockquote>
<p>è¿™æ˜¯ç¼–è¯‘å™¨å¸®ä½ åœ¨ç¼–è¯‘æœŸ<strong>é™æ€æ£€æŸ¥</strong>çš„è§„åˆ™ã€‚</p>
<p>2ï¸âƒ£ ä¸ºä»€ä¹ˆ RefCell èƒ½ç ´åè¿™æ¡è§„åˆ™ã€‚â€”â€”å› ä¸ºå®ƒæŠŠå€Ÿç”¨æ£€æŸ¥ä»<strong>ç¼–è¯‘æœŸæ¬åˆ°äº†è¿è¡ŒæœŸ</strong></p>
<h3 id="å†…éƒ¨å¯å˜æ€§interior-mutability"><strong>â€œå†…éƒ¨å¯å˜æ€§ï¼ˆInterior Mutabilityï¼‰â€</strong></h3>
<ul>
<li><code>RefCell&#x3C;T></code> å…è®¸ä½ åœ¨<strong>æ‹¥æœ‰ä¸å¯å˜å¼•ç”¨çš„æƒ…å†µä¸‹</strong>ï¼Œåœ¨<strong>è¿è¡Œæ—¶</strong>æ£€æµ‹å€Ÿç”¨è§„åˆ™æ˜¯å¦è¢«è¿åã€‚</li>
<li>è¿™æ„å‘³ç€ä½ <strong>ç¼–è¯‘å™¨çœ¼é‡Œæ‹¿çš„æ˜¯ä¸å¯å˜å¼•ç”¨</strong>ï¼Œä½†<strong>è¿è¡Œæ—¶å¯ä»¥å…è®¸ä¸”æ£€æµ‹æ˜¯å¦æœ‰äººâ€œå·å·å€Ÿç”¨ mutableâ€</strong>ã€‚</li>
</ul>
<p>3ï¸âƒ£ RefCell çš„æ ¸å¿ƒå®ç°</p>
<p><code>RefCell</code> ç»´æŠ¤ä¸€ä¸ª<strong>è¿è¡Œæ—¶çš„å€Ÿç”¨è®¡æ•°å™¨</strong>ï¼š</p>
<ul>
<li>å½“ä½ è°ƒç”¨ <code>.borrow()</code> æ—¶ï¼Œè®¡æ•°å™¨åŠ 1ï¼ˆè¡¨ç¤ºæœ‰å¤šå°‘ä¸å¯å˜å€Ÿç”¨ï¼‰</li>
<li>å½“ä½ è°ƒç”¨ <code>.borrow_mut()</code> æ—¶ï¼Œè®¡æ•°å™¨å˜ä¸º-1ï¼ˆè¡¨ç¤ºå”¯ä¸€çš„å¯å˜å€Ÿç”¨ï¼‰</li>
<li>å¦‚æœè¿è¡Œæ—¶å‘ç°è¿åè§„åˆ™ï¼Œæ¯”å¦‚åŒæ—¶æœ‰ä¸å¯å˜å€Ÿç”¨å’Œå¯å˜å€Ÿç”¨ï¼Œç¨‹åº<strong>ä¼š panic</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè§„åˆ™è¿˜æ˜¯åœ¨ï¼Œåªä¸è¿‡ç”±ç¨‹åºåœ¨è¿è¡Œæ—¶æ£€æµ‹è€Œéç¼–è¯‘æ—¶ã€‚</li>
</ul>
<p>4ï¸âƒ£ ä¸¾ä¸ªå®é™…ä¾‹å­</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">use</span><span style="color:#B392F0"> std</span><span style="color:#F97583">::</span><span style="color:#B392F0">cell</span><span style="color:#F97583">::</span><span style="color:#B392F0">RefCell</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">fn</span><span style="color:#B392F0"> main</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">    let</span><span style="color:#E1E4E8"> x </span><span style="color:#F97583">=</span><span style="color:#B392F0"> RefCell</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    let</span><span style="color:#E1E4E8"> r1 </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> x</span><span style="color:#F97583">.</span><span style="color:#B392F0">borrow</span><span style="color:#E1E4E8">(); </span><span style="color:#6A737D">// ç¬¬ä¸€æ¬¡ä¸å¯å˜å€Ÿç”¨</span></span>
<span class="line"><span style="color:#F97583">    let</span><span style="color:#E1E4E8"> r2 </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> x</span><span style="color:#F97583">.</span><span style="color:#B392F0">borrow</span><span style="color:#E1E4E8">(); </span><span style="color:#6A737D">// è¿˜å¯ä»¥ä¸å¯å˜å€Ÿç”¨</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // let w = x.borrow_mut(); // è¿™è¡Œå¦‚æœå–æ¶ˆæ³¨é‡Šï¼Œç¨‹åºä¼š panicï¼Œå› ä¸ºä¸èƒ½åŒæ—¶å€Ÿå¯å˜å¼•ç”¨</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>5ï¸âƒ£ â€œä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡ã€‚â€</p>
<ul>
<li>Rust æœ‰æ—¶å€™ç¡®å®éœ€è¦<strong>ç»•è¿‡ç¼–è¯‘æœŸå€Ÿç”¨é™åˆ¶</strong>ï¼Œä¾‹å¦‚å›¾ã€æ ‘ç­‰æ•°æ®ç»“æ„çš„è®¾è®¡éå¸¸ä¾èµ–è¿™ç§èƒ½åŠ›ã€‚</li>
<li>ç”¨ <code>RefCell</code>ï¼Œç¨‹åºå‘˜æŠŠéƒ¨åˆ†â€œå®‰å…¨è´£ä»»â€äº¤ç»™äº†è¿è¡Œæ—¶æ£€æŸ¥ï¼Œæ¢æ¥äº†çµæ´»æ€§ã€‚</li>
</ul>
<p>6ï¸âƒ£ å°ç»“</p>




















<table><thead><tr><th>è§„åˆ™</th><th>ç¼–è¯‘æœŸæ£€æŸ¥</th><th>è¿è¡Œæ—¶æ£€æŸ¥</th></tr></thead><tbody><tr><td>æ™®é€šå€Ÿç”¨</td><td>ï¸</td><td>ï¸ï¼ˆæ— ï¼‰</td></tr><tr><td>RefCell</td><td>ï¸ï¼ˆæ”¾å®½ï¼‰</td><td>ï¸ï¼ˆpanicï¼‰</td></tr></tbody></table>
<p>7ï¸âƒ£ ä½ çš„é—®é¢˜ç‚¹ï¼š</p>
<blockquote>
<p>â€œæ‹¿ä¸å¯å˜å¼•ç”¨ä¿®æ”¹æ•°æ®ï¼Œæ˜¯ä¸æ˜¯è¿åè§„åˆ™ã€‚â€</p>
</blockquote>
<p><strong>ç­”æ¡ˆæ˜¯ï¼š</strong></p>
<ul>
<li>ç¼–è¯‘å™¨æ²¡æ³•æ£€æµ‹ï¼Œä½†è¿è¡Œæ—¶æœ‰å€Ÿç”¨è®¡æ•°ä¿è¯ä¸åŒæ—¶å€Ÿç”¨å†²çªã€‚</li>
<li>åªè¦ä½ ç”¨å¯¹äº†ï¼Œç»å¯¹å®‰å…¨ï¼›ç”¨é”™äº†ï¼Œå°±ç¨‹åºå´©æºƒï¼ˆpanicï¼‰ï¼Œæ¯”é‡æŒ‡é’ˆæ›´å®‰å…¨ã€‚</li>
</ul>
<p>å¦‚æœä½ æƒ³æˆ‘å†™ä¸ªç¤ºèŒƒä»£ç è§¦å‘ <code>RefCell</code> panicï¼Œä¹Ÿå¯ä»¥å‘Šè¯‰æˆ‘ã€‚è¿™å—ç†è§£é€äº†ï¼ŒRustä¸­å¾ˆå¤šé«˜çº§æ•°æ®ç»“æ„å°±ä¸å†ç¥ç§˜äº†~</p>
<h3 id="ä¸»é¢˜-10-é‚£rcrefcellt-å’Œboxrefcellt-æœ‰ä»€ä¹ˆåŒºåˆ«">ä¸»é¢˜ 10. é‚£Rc&#x3C;RefCell&#x3C;T å’ŒBox&#x3C;RefCell&#x3C;T æœ‰ä»€ä¹ˆåŒºåˆ«</h3>
<p>æ€»ç»“ä¸€å¥è¯å…ˆï¼š</p>
<blockquote>
<p><strong><code>Box&#x3C;RefCell&#x3C;T>></code> æ˜¯å•ä¸»äºº + å†…éƒ¨å¯å˜æ€§</strong><br>
<strong><code>Rc&#x3C;RefCell&#x3C;T>></code> æ˜¯å¤šä¸»äºº + å†…éƒ¨å¯å˜æ€§</strong></p>
</blockquote>
<p>ç®€å•æ¥è¯´ï¼Œ<strong>Box æ˜¯â€œæˆ‘ä¸€ä¸ªäººæ”¹è‡ªå·±â€ï¼ŒRc æ˜¯â€œå¤§å®¶è½®æµæ”¹ä¸€ä¸ªå…¬ç‰©â€</strong>ã€‚</p>
<p>ç›¸åŒç‚¹ï¼šéƒ½èƒ½ä¿®æ”¹å†…éƒ¨å€¼ï¼ˆå› ä¸ºéƒ½ç”¨äº† <code>RefCell&#x3C;T></code>ï¼‰</p>
<p>è¿™ä¸¤ç§ç»„åˆï¼Œéƒ½å¯ä»¥åšåˆ°è¿™ä»¶äº‹ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">*</span><span style="color:#E1E4E8">x</span><span style="color:#F97583">.</span><span style="color:#B392F0">borrow_mut</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> æ–°å€¼;  </span><span style="color:#6A737D">//  æ”¹é‡Œé¢çš„å€¼</span></span></code></pre>
<p>å› ä¸ºåªè¦æœ‰ <code>RefCell&#x3C;T></code>ï¼Œä½ å°±å¯ä»¥ç”¨ <code>.borrow_mut()</code> æ¥ä¿®æ”¹å†…å®¹ï¼Œ<strong>å³ä½¿å¤–éƒ¨æ˜¯ä¸å¯å˜ç»‘å®š</strong>ã€‚</p>
<p>ä¸åŒç‚¹ï¼šBox å’Œ Rc çš„è¯­ä¹‰å·®åˆ«</p>








































<table><thead><tr><th>ç‰¹æ€§</th><th><code>Box&#x3C;RefCell&#x3C;T>></code></th><th><code>Rc&#x3C;RefCell&#x3C;T>></code></th></tr></thead><tbody><tr><td>æ‰€æœ‰æƒ</td><td><strong>ä¸€ä¸ªæ‰€æœ‰è€…</strong></td><td><strong>å¤šä¸ªæ‰€æœ‰è€…ï¼ˆå¼•ç”¨è®¡æ•°ï¼‰</strong></td></tr><tr><td>å¯å˜æ€§</td><td>å¯ä¿®æ”¹å†…éƒ¨ï¼ˆä½ è‡ªå·±ï¼‰</td><td>å¯ä¿®æ”¹å†…éƒ¨ï¼ˆå¤§å®¶è½®æµï¼‰</td></tr><tr><td>å…‹éš†æ”¯æŒ</td><td>ä¸å¯å…‹éš†ï¼ˆBoxæ˜¯å”¯ä¸€çš„ï¼‰</td><td>Rc::clone() å¯ä»¥å…±äº«</td></tr><tr><td>åœºæ™¯</td><td>è‡ªå·±ç®¡çš„ä¸œè¥¿</td><td>å¤šä¸ªç»„ä»¶/å‡½æ•°å…±äº«æ•°æ®</td></tr><tr><td>æ€§èƒ½</td><td>å¿«ï¼Œæ— å¼•ç”¨è®¡æ•°</td><td>æ…¢ä¸€äº›ï¼ˆå¼•ç”¨è®¡æ•°æœ‰å¼€é”€ï¼‰</td></tr><tr><td>ç”¨é€”ä¸¾ä¾‹</td><td>æ ˆ/å †æ ‘ç»“æ„ç­‰ç§æœ‰æ•°æ®</td><td>GUIçŠ¶æ€ã€å¤šç»„ä»¶å…±äº«æ¨¡å‹</td></tr></tbody></table>
<p>ä¸¾ä¾‹è¯´æ˜ï¼š</p>
<h3 id="boxrefcell-ç¤ºä¾‹">Box&#x3C;RefCell<t>> ç¤ºä¾‹</t></h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> x </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Box</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">RefCell</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">));</span></span>
<span class="line"><span style="color:#F97583">*</span><span style="color:#E1E4E8">x</span><span style="color:#F97583">.</span><span style="color:#B392F0">borrow_mut</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">//  æ”¹</span></span></code></pre>
<ul>
<li>ä½ æ˜¯å”¯ä¸€æ‰€æœ‰è€…</li>
<li>ä¸æ”¯æŒ <code>.clone()</code></li>
<li>ä½¿ç”¨åœºæ™¯ï¼šä¸€ä¸ªå¯¹è±¡ç®¡ç†ä¸€ä¸ªçŠ¶æ€ï¼Œè‡ªå·±ç”¨å°±è¡Œï¼Œè°ä¹Ÿåˆ«æƒ³ç¢°</li>
</ul>
<h3 id="rcrefcell-ç¤ºä¾‹">Rc&#x3C;RefCell<t>> ç¤ºä¾‹</t></h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> x </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">RefCell</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">));</span></span>
<span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> y </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Rc</span><span style="color:#F97583">::</span><span style="color:#B392F0">clone</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">&#x26;</span><span style="color:#E1E4E8">x); </span><span style="color:#6A737D">//  å¤šä¸ªå¼•ç”¨å…±äº«æ•°æ®</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">*</span><span style="color:#E1E4E8">x</span><span style="color:#F97583">.</span><span style="color:#B392F0">borrow_mut</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">*</span><span style="color:#E1E4E8">y</span><span style="color:#F97583">.</span><span style="color:#B392F0">borrow_mut</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">//  y ä¹Ÿèƒ½æ”¹ï¼ˆæŒ‡å‘çš„æ˜¯åŒä¸€ä¸ª RefCellï¼‰</span></span></code></pre>
<ul>
<li>ä½ å¯ä»¥æŠŠ <code>x</code> å…‹éš†ç»™åˆ«çš„ç»“æ„ä½“æˆ–å‡½æ•°</li>
<li>æ‰€æœ‰å…‹éš†å‡ºæ¥çš„å¼•ç”¨éƒ½æŒ‡å‘åŒä¸€ä¸ªå †æ•°æ®</li>
<li>åœºæ™¯ï¼šå¤šä¸ªæ¨¡å—æˆ–é—­åŒ…å…±äº«åŒä¸€å—çŠ¶æ€ï¼ˆæ¯”å¦‚ GUI ä¸­å¤šä¸ªæ§ä»¶å…±äº«çª—å£çŠ¶æ€ï¼‰</li>
</ul>
<p>Box ä¸ºä»€ä¹ˆä¸èƒ½å…‹éš†ã€‚</p>
<p>å› ä¸º <code>Box&#x3C;T></code> ä»£è¡¨ä½ æ˜¯<strong>å”¯ä¸€çš„ä¸»äºº</strong>ï¼Œä½  clone çš„ä¸æ˜¯â€œå¼•ç”¨è®¡æ•°â€ï¼Œè€Œæ˜¯æƒ³æŠŠæ•´ä¸ªå€¼<strong>å¤åˆ¶ä¸€ä»½</strong>ï¼Œä½†ä¸æ˜¯æ‰€æœ‰ç±»å‹éƒ½æ”¯æŒå¤åˆ¶ï¼Œæ‰€ä»¥ <code>Box&#x3C;T></code> æœ¬èº«æ²¡å®ç° <code>Clone</code>ï¼ˆé™¤éä½ åŒ…çš„ä¸œè¥¿ä¹Ÿå®ç°äº† <code>Clone</code>ï¼‰ã€‚</p>
<p>æ€»ç»“å£è¯€ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Box&#x3C;RefCell&#x3C;T>> â†’ â€œæˆ‘ä¸€ä¸ªäººå·å·æ”¹â€</span></span>
<span class="line"><span>Rc&#x3C;RefCell&#x3C;T>> â†’ â€œæˆ‘ä»¬ä¸€ç¾¤äººè½®ç€æ”¹â€</span></span></code></pre>






























<table><thead><tr><th>ç»„åˆ</th><th>å«ä¹‰</th><th>å…¸å‹ç”¨é€”</th></tr></thead><tbody><tr><td><code>Box&#x3C;T></code></td><td>å”¯ä¸€æ‰€æœ‰æƒ</td><td>æ ˆç»“æ„/æ ‘ç»“æ„</td></tr><tr><td><code>Box&#x3C;RefCell&#x3C;T>></code></td><td>è‡ªå·±å¯ä»¥ä¿®æ”¹</td><td>ç‹¬å ä½†çµæ´»çš„æ•°æ®</td></tr><tr><td><code>Rc&#x3C;T></code></td><td>å¤šæ‰€æœ‰è€…ï¼Œå…±äº«è¯»</td><td>æ•°æ®å…±äº«ï¼Œä½†ä¸å˜</td></tr><tr><td><code>Rc&#x3C;RefCell&#x3C;T>></code></td><td>å¤šæ‰€æœ‰è€…ï¼Œå…±äº«æ”¹</td><td>çŠ¶æ€å…±äº«+å¯å˜æ”¹åŠ¨</td></tr></tbody></table>
<h3 id="æ’æŸ¥åœºæ™¯-3-rustçš„try-intoå’Œintoæœ‰ä»€ä¹ˆç”¨">æ’æŸ¥åœºæ™¯ 3. rustçš„try intoå’Œintoæœ‰ä»€ä¹ˆç”¨</h3>
<ul>
<li>åœºæ™¯ï¼šrustçš„try intoå’Œintoæœ‰ä»€ä¹ˆç”¨</li>
<li>å¤„ç†è¦ç‚¹ï¼š<br>
å¥½ã€‚ä½ è¿™é—®é¢˜é—®å¾—æå¥½ï¼Œ<code>into()</code> å’Œ <code>try_into()</code> æ˜¯ Rust ç±»å‹è½¬æ¢ä¸­éå¸¸é‡è¦çš„ä¸¤ä¸ª trait æ–¹æ³•ï¼Œå®ƒä»¬èƒŒåè•´å«çš„æ˜¯ Rust çš„ <strong>ç±»å‹å®‰å…¨å“²å­¦ + æ˜¾å¼è½¬æ¢æ§åˆ¶</strong>ã€‚</li>
</ul>
<p>æˆ‘ä»¬æ¥<strong>å½¢è±¡åœ°æ‹†å¼€ç†è§£</strong>è¿™ä¸¤è€…çš„åŒºåˆ«ã€ä½œç”¨ã€ä½¿ç”¨åœºæ™¯ä»¥åŠåŸç†ã€‚</p>
<p>å…ˆæ€»ç»“ä¸€å¥è¯ï¼š</p>
<blockquote>
<ul>
<li><code>into()</code>ï¼š<strong>ä¸€å®šèƒ½è½¬æ¢æˆåŠŸ</strong>çš„è½¬æ¢ï¼ˆç›´æ¥ä¸Šï¼‰</li>
<li><code>try_into()</code>ï¼š<strong>å¯èƒ½ä¼šå¤±è´¥</strong>çš„è½¬æ¢ï¼ˆå¾—æ£€æŸ¥ï¼‰</li>
</ul>
</blockquote>
<p>ä¸€ã€<code>into()</code> â€”â€” è‚¯å®šèƒ½è½¬çš„é‚£ç§</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> x</span><span style="color:#F97583">:</span><span style="color:#B392F0"> i32</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 5</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> y</span><span style="color:#F97583">:</span><span style="color:#B392F0"> i64</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> x</span><span style="color:#F97583">.</span><span style="color:#B392F0">into</span><span style="color:#E1E4E8">();  </span><span style="color:#6A737D">//  i32 -> i64 è‚¯å®šæ²¡é—®é¢˜</span></span></code></pre>
<h3 id="èƒŒåå®ç°çš„æ˜¯fromt-for-u-å’Œ-intou-for-t">èƒŒåå®ç°çš„æ˜¯ï¼š<code>From&#x3C;T> for U</code> å’Œ <code>Into&#x3C;U> for T</code></h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">impl</span><span style="color:#B392F0"> From</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">i32</span><span style="color:#E1E4E8">> </span><span style="color:#F97583">for</span><span style="color:#B392F0"> i64</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    fn</span><span style="color:#B392F0"> from</span><span style="color:#E1E4E8">(n</span><span style="color:#F97583">:</span><span style="color:#B392F0"> i32</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">-></span><span style="color:#79B8FF"> Self</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        n </span><span style="color:#F97583">as</span><span style="color:#B392F0"> i64</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>Rust ä¸­ <code>Into&#x3C;U></code> è‡ªåŠ¨ä¸ºä½ å®ç°äº† <code>T: From&#x3C;T> for U</code> çš„æƒ…å†µã€‚</p>
<h4 id="ç‰¹ç‚¹">ç‰¹ç‚¹ï¼š</h4>
<ul>
<li><strong>ä¸ä¼šå¤±è´¥</strong></li>
<li>ç¼–è¯‘å™¨èƒ½è‡ªåŠ¨æ¨å¯¼ç›®æ ‡ç±»å‹</li>
<li>ç”¨äºâ€œå®‰å…¨ã€è‚¯å®šèƒ½è½¬â€çš„åœºæ™¯</li>
</ul>
<p>äºŒã€<code>try_into()</code> â€”â€” æœ‰é£é™©æ‰ç”¨å®ƒ</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">use</span><span style="color:#B392F0"> std</span><span style="color:#F97583">::</span><span style="color:#B392F0">convert</span><span style="color:#F97583">::</span><span style="color:#B392F0">TryInto</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> big</span><span style="color:#F97583">:</span><span style="color:#B392F0"> i64</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 300</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> small</span><span style="color:#F97583">:</span><span style="color:#B392F0"> u8</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> big</span><span style="color:#F97583">.</span><span style="color:#B392F0">try_into</span><span style="color:#E1E4E8">()</span><span style="color:#F97583">.</span><span style="color:#B392F0">unwrap</span><span style="color:#E1E4E8">(); </span><span style="color:#6A737D">//  i64 -> u8 å¯èƒ½å¤±è´¥ï¼Œè¦ unwrap</span></span></code></pre>
<p>å› ä¸º <code>i64</code> å¯èƒ½å¤ªå¤§ï¼Œ<code>u8</code> è£…ä¸ä¸‹ï¼Œæ‰€ä»¥è¦ç”¨ <code>try_into()</code>ï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ª <code>Result&#x3C;T, E></code>ã€‚</p>
<h3 id="èƒŒåå®ç°çš„æ˜¯tryfromt-for-u-å’Œ-tryintou-for-t">èƒŒåå®ç°çš„æ˜¯ï¼š<code>TryFrom&#x3C;T> for U</code> å’Œ <code>TryInto&#x3C;U> for T</code></h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">impl</span><span style="color:#B392F0"> TryFrom</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">i64</span><span style="color:#E1E4E8">> </span><span style="color:#F97583">for</span><span style="color:#B392F0"> u8</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    type</span><span style="color:#B392F0"> Error</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> std</span><span style="color:#F97583">::</span><span style="color:#B392F0">num</span><span style="color:#F97583">::</span><span style="color:#B392F0">TryFromIntError</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    fn</span><span style="color:#B392F0"> try_from</span><span style="color:#E1E4E8">(value</span><span style="color:#F97583">:</span><span style="color:#B392F0"> i64</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">-></span><span style="color:#B392F0"> Result</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#79B8FF">Self</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">Self</span><span style="color:#F97583">::</span><span style="color:#B392F0">Error</span><span style="color:#E1E4E8">> {</span></span>
<span class="line"><span style="color:#B392F0">        u8</span><span style="color:#F97583">::</span><span style="color:#B392F0">try_from</span><span style="color:#E1E4E8">(value)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h4 id="ç‰¹ç‚¹-1">ç‰¹ç‚¹ï¼š</h4>
<ul>
<li><strong>å¯èƒ½å¤±è´¥</strong></li>
<li>è¿”å› <code>Result&#x3C;T, E></code></li>
<li>éœ€è¦ä½ æ‰‹åŠ¨ <code>.unwrap()</code> æˆ– <code>?</code> è§£åŒ…</li>
</ul>
<p>æ€»ç»“å¯¹æ¯”è¡¨ï¼š</p>



































<table><thead><tr><th>ç‰¹æ€§</th><th><code>into()</code></th><th><code>try_into()</code></th></tr></thead><tbody><tr><td>æ˜¯å¦ä¿è¯æˆåŠŸ</td><td>ä¸€å®šæˆåŠŸ</td><td>å¯èƒ½å¤±è´¥</td></tr><tr><td>è¿”å›å€¼ç±»å‹</td><td>ç›®æ ‡ç±»å‹ <code>T</code></td><td><code>Result&#x3C;T, E></code></td></tr><tr><td>Trait</td><td><code>Into&#x3C;T></code> / <code>From&#x3C;T></code></td><td><code>TryInto&#x3C;T></code> / <code>TryFrom&#x3C;T></code></td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>å®‰å…¨è½¬æ¢ï¼Œå¦‚ <code>i32 â†’ i64</code>ã€<code>&#x26;str â†’ String</code></td><td>é£é™©è½¬æ¢ï¼Œå¦‚ <code>i64 â†’ u8</code>ã€ç”¨æˆ·è¾“å…¥è§£æ</td></tr><tr><td>é”™è¯¯å¤„ç†</td><td>ä¸éœ€è¦</td><td>å¿…é¡»å¤„ç† <code>Result</code></td></tr></tbody></table>
<p>å®æˆ˜ä¸¾ä¾‹ï¼šå­—ç¬¦ä¸²è½¬æ•°å­—</p>
<h3 id="into-ç¤ºä¾‹string---vec"><code>into()</code> ç¤ºä¾‹ï¼šString -> Vec<u8></u8></h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> s </span><span style="color:#F97583">=</span><span style="color:#B392F0"> String</span><span style="color:#F97583">::</span><span style="color:#B392F0">from</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"hello"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> bytes</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Vec</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">u8</span><span style="color:#E1E4E8">> </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> s</span><span style="color:#F97583">.</span><span style="color:#B392F0">into</span><span style="color:#E1E4E8">();  </span><span style="color:#6A737D">//  æˆåŠŸ</span></span></code></pre>
<h3 id="try_into-ç¤ºä¾‹string---æ•°å­—"><code>try_into()</code> ç¤ºä¾‹ï¼šString -> æ•°å­—</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> s </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "123"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> num</span><span style="color:#F97583">:</span><span style="color:#B392F0"> u32</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> s</span><span style="color:#F97583">.</span><span style="color:#B392F0">parse</span><span style="color:#E1E4E8">()</span><span style="color:#F97583">.</span><span style="color:#B392F0">unwrap</span><span style="color:#E1E4E8">();  </span><span style="color:#6A737D">// é€šå¸¸è¿™æ ·åšï¼Œä½†ä¹Ÿå¯ä»¥è¿™æ ·ï¼š</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">use</span><span style="color:#B392F0"> std</span><span style="color:#F97583">::</span><span style="color:#B392F0">convert</span><span style="color:#F97583">::</span><span style="color:#B392F0">TryFrom</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> num</span><span style="color:#F97583">:</span><span style="color:#B392F0"> u32</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> u32</span><span style="color:#F97583">::</span><span style="color:#B392F0">try_from</span><span style="color:#E1E4E8">(s</span><span style="color:#F97583">.</span><span style="color:#B392F0">parse</span><span style="color:#F97583">::</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">i32</span><span style="color:#E1E4E8">>()</span><span style="color:#F97583">.</span><span style="color:#B392F0">unwrap</span><span style="color:#E1E4E8">())</span><span style="color:#F97583">.</span><span style="color:#B392F0">unwrap</span><span style="color:#E1E4E8">(); </span><span style="color:#6A737D">// å¤šå±‚ try_from</span></span></code></pre>
<p>æ€»ç»“å£è¯€ï¼š</p>
<blockquote>
<p><code>into()</code>ï¼šæ— è„‘å¹²ï¼Œå°±æ˜¯èƒ½è½¬<br>
<code>try_into()</code>ï¼šèµ°ä¿é™©ï¼Œå°å¿ƒç‚¹è½¬</p>
</blockquote>
<hr>
<p>Powered by <a href="https://www.chatgptexporter.com">ChatGPT Exporter</a></p>
<h2 id="å®æ–½ä¸éªŒè¯æ¸…å•">å®æ–½ä¸éªŒè¯æ¸…å•</h2>
<ol>
<li>æ‰§è¡Œå‰å…ˆç¡®è®¤ç¯å¢ƒã€ç‰ˆæœ¬å’Œä¾èµ–ä¸æ–‡ä¸­å‰ç½®æ¡ä»¶ä¸€è‡´ã€‚</li>
<li>æ¶‰åŠç³»ç»Ÿçº§å˜æ›´æ—¶ï¼Œå…ˆå¤‡ä»½å…³é”®é…ç½®æˆ–åˆ›å»ºå¿«ç…§ã€‚</li>
<li>å®Œæˆæ“ä½œåæŒ‰éªŒè¯æ­¥éª¤ç¡®è®¤ç»“æœï¼Œå†æ‰§è¡Œæ¸…ç†æˆ–è¦†ç›–åŠ¨ä½œã€‚</li>
</ol>  </div> <footer class="article-footer" data-astro-cid-bvzihdzo> <div class="share-section" data-astro-cid-bvzihdzo> <div class="share-buttons" data-astro-cid-zllr3mxm> <span class="share-label" data-astro-cid-zllr3mxm>Share:</span> <a href="https://twitter.com/intent/tweet?text=Rust%20%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88%E5%8C%BA%E5%88%AB&url=https%3A%2F%2Fblog.liweijun.com%2Fblog%2Finfra%2Frust-%25E6%2599%25BA%25E8%2583%25BD%25E6%258C%2587%25E9%2592%2588%25E5%258C%25BA%25E5%2588%25AB%2F" target="_blank" rel="noopener noreferrer" class="share-btn twitter" title="Share on X" data-astro-cid-zllr3mxm> <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18" data-astro-cid-zllr3mxm> <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" data-astro-cid-zllr3mxm></path> </svg> <span data-astro-cid-zllr3mxm>Post on X</span> </a> <button class="share-btn copy-link" id="copyLinkBtn" data-url="https://blog.liweijun.com/blog/infra/rust-%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88%E5%8C%BA%E5%88%AB/" data-astro-cid-zllr3mxm> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18" data-astro-cid-zllr3mxm> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" data-astro-cid-zllr3mxm></path> <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" data-astro-cid-zllr3mxm></path> </svg> <span class="copy-text" data-astro-cid-zllr3mxm>Copy Link</span> </button> </div>  <script type="module">const t=document.getElementById("copyLinkBtn"),e=t?.querySelector(".copy-text");t?.addEventListener("click",async()=>{const o=t.dataset.url||window.location.href;try{await navigator.clipboard.writeText(o),t.classList.add("copied"),e&&(e.textContent="Copied!"),setTimeout(()=>{t.classList.remove("copied"),e&&(e.textContent="Copy Link")},2e3)}catch(c){console.error("Failed to copy:",c)}});</script> </div> <section class="related-posts" data-astro-cid-dpgbfi7r><h3 class="related-title" data-astro-cid-dpgbfi7r><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="20" height="20" data-astro-cid-dpgbfi7r><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25" data-astro-cid-dpgbfi7r></path></svg>
Related Posts
</h3><div class="related-grid" data-astro-cid-dpgbfi7r><a href="/blog/infra/k3s-åŒèŠ‚ç‚¹é›†ç¾¤éƒ¨ç½²æŒ‡å—/" class="related-card" data-astro-cid-dpgbfi7r><h4 class="related-card-title" data-astro-cid-dpgbfi7r>K3s åŒèŠ‚ç‚¹é›†ç¾¤éƒ¨ç½²æŒ‡å—</h4><p class="related-card-desc" data-astro-cid-dpgbfi7r>ç½‘ç»œè¿é€šæ€§ï¼šä¸¤å°æœºå™¨ä¹‹é—´éœ€è¦äº’é€šã€‚å¦‚æœæ˜¯è·¨äº‘å‚å•†ï¼Œå»ºè®®ä½¿ç”¨ Tailscale æˆ– WireGuard å»ºç«‹è™šæ‹Ÿå†…ç½‘ï¼Œæˆ–è€…ç¡®ä¿é˜²ç«å¢™å¼€æ”¾äº†...</p></a><a href="/blog/infra/k8s-vs-k3s-ingress-ä½“éªŒå¯¹æ¯”/" class="related-card" data-astro-cid-dpgbfi7r><h4 class="related-card-title" data-astro-cid-dpgbfi7r>k8s vs k3s: Ingress ä½“éªŒå¯¹æ¯”</h4><p class="related-card-desc" data-astro-cid-dpgbfi7r>åŸç”Ÿ k8sï¼š å¦‚æœä½ ä¸åœ¨äº‘å¹³å°ä¸Šï¼Œè¿™ä¸ª Service ä¼šæ°¸è¿œå¡åœ¨ çŠ¶æ€ï¼Œå› ä¸º k8s ä¸çŸ¥é“å¦‚ä½•å»å‘ä½ çš„è·¯ç”±å™¨æˆ–å…¬ç½‘ç”³è¯·ä¸€ä¸ª IPã€‚</p></a><a href="/blog/infra/kubectl-rollout-å‘½ä»¤è¯¦è§£/" class="related-card" data-astro-cid-dpgbfi7r><h4 class="related-card-title" data-astro-cid-dpgbfi7r>kubectl rollout å‘½ä»¤è¯¦è§£</h4><p class="related-card-desc" data-astro-cid-dpgbfi7r>åœºæ™¯ï¼š åœ¨ CI/CD æµæ°´çº¿ä¸­ï¼Œç¡®ä¿æ–°ç‰ˆæœ¬å®Œå…¨å¯åŠ¨åå†è¿›è¡Œä¸‹ä¸€æ­¥ã€‚</p></a></div></section> <section class="comments-section" id="comments" data-astro-cid-jvxsf75u> <h3 class="comments-title" data-astro-cid-jvxsf75u> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="22" height="22" data-astro-cid-jvxsf75u> <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 0 1 .865-.501 48.172 48.172 0 0 0 3.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018Z" data-astro-cid-jvxsf75u></path> </svg>
Comments
</h3> <div class="giscus-wrapper" data-astro-cid-jvxsf75u> <script src="https://giscus.app/client.js" data-repo="LosFurina/LosFurina.github.io" data-repo-id="R_kgDOQ_gmWQ" data-category="General" data-category-id="DIC_kwDOQ_gmWc4C2A9-" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="preferred_color_scheme" data-lang="en" data-loading="lazy" crossorigin="anonymous" async></script> </div> </section>  <script type="module">function s(){const e=document.documentElement.getAttribute("data-theme"),t=document.querySelector("iframe.giscus-frame");if(t){const i=e==="dark"?"dark":"light";t.contentWindow?.postMessage({giscus:{setConfig:{theme:i}}},"https://giscus.app")}}const n=new MutationObserver(e=>{e.forEach(t=>{t.attributeName==="data-theme"&&s()})});n.observe(document.documentElement,{attributes:!0});window.addEventListener("message",e=>{e.origin==="https://giscus.app"&&s()});</script> </footer> </article> </main> <aside class="right-sidebar" data-astro-cid-bvzihdzo> <!-- Future content --> </aside> </div> <footer data-astro-cid-sz7xmlte> <div class="footer-content" data-astro-cid-sz7xmlte> <p class="copyright" data-astro-cid-sz7xmlte>
&copy; 2026 Wayne Li. All rights reserved.
</p> <div class="social-links" data-astro-cid-sz7xmlte> <a href="https://github.com/LosFurina" target="_blank" rel="noopener" title="GitHub" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>GitHub</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="24" height="24" data-astro-cid-sz7xmlte> <path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-sz7xmlte></path> </svg> </a> <a href="https://x.com/MicroNahida" target="_blank" rel="noopener" title="X (Twitter)" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>X (Twitter)</span> <svg viewBox="0 0 24 24" aria-hidden="true" width="24" height="24" data-astro-cid-sz7xmlte> <path fill="currentColor" d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" data-astro-cid-sz7xmlte></path> </svg> </a> <a href="mailto:me@liweijun.com" title="Email" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>Email</span> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true" width="24" height="24" data-astro-cid-sz7xmlte> <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" data-astro-cid-sz7xmlte></path> <polyline points="22,6 12,13 2,6" data-astro-cid-sz7xmlte></polyline> </svg> </a> <a href="/rss.xml" title="RSS Feed" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>RSS Feed</span> <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="24" height="24" data-astro-cid-sz7xmlte> <path d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20C5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27V4.44m0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93V10.1z" data-astro-cid-sz7xmlte></path> </svg> </a> </div> <p class="footer-note" data-astro-cid-sz7xmlte>
Built with <a href="https://astro.build" target="_blank" rel="noopener" data-astro-cid-sz7xmlte>Astro</a> </p> </div> </footer>  </body></html>