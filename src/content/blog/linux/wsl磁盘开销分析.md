---
title: "WSL磁盘开销分析"
description: "WSL1：基本上就是一个兼容层，体积很小，安装完大概几十 MB。"
pubDate: "2025-09-13"
updatedDate: "2025-09-13"
category: "linux"
tags: ["linux"]
sourcePath: "src/content/blog/ChatGPT-WSL磁盘开销分析.md"
sourceVault: "chat-export"
---
## 背景与适用场景

本文聚焦 WSL磁盘开销分析 的实际使用场景，适用于希望快速落地配置或排错的 Linux 用户。

## 核心结论

- WSL1：基本上就是一个兼容层，体积很小，安装完大概几十 MB。
- WSL2：用了 Hyper-V 虚拟化，会创建一个 虚拟硬盘文件 (ext4.vhdx)，存放 Linux 系统和文件。刚安装完一个发行版...
- 这个文件是 动态扩容 的（sparse file），实际占用取决于你在 Linux 里存了多少东西。
- 当你删除文件时，Windows 并不会自动缩小 vhdx 的大小，需要手动执行
- 内存：WSL2 会动态占用内存，默认上限接近物理内存总量（可在 里限制，比如 4GB）。

## 详细说明

### wsl的正常磁盘开销是多少

当你删除文件时，Windows 并不会自动缩小 vhdx 的大小，需要手动执行

随着使用增长：几 GB 到几十 GB 不等（取决于你装的包和数据）

### 我发现在wsl下，占用了400g

WSL2 的虚拟磁盘是动态扩容的，但不会自动缩回去，所以常见原因和排查方法如下

如果 vhdx 占用非常大，可以确认确实是 Linux 里面的数据撑起来的

### 实现思路 3

如果你愿意，我可以帮你写一个命令，把 真正占用 WSL 根盘的数据 和 挂载盘的数据 分开统计，避免误以为 WSL 自己吃掉了大量空间

1\. WSL 本体磁盘几乎没问题

## 操作步骤与命令示例

### 示例 1

```powershell
wsl --shutdown
    Optimize-VHD -Path "C:\Users\<你>\AppData\Local\Packages\<发行版ID>\LocalState\ext4.vhdx" -Mode Full
```

### 示例 2

```bash
du -h --max-depth=1 / | sort -hr | head -20
```

### 示例 3

```bash
sudo apt clean
```

### 示例 4

```bash
pip cache purge
```

### 执行顺序建议

1. 确认当前系统版本、服务状态与关键配置文件。
2. 按最小变更原则执行命令或修改配置。
3. 通过日志、状态命令和实际行为完成验证。

## 常见问题与排查

- **问题：** wsl的正常磁盘开销是多少  **排查：** 当你删除文件时，Windows 并不会自动缩小 vhdx 的大小，需要手动执行；随着使用增长：几 GB 到几十 GB 不等（取决于你装的包和数据）
- **问题：** 我发现在wsl下，占用了400g  **排查：** WSL2 的虚拟磁盘是动态扩容的，但不会自动缩回去，所以常见原因和排查方法如下；如果 vhdx 占用非常大，可以确认确实是 Linux 里面的数据撑起来的
- **问题：** 怎么看我在wsl安装了多少  **排查：** 想要看你 WSL2 里安装的软件、包和文件到底占用了多少空间，可以从几个角度来查；如果你愿意，我可以帮你写一个 一条命令就能列出 WSL 里各类占用空间前十的文件夹/软件...

## 关键问答摘录

> **Q:** wsl的正常磁盘开销是多少
>
> **A:** 当你删除文件时，Windows 并不会自动缩小 vhdx 的大小，需要手动执行；随着使用增长：几 GB 到几十 GB 不等（取决于你装的包和数据）

> **Q:** 我发现在wsl下，占用了400g
>
> **A:** WSL2 的虚拟磁盘是动态扩容的，但不会自动缩回去，所以常见原因和排查方法如下；如果 vhdx 占用非常大，可以确认确实是 Linux 里面的数据撑起来的

## 总结

WSL1：基本上就是一个兼容层，体积很小，安装完大概几十 MB。

- 原始对话来源：https://chatgpt.com/c/68c54cbf-84d4-8328-b79f-52a19f8ac8ec
