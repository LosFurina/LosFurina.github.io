---
title: "Kubernetes Deployment å­—æ®µè¯¦è§£"
description: "ä»¥ Nginx Deployment ä¸ºä¾‹ï¼Œé€é¡¹è§£é‡Š apiVersionã€selectorã€template ä¸ resources ç­‰å…³é”®å­—æ®µã€‚"
pubDate: "2025-09-03"
updatedDate: "2026-02-09"
category: "infra"
tags: ["infra"]
sourcePath: "ComputerScience/Kubernetes Deployment é…ç½®è¯¦è§£ç¬”è®°.md"
sourceVault: "obsidian/note"
slug: "infra/æ€»ç»“"
---
ä¸‹é¢ä»¥ä¸€ä¸ª **Nginx Deployment** çš„é…ç½®ä¸ºä¾‹ï¼Œé€è¡Œè§£é‡Šå„å­—æ®µçš„ä½œç”¨ï¼š

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
  labels:
    app: nginx
spec:
  replicas: 3   # å‰¯æœ¬æ•°
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
        - name: nginx
          image: nginx   # æ¢æˆä½ è‡ªå·±çš„é•œåƒ
          ports:
            - containerPort: 80
          resources:                # å¯é€‰ï¼Œé™åˆ¶èµ„æº
            limits:
              cpu: "500m"
              memory: "256Mi"
            requests:
              cpu: "250m"
              memory: "128Mi"

```

## 1. åŸºæœ¬ä¿¡æ¯

### `apiVersion: apps/v1`

- è¡¨ç¤ºè¯¥é…ç½®æ–‡ä»¶ä½¿ç”¨ **Kubernetes API çš„ apps/v1 ç‰ˆæœ¬**ã€‚
    
- `apps/v1` æ˜¯ç®¡ç† Deploymentã€StatefulSetã€DaemonSet ç­‰åº”ç”¨å‹èµ„æºçš„ç¨³å®šç‰ˆæœ¬ã€‚
    
- **ä½œç”¨**ï¼šå‘Šè¯‰ API Server æŒ‰ç…§å“ªå¥—è§„åˆ™è§£æè¿™ä¸ªå¯¹è±¡ã€‚
    

### `kind: Deployment`

- å®šä¹‰è¯¥å¯¹è±¡çš„ç±»å‹ã€‚
    
- **Deployment** æ˜¯ Kubernetes ç”¨æ¥ç®¡ç† Pod å‰¯æœ¬æ•°å’Œæ»šåŠ¨å‡çº§çš„æ§åˆ¶å™¨ã€‚
    
- **ä½œç”¨**ï¼šä¿è¯æŒ‡å®šæ•°é‡çš„ Pod å§‹ç»ˆè¿è¡Œï¼Œå¹¶æ”¯æŒæ— ä¸­æ–­æ›´æ–°ã€‚

## 2. å…ƒæ•°æ®ï¼ˆmetadataï¼‰

### `metadata.name: nginx-deployment`

- Deployment çš„åå­—ã€‚
    
- åœ¨åŒä¸€ä¸ª namespace ä¸­å¿…é¡»å”¯ä¸€ã€‚
    
- **ä½œç”¨**ï¼šä¾¿äºç”¨æˆ·å’Œç³»ç»Ÿæ ‡è¯†èµ„æºã€‚
    

### `metadata.labels:`

```yaml
labels:
  app: nginx
```

- ç»™è¿™ä¸ª Deployment æ‰“ä¸Šæ ‡ç­¾ `app=nginx`ã€‚
    
- **ä½œç”¨**ï¼šæ ‡ç­¾ç”¨æ¥åˆ†ç»„å’Œç­›é€‰èµ„æºï¼Œåç»­çš„ `selector` ä¼šç”¨åˆ°ã€‚

## 3. è§„èŒƒï¼ˆspecï¼‰

### `spec.replicas: 3`

- æŒ‡å®šè¦è¿è¡Œçš„ Pod å‰¯æœ¬æ•°ï¼ˆè¿™é‡Œæ˜¯ 3 ä¸ªï¼‰ã€‚
    
- **ä½œç”¨**ï¼šDeployment ä¼šä¿è¯å§‹ç»ˆæœ‰ 3 ä¸ª Pod å­˜æ´»ï¼Œå¦‚æœæœ‰ Pod å´©æ‰ï¼Œä¼šè‡ªåŠ¨æ‹‰èµ·æ–°çš„ã€‚
    

### `spec.selector`

```yaml
selector:
  matchLabels:
    app: nginx
```

- å®šä¹‰ Pod çš„é€‰æ‹©å™¨ã€‚
    
- `matchLabels: app=nginx` è¡¨ç¤º Deployment åªç®¡ç†å¸¦æœ‰ `app=nginx` æ ‡ç­¾çš„ Podã€‚
    
- **ä½œç”¨**ï¼šDeployment æ ¹æ®æ ‡ç­¾ç¡®å®šå“ªäº› Pod å±äºè‡ªå·±ç®¡è¾–èŒƒå›´ã€‚

## 4. Pod æ¨¡æ¿ï¼ˆtemplateï¼‰

Deployment é‡Œçš„ `template` æ˜¯ **Pod çš„è“å›¾**ï¼Œæ‰€æœ‰ Pod éƒ½ä¼šæŒ‰ç…§è¿™ä¸ªæ¨¡æ¿ç”Ÿæˆã€‚

### `template.metadata.labels`

```yaml
labels:
  app: nginx
```

- ç»™ Pod æ‰“ä¸Šæ ‡ç­¾ã€‚
    
- å¿…é¡»å’Œä¸Šé¢çš„ `selector.matchLabels` åŒ¹é…ï¼Œå¦åˆ™ Deployment æ‰¾ä¸åˆ° Podã€‚
    

### `template.spec.containers`

```yaml
containers:
  - name: nginx
    image: nginx
    ports:
      - containerPort: 80
```

#### `containers`

- å®šä¹‰ Pod ä¸­è¿è¡Œçš„å®¹å™¨ï¼ˆå¯ä»¥æœ‰å¤šä¸ªï¼Œè¿™é‡Œåªæœ‰ä¸€ä¸ª Nginx å®¹å™¨ï¼‰ã€‚
    

#### `name: nginx`

- å®¹å™¨çš„åå­—ã€‚
    
- åœ¨ Pod å†…å¿…é¡»å”¯ä¸€ã€‚
    

#### `image: nginx`

- ä½¿ç”¨çš„é•œåƒï¼ˆè¿™é‡Œæ˜¯å®˜æ–¹çš„ `nginx`ï¼‰ã€‚
    
- **ä½œç”¨**ï¼šå†³å®šå®¹å™¨å¯åŠ¨æ—¶è¿è¡Œä»€ä¹ˆåº”ç”¨ã€‚
    
- å¯ä»¥æ¢æˆä½ è‡ªå·±çš„é•œåƒï¼Œä¾‹å¦‚ï¼š`myrepo/myapp:1.0`ã€‚
    

#### `ports.containerPort: 80`

- å£°æ˜å®¹å™¨å¼€æ”¾çš„ç«¯å£ï¼ˆè¿™é‡Œæ˜¯ 80ï¼‰ã€‚
    
- **ä½œç”¨**ï¼šè®© Service æˆ–å…¶ä»–å®¹å™¨çŸ¥é“è¿™ä¸ªå®¹å™¨å¯¹å¤–æä¾›æœåŠ¡çš„ç«¯å£ã€‚

## 5. èµ„æºé™åˆ¶ï¼ˆresourcesï¼‰

```yaml
resources:
  limits:
    cpu: "500m"
    memory: "256Mi"
  requests:
    cpu: "250m"
    memory: "128Mi"
```

- **requests**ï¼šæœ€å°èµ„æºéœ€æ±‚ã€‚è°ƒåº¦å™¨ä¼šä¿è¯ Pod è‡³å°‘èƒ½æ‹¿åˆ°è¿™äº›èµ„æºã€‚
    
    - CPUï¼š`250m` = 0.25 æ ¸å¿ƒ
        
    - å†…å­˜ï¼š`128Mi` = 128 MiB
        
- **limits**ï¼šæœ€å¤§èµ„æºé™åˆ¶ã€‚å®¹å™¨ä¸èƒ½è¶…è¿‡è¿™ä¸ªå€¼ã€‚
    
    - CPUï¼š`500m` = 0.5 æ ¸å¿ƒ
        
    - å†…å­˜ï¼š`256Mi` = 256 MiB
        

**ä½œç”¨**ï¼šé˜²æ­¢æŸä¸ªå®¹å™¨æ— é™åˆ¶å ç”¨èŠ‚ç‚¹èµ„æºï¼Œä¿è¯é›†ç¾¤èµ„æºå…¬å¹³åˆ†é…ã€‚

## ğŸ“Œ æ€»ç»“

- **apiVersion / kind** â†’ å®šä¹‰å¯¹è±¡çš„ç±»å‹å’Œç‰ˆæœ¬
    
- **metadata** â†’ èº«ä»½ä¿¡æ¯ï¼ˆåå­—ã€æ ‡ç­¾ï¼‰
    
- **spec** â†’ æœŸæœ›çŠ¶æ€ï¼ˆå¤šå°‘å‰¯æœ¬ã€å¦‚ä½•é€‰æ‹© Podã€Pod æ¨¡æ¿ï¼‰
    
- **template** â†’ Pod çš„è“å›¾
    
- **resources** â†’ æ§åˆ¶å®¹å™¨çš„èµ„æºä½¿ç”¨
    

Deployment çš„æ ¸å¿ƒé€»è¾‘ï¼š  
ğŸ‘‰ **ç…§ç€ Pod æ¨¡æ¿ï¼ˆtemplateï¼‰ï¼Œä¿æŒä¸€å®šæ•°é‡ï¼ˆreplicasï¼‰çš„ Podï¼Œæ ‡ç­¾åŒ¹é…ï¼ˆselectorï¼‰ç¡®ä¿ç®¡ç†èŒƒå›´**ã€‚
