---
import type { HTMLAttributes } from "astro/types";

interface Props extends HTMLAttributes<"a"> {
	icon?: string;
}

const { href, icon, class: className, ...props } = Astro.props;
const pathname = Astro.url.pathname.replace(import.meta.env.BASE_URL, "");
const subpath = pathname.match(/[^\/]+/g);
const isActive = href === pathname || href === "/" + (subpath?.[0] || "");
const hasIconSlot = Astro.slots.has("icon");
const hasIcon = hasIconSlot || Boolean(icon);
---

<a href={href} class:list={[className, { active: isActive }]} {...props}>
	{hasIcon && (
		<span class="nav-icon" aria-hidden="true">
			{hasIconSlot ? <slot name="icon" /> : icon}
		</span>
	)}
	<span class="nav-text"><slot /></span>
</a>

<style>
	a {
		display: inline-flex;
		align-items: center;
		gap: 0.5rem;
		padding: 0.4rem 0.75rem;
		text-decoration: none;
		font-size: 0.9rem;
		font-weight: 500;
		color: var(--header-text, rgb(var(--gray-dark)));
		border-radius: 999px;
		transition: color 0.2s ease, background 0.2s ease;
		position: relative;
	}

	a:hover {
		background: var(--header-hover, rgba(179, 106, 74, 0.08));
		color: var(--header-text-strong, rgb(var(--gray-dark)));
	}

	a:focus-visible {
		outline: 2px solid var(--header-accent, #b36a4a);
		outline-offset: 2px;
	}

	a.active {
		color: var(--header-accent, #b36a4a);
	}

	a.active::after {
		content: "";
		position: absolute;
		left: 50%;
		bottom: 4px;
		width: 4px;
		height: 4px;
		margin-left: -2px;
		border-radius: 999px;
		background: var(--header-accent, #b36a4a);
	}

	.nav-icon {
		display: inline-flex;
		width: 16px;
		height: 16px;
	}

	.nav-icon :global(svg) {
		width: 16px;
		height: 16px;
		fill: none;
		stroke: currentColor;
		stroke-linecap: round;
		stroke-linejoin: round;
	}

	@media (max-width: 720px) {
		a {
			width: 100%;
			justify-content: flex-start;
			padding: 0.6rem 0.9rem;
		}
	}
</style>
