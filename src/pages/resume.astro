---
import BaseHead from "../components/BaseHead.astro";
import Footer from "../components/Footer.astro";
import Header from "../components/Header.astro";
import TokenProtectedReveal from "../components/TokenProtectedReveal.astro";
import {
    privateContactPayload,
    privateResumeDownloadPayload,
} from "../data/privateContact";
import { SITE_TITLE, SOCIALS } from "../consts";

const profile = {
    name: "æä¸ºå› | Weijun Li",
    title: "DevOps / SRE Intern",
    subtitle: "M.S. in CS @ USC",
    email: SOCIALS.email,
    github: "https://github.liweijun.com",
    blog: "https://blog.liweijun.com",
};

const education = [
    {
        school: "University of Southern California (USC)",
        degree: "M.S. in Computer Science",
        period: "2025.09 - 2027.05",
        location: "Los Angeles, CA",
    },
    {
        school: "Hangzhou Dianzi University (HDU)",
        degree: "B.E. in Network Engineering",
        period: "2020.09 - 2024.06",
        location: "Hangzhou, Zhejiang",
        details: ["GPA: 4.38/5.00", "Top 5%"],
    },
];

const coreCompetencies = [
    {
        title: "GitOps / K8s",
        detail:
            "æ­å»º ArgoCD App-of-Apps åˆ†å±‚äº¤ä»˜ä½“ç³»ï¼Œç»Ÿä¸€ç®¡ç† dev / staging / prod ä¸‰å¥—ç¯å¢ƒä¸å¤šç»„ä»¶ä¾èµ–ç¼–æ’ã€‚",
    },
    {
        title: "CI/CD",
        detail:
            "é‡æ„ GitHub Actions + Buildx + GHCR æµæ°´çº¿å¹¶å¯ç”¨åˆ†å±‚ç¼“å­˜ï¼Œé•œåƒæ„å»ºè€—æ—¶é™ä½çº¦ 66%ã€‚",
    },
    {
        title: "å¯è§‚æµ‹æ€§",
        detail:
            "è½åœ° Loki + Fluent-Bit + Grafana æ—¥å¿—èšåˆæ–¹æ¡ˆï¼Œç»“åˆ Traefik å®ç°é“¾è·¯è¿½è¸ªä¸å‘Šè­¦ã€‚",
    },
    {
        title: "AI Infra",
        detail:
            "ç´¯è®¡è°ƒåº¦ 100+ GPU å®ä¾‹ (AliCloud / AutoDL / RunPod)ï¼Œä¸»å¯¼ Conda -> uv ç¯å¢ƒæ²»ç†ã€‚",
    },
    {
        title: "äº‘åŸç”Ÿå®‰å…¨",
        detail:
            "å®è·µ Sealed Secrets + cert-manager + DNS01ï¼ŒSSH / GPG å¯†é’¥ç®¡ç†ï¼Œå®ç°å¯†é’¥åŠ å¯†å…¥åº“ä¸ TLS è¯ä¹¦è‡ªåŠ¨è½®è½¬ã€‚",
    },
];

const projects = [
    {
        name: "RevieU | äº‘åŸç”Ÿç‚¹è¯„åº”ç”¨ (Cloud Native Review App)",
        role: "Tech Lead / Infrastructure | Team of 13",
        period: "2025.12 - Present",
        link: "https://github.com/RevieU-Corp",
        details: [
            "æ¶æ„é€‰å‹ï¼šé€‰æ‹© K3sï¼ˆèµ„æºå—é™åœºæ™¯ï¼‰ä¸ ArgoCDï¼ˆå£°æ˜å¼éƒ¨ç½²ï¼‰ï¼Œå¹¶ä» ELK è¿ç§»è‡³ Loki ä»¥é™ä½èµ„æºå ç”¨ï¼›ç»“åˆ Claude Code / Cursor æå‡äº¤ä»˜æ•ˆç‡ã€‚",
            "åŸºç¡€è®¾æ–½ï¼šç‹¬ç«‹å®Œæˆ K3s å¤šèŠ‚ç‚¹é›†ç¾¤å»ºè®¾ï¼Œè®¾è®¡ Root App + Platform / Application åˆ†å±‚æ¶æ„ï¼ŒæŒ‰ sync-wave ç¼–æ’ç»„ä»¶ä¾èµ–ã€‚",
            "ç½‘ç»œæ’æŸ¥ï¼šä¿®å¤ flannel + WireGuard è·¨èŠ‚ç‚¹è¿é€šæ€§é—®é¢˜ï¼Œä¿éšœå¤šèŠ‚ç‚¹é›†ç¾¤ç¨³å®šè¿è¡Œã€‚",
            "åª’ä½“é“¾è·¯ï¼šè½åœ° Cloudflare R2 (S3 API) ç›´ä¼ æ–¹æ¡ˆï¼Œæ‰“é€šåç«¯ presigned URL ç­¾å‘ä¸å‰ç«¯ PUT ä¸Šä¼ æµç¨‹ã€‚",
        ],
    },
    {
        name: "PGTN | æ—¶åºå¼‚å¸¸æ£€æµ‹ (Time Series Anomaly Detection)",
        role: "First Author / AI Infra",
        period: "2024.06 - 2025.12",
        link: "https://github.com/LosFurina/PGTN",
        details: [
            "å®éªŒå·¥ç¨‹ï¼šè®¾è®¡æ ‡å‡†åŒ–å®éªŒç›®å½•ç»“æ„ï¼Œè‡ªåŠ¨å½’æ¡£é…ç½®ã€æƒé‡ã€æ—¥å¿—ã€æŒ‡æ ‡ä¸å¯è§†åŒ–ç»“æœï¼›é€šè¿‡ SSHFS æŒ‚è½½è¿œç¨‹ GPU æœåŠ¡å™¨ã€‚",
            "GPU è°ƒåº¦ï¼šè®¾è®¡ä»»åŠ¡çº§å¼¹æ€§è°ƒåº¦ç­–ç•¥ï¼ˆéå›ºå®šé…é¢ï¼‰ï¼Œæ”¯æŒ 4-10 å¡ DataParallel è®­ç»ƒï¼Œç´¯è®¡è°ƒåº¦ 100+ å®ä¾‹ã€‚",
            "æ¨¡å‹ç ”ç©¶ï¼šæå‡ºåŒé€šé“ (Variable + Temporal) Graph Transformer æ¶æ„ï¼Œåœ¨ SWaT / WADI / SMD / PSM ä¸Š F1 ç›¸æ¯” 10 ä¸ª baseline æå‡ 40%+ã€‚",
        ],
    },
    {
        name: "ä¸ªäººåŸºç¡€è®¾æ–½ | Personal Infrastructure",
        role: "Owner / Operator",
        period: "2022.09 - Present",
        details: [
            "æœåŠ¡æ‰˜ç®¡ï¼šç®¡ç†å¤šå°è‡ªæœ‰æœåŠ¡å™¨ï¼Œä½¿ç”¨ Docker Compose éƒ¨ç½² 8+ è‡ªæ‰˜ç®¡æœåŠ¡ï¼Œç¨³å®šè¿è¡Œ 2+ å¹´ã€‚",
            "æµé‡æ²»ç†ï¼šæ•´åˆ Cloudflare (Tunnel / DNS / Workers / R2) + Let's Encryptï¼Œå®ç°åŸŸåã€è¯ä¹¦ã€å¯¹è±¡å­˜å‚¨ä¸€ä½“åŒ–æ²»ç†ã€‚",
            "ç¼“å­˜ç›‘æ§ï¼šéƒ¨ç½² Redis ç¼“å­˜é«˜é¢‘åª’ä½“æ–‡ä»¶ï¼Œé…ç½®èµ„æºç›‘æ§é˜ˆå€¼å‘Šè­¦å¹¶æ¨é€è‡³ Discord / é‚®ä»¶ã€‚",
            "æŠ€æœ¯åšå®¢ï¼šåŸºäº Astro æ­å»ºï¼Œç´¯è®¡å‘å¸ƒ 90+ ç¯‡æŠ€æœ¯æ–‡ç« ã€‚",
        ],
    },
];

const internship = [
    {
        company: "æµ™æ±Ÿå…ƒä¹™æ™ºèƒ½ç§‘æŠ€æœ‰é™å…¬å¸",
        role: "SDE / AI Infra Intern",
        period: "2024.05 - 2024.06",
        location: "Hangzhou, Zhejiang",
        details: [
            "æ¨¡å‹éƒ¨ç½²ï¼šå‚ä¸ VoiceClone / Wav2Lip å·¥ç¨‹åŒ–è½åœ°ï¼Œç»´æŠ¤ GitHub Actions + Docker å‘å¸ƒæµæ°´çº¿ã€‚",
            "ç¯å¢ƒæ²»ç†ï¼šè´Ÿè´£å›¢é˜Ÿ GPU å¼€å‘ç¯å¢ƒï¼Œè§£å†³ Python / CUDA / é©±åŠ¨ç‰ˆæœ¬å†²çªï¼Œé™ä½ç¯å¢ƒæ•…éšœç‡ã€‚",
        ],
    },
];

const skills = {
    "ç¼–ç¨‹è¯­è¨€": ["Python", "Go", "Rust", "C/C++", "JavaScript/TypeScript", "Shell"],
    "äº‘åŸç”Ÿ": ["Docker", "Kubernetes (K3s)", "ArgoCD", "Kustomize", "Helm", "GitHub Actions", "GHCR", "Redis"],
    "AI / å·¥å…·": ["Claude Code", "Cursor", "GitHub Copilot", "PyTorch", "Grafana", "Loki", "Prometheus"],
    "Linux / ç½‘ç»œ": ["Arch Linux", "Neovim", "iptables", "systemd", "WireGuard", "SS/Trojan", "DNS æ’æŸ¥"],
    "äº‘å¹³å°": ["Cloudflare (DNS/Tunnel/Workers/R2)", "AWS S3", "GCP", "é˜¿é‡Œäº‘"],
};

const honors = [
    "æµ™æ±Ÿçœæ”¿åºœå¥–å­¦é‡‘ï¼ˆå‰ 2%ï¼Œè¿ç»­ä¸¤å¹´ï¼‰",
    "åä¸ºæ™ºèƒ½åŸºåº§å¥–å­¦é‡‘",
    "æ ¡ä¸€ç­‰å¥–å­¦é‡‘ï¼ˆ6æ¬¡ï¼‰",
    "å¤§å­¦ç”Ÿåˆ›æ–°åˆ›ä¸šé¡¹ç›®ï¼ˆè´Ÿè´£äººï¼‰",
];
---

<!doctype html>
<html lang="en">
    <head>
        <BaseHead
            title={`Resume | ${SITE_TITLE}`}
            description="Resume of Weijun Li - DevOps / SRE"
        />
        <style>
            main {
                max-width: 900px;
                margin: 0 auto;
                padding: 2rem;
            }

            .page-header {
                text-align: center;
                margin-bottom: 2rem;
            }

            .page-header h1 {
                font-size: 2.5rem;
                margin-bottom: 0.5rem;
                background: linear-gradient(
                    135deg,
                    var(--accent),
                    var(--accent-dark)
                );
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }

            .page-header p {
                color: rgb(var(--gray));
                font-size: 1.1rem;
                margin: 0.2rem 0;
            }

            .download-btn {
                display: inline-flex;
                align-items: center;
                gap: 0.5rem;
                margin-top: 1rem;
                padding: 0.55rem 1.2rem;
                background: var(--accent);
                color: white;
                text-decoration: none;
                border-radius: 999px;
                font-weight: 600;
                transition: background 0.2s ease;
            }

            .download-btn:hover {
                background: var(--accent-dark);
            }

            .download-btn svg {
                width: 18px;
                height: 18px;
            }

            .section {
                margin-bottom: 2.2rem;
            }

            .section-title {
                font-size: 1.35rem;
                margin-bottom: 1rem;
                padding-bottom: 0.5rem;
                border-bottom: 2px solid var(--accent);
            }

            .timeline-item {
                position: relative;
                padding-left: 1.5rem;
                margin-bottom: 1.3rem;
                border-left: 2px solid rgba(var(--gray-light), 0.8);
            }

            .timeline-item::before {
                content: "";
                position: absolute;
                left: -6px;
                top: 0.35rem;
                width: 10px;
                height: 10px;
                border-radius: 50%;
                background: var(--accent);
            }

            .item-header {
                display: flex;
                justify-content: space-between;
                align-items: flex-start;
                flex-wrap: wrap;
                gap: 0.5rem;
                margin-bottom: 0.45rem;
            }

            .item-title {
                font-size: 1.08rem;
                font-weight: 700;
                color: rgb(var(--gray-dark));
                margin: 0;
            }

            .item-subtitle {
                font-size: 0.94rem;
                color: rgb(var(--gray));
                margin: 0;
            }

            .item-period {
                font-size: 0.82rem;
                color: rgb(var(--gray));
                background: rgba(var(--gray-light), 0.5);
                padding: 0.2rem 0.6rem;
                border-radius: 4px;
            }

            .item-details {
                margin: 0.7rem 0 0;
                padding-left: 1.2rem;
            }

            .item-details li {
                font-size: 0.9rem;
                color: rgb(var(--gray));
                margin-bottom: 0.4rem;
                line-height: 1.5;
            }

            .skills-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 1.2rem;
            }

            .skill-category h4 {
                font-size: 1rem;
                margin: 0 0 0.75rem;
                color: rgb(var(--gray-dark));
            }

            .skill-tags,
            .badge-list,
            .contact-info {
                display: flex;
                flex-wrap: wrap;
                gap: 0.5rem;
            }

            .skill-tag,
            .badge-item {
                font-size: 0.8rem;
                padding: 0.3rem 0.7rem;
                background: rgba(var(--gray-light), 0.5);
                border-radius: 6px;
                color: rgb(var(--gray-dark));
            }

            :global([data-theme="dark"]) .skill-tag,
            :global([data-theme="dark"]) .badge-item {
                background: rgba(255, 255, 255, 0.1);
            }

            .contact-info {
                justify-content: center;
                margin-top: 1rem;
                padding: 1rem;
                background: rgba(var(--gray-light), 0.2);
                border-radius: 12px;
            }

            .contact-item {
                display: inline-flex;
                align-items: center;
                gap: 0.4rem;
                color: rgb(var(--gray));
                text-decoration: none;
                font-size: 0.9rem;
            }

            .contact-item:hover {
                color: var(--accent);
            }

            @media (max-width: 600px) {
                main {
                    padding: 1rem;
                }

                .item-header {
                    flex-direction: column;
                }
            }
        </style>
    </head>
    <body>
        <Header />
        <main>
            <div class="page-header">
                <h1>ğŸ“„ Resume</h1>
                <p>{profile.name}</p>
                <p>{profile.title} Â· {profile.subtitle}</p>

                <div class="contact-info">
                    <a href={`mailto:${profile.email}`} class="contact-item">{profile.email}</a>
                    <a href={profile.github} target="_blank" rel="noopener" class="contact-item">GitHub</a>
                    <a href={profile.blog} target="_blank" rel="noopener" class="contact-item">Blog (90+ posts)</a>
                </div>

                <TokenProtectedReveal
                    title="Private Contact (Authorized Access)"
                    description="Need access? Email me first for authorization. After approval, enter the token to unlock phone and other private contact details."
                    iv={privateContactPayload.iv}
                    ciphertext={privateContactPayload.ciphertext}
                />

                <button
                    type="button"
                    class="download-btn"
                    id="secureDownloadBtn"
                    data-iv={privateResumeDownloadPayload.iv}
                    data-ciphertext={privateResumeDownloadPayload.ciphertext}
                >
                    <svg
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                    >
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Download PDF
                </button>
            </div>

            <section class="section">
                <h2 class="section-title">ğŸ“ Education</h2>
                {
                    education.map((edu) => (
                        <div class="timeline-item">
                            <div class="item-header">
                                <div>
                                    <h3 class="item-title">{edu.school}</h3>
                                    <p class="item-subtitle">{edu.degree}</p>
                                    <p class="item-subtitle">{edu.location}</p>
                                </div>
                                <span class="item-period">{edu.period}</span>
                            </div>
                            {edu.details && (
                                <ul class="item-details">
                                    {edu.details.map((detail) => (
                                        <li>{detail}</li>
                                    ))}
                                </ul>
                            )}
                        </div>
                    ))
                }
            </section>

            <section class="section">
                <h2 class="section-title">ğŸ§­ Core Competencies</h2>
                <ul class="item-details">
                    {
                        coreCompetencies.map((item) => (
                            <li>
                                <strong>{item.title}ï¼š</strong>
                                {item.detail}
                            </li>
                        ))
                    }
                </ul>
            </section>

            <section class="section">
                <h2 class="section-title">ğŸš€ Projects</h2>
                {
                    projects.map((project) => (
                        <div class="timeline-item">
                            <div class="item-header">
                                <div>
                                    <h3 class="item-title">{project.name}</h3>
                                    <p class="item-subtitle">{project.role}</p>
                                    {project.link && (
                                        <a href={project.link} target="_blank" rel="noopener" class="contact-item">{project.link}</a>
                                    )}
                                </div>
                                <span class="item-period">{project.period}</span>
                            </div>
                            <ul class="item-details">
                                {project.details.map((detail) => (
                                    <li>{detail}</li>
                                ))}
                            </ul>
                        </div>
                    ))
                }
            </section>

            <section class="section">
                <h2 class="section-title">ğŸ’¼ Experience</h2>
                {
                    internship.map((exp) => (
                        <div class="timeline-item">
                            <div class="item-header">
                                <div>
                                    <h3 class="item-title">{exp.company}</h3>
                                    <p class="item-subtitle">{exp.role}</p>
                                    <p class="item-subtitle">{exp.location}</p>
                                </div>
                                <span class="item-period">{exp.period}</span>
                            </div>
                            <ul class="item-details">
                                {exp.details.map((detail) => (
                                    <li>{detail}</li>
                                ))}
                            </ul>
                        </div>
                    ))
                }
            </section>

            <section class="section">
                <h2 class="section-title">ğŸ›  Skills</h2>
                <div class="skills-grid">
                    {
                        Object.entries(skills).map(([category, items]) => (
                            <div class="skill-category">
                                <h4>{category}</h4>
                                <div class="skill-tags">
                                    {items.map((skill) => (
                                        <span class="skill-tag">{skill}</span>
                                    ))}
                                </div>
                            </div>
                        ))
                    }
                </div>
            </section>

            <section class="section">
                <h2 class="section-title">ğŸ† Honors</h2>
                <div class="badge-list">
                    {
                        honors.map((honor) => (
                            <span class="badge-item">{honor}</span>
                        ))
                    }
                </div>
            </section>
        </main>
        <Footer />
        <script>
            const decodeBase64 = (input) =>
                Uint8Array.from(atob(input), (c) => c.charCodeAt(0));

            const getKey = async (token) => {
                const bytes = new TextEncoder().encode(token.trim());
                const digest = await crypto.subtle.digest("SHA-256", bytes);
                return crypto.subtle.importKey(
                    "raw",
                    digest,
                    "AES-GCM",
                    false,
                    ["decrypt"],
                );
            };

            const decryptPayload = async (token, iv, ciphertext) => {
                const key = await getKey(token);
                const plain = await crypto.subtle.decrypt(
                    { name: "AES-GCM", iv: decodeBase64(iv) },
                    key,
                    decodeBase64(ciphertext),
                );
                return JSON.parse(new TextDecoder().decode(plain));
            };

            const btn = document.getElementById("secureDownloadBtn");
            btn?.addEventListener("click", async () => {
                const token = window.prompt(
                    "Authorized users only. Enter token from email:",
                );
                if (!token) return;
                const iv = btn.dataset.iv || "";
                const ciphertext = btn.dataset.ciphertext || "";
                try {
                    const payload = await decryptPayload(token, iv, ciphertext);
                    const url = payload.resumePdf;
                    if (typeof url !== "string" || !url.startsWith("http")) {
                        throw new Error("invalid url");
                    }
                    window.open(url, "_blank", "noopener");
                } catch {
                    window.alert("Invalid token. Please request authorization by email.");
                }
            });
        </script>
    </body>
</html>
